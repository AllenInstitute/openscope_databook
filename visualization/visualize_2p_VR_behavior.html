
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Visualize 2P and Behavioral Data for Mouse Decision-making Task During Virtual Navigation &#8212; OpenScope Databook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-TJPN1M4PDX"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-TJPN1M4PDX');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-TJPN1M4PDX');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'visualization/visualize_2p_VR_behavior';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="OpenScope Databook - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="OpenScope Databook - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    OpenScope Databook
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../basics/background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/download_nwb.html">Downloading an NWB File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/stream_nwb.html">Streaming an NWB File with remfile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/read_nwb.html">Reading an NWB File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/use_nwbwidgets.html">Exploring an NWB File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/get_dandiset_metadata.html">Getting Experimental Metadata from DANDI</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Visualizing NWB Files</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="visualize_2p_raw.html">Visualizing Raw 2-Photon Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualize_unit_metrics.html">Visualizing Unit Quality Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualize_lfp_responses.html">Visualizing LFP Responses to Stimuli</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualize_unit_responses.html">Visualizing Neuronal Unit Responses</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualize_2p_responses.html">Visualizing 2P Responses to Stimulus</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualize_unit_spikes.html">Visualizing Neuronal Unit Spikes</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">First-Order Analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../first-order/receptive_fields.html">Showing Receptive Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="../first-order/optotagging.html">Identifying Optotagged Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../first-order/current_source_density.html">Current Source Density Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../first-order/classify_waveforms.html">Classifying Fast-Spiking and Regular-Spiking Neurons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../first-order/test_2p_responses.html">Statistically Testing 2P Responses to Stimulus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../first-order/suite2p.html">Identifying Regions of Interest with Segmentation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Higher-Order Analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../higher-order/cebra_time.html">Using CEBRA-Time to Identify Latent Embeddings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../higher-order/tca.html">Tensor Decomposition of Spiking Activity Through Trials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../higher-order/behavioral_state.html">Behavioral State from Trial Outcomes</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Openscope Experimental Projects</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../projects/cred_assign_figures.html">Replicating OpenScope Credit Assignment project figures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects/glo.html">OpenScope’s Global/Local Oddball Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects/illusion.html">OpenScope’s Illusion Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects/dendritic_coupling.html">OpenScope’s Dendritic Coupling Dataset</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Embargoed Datasets</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../embargoed/modality_alignment.html">Aligning Data across Modalities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../embargoed/visualize_behavior.html">Visualizing Behavioral Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../embargoed/test_2p_responses_embargoed.html">Statistically Testing 2P Responses to Stimulus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../embargoed/cell_matching.html">Cell Matching Across Days</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Methods</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../methods/jupyter_book.html">Jupyter/Jupyter Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methods/github.html">Git/Github</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methods/environments.html">Managing Environments on Multiple Platforms</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../contribution.html">Contributing to the Databook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors_index.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html">FAQ</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/AllenInstitute/openscope_databook/main?urlpath=tree/docs/visualization/visualize_2p_VR_behavior.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://hub.dandiarchive.org/hub/user-redirect/git-pull?repo=https%3A//github.com/AllenInstitute/openscope_databook&urlpath=tree/openscope_databook/docs/visualization/visualize_2p_VR_behavior.ipynb&branch=main" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on JupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="JupyterHub logo" src="../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/AllenInstitute/openscope_databook/blob/main/docs/visualization/visualize_2p_VR_behavior.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/AllenInstitute/openscope_databook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/AllenInstitute/openscope_databook/issues/new?title=Issue%20on%20page%20%2Fvisualization/visualize_2p_VR_behavior.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/visualization/visualize_2p_VR_behavior.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Visualize 2P and Behavioral Data for Mouse Decision-making Task During Virtual Navigation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-description">Dataset description</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#task-description">Task description</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#environment-setup">Environment Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-file">Download file</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#check-basic-information-about-this-session-and-the-animal">Check basic information about this session and the animal</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-more-on-lab-meta-data">[Optional] More on lab meta data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examine-behavioral-data-1-trial-level-information-and-behavioral-modeling-results">Examine behavioral data (1): trial level information and behavioral modeling results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examine-behavioral-data-2-trial-epoch">Examine behavioral data (2): trial epoch</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examine-behavioral-data-3-position-velocities-and-other-modeling-results">Examine behavioral data (3): position, velocities, and other modeling results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#positions-and-velocities">Positions and velocities</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#valid-trials">Valid trials</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#velocity-rnn-derived-variables-dynamic-choice-and-cue-biased-running">Velocity RNN-derived variables (dynamic choice and cue-biased running)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-of-behavioral-variables">Visualization of behavioral variables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#trial-type-averaged-plots">Trial-type averaged plots</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#useful-trick-easy-way-to-extract-epoch-information">Useful trick: easy way to extract epoch information</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examine-two-photon-calcium-imaging-data">Examine two-photon calcium imaging data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#information-about-neurons">Information about neurons</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-pixel-masks-for-neurons">Visualize pixel masks for neurons</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extract-neural-activity-df-f-and-deconvolved-activity">Extract neural activity (dF/F and deconvolved activity)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-of-neural-activity">Visualization  of neural activity</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combine-2p-imaging-and-behavioral-data">Combine 2P imaging and behavioral data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aligning-behavioral-timeseries-to-individual-imaging-plane">Aligning behavioral timeseries to individual imaging plane</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examine-trial-type-averaged-activity">Examine trial-type averaged activity</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#view-static-images">View static images</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="visualize-2p-and-behavioral-data-for-mouse-decision-making-task-during-virtual-navigation">
<h1>Visualize 2P and Behavioral Data for Mouse Decision-making Task During Virtual Navigation<a class="headerlink" href="#visualize-2p-and-behavioral-data-for-mouse-decision-making-task-during-virtual-navigation" title="Link to this heading">#</a></h1>
<p>In this notebook, we will demonstrate how to extract and visualize behavioral data and two-photon calcium imaging from an example file in the <a class="reference external" href="https://dandiarchive.org/dandiset/000579/0.230728.1727">Dandiset 000579</a> based on <span id="id1">[]</span>.</p>
<section id="dataset-description">
<h2>Dataset description<a class="headerlink" href="#dataset-description" title="Link to this heading">#</a></h2>
<p>The dataset contains calcium activity of &gt;200,000 neurons recorded from 6 different cortical areas in mouse posterior cortex L2/3 and L5 using two-photon imaging, including V1 and secondary visual areas (AM and PM), retrosplenial cortex (RSC) and posterior parietal cortex (visA and MM), while the mice were performing a flexible decision-making task based on rule-switching during virtual navigation. There are total 300 behavior + imaging sessions collected from 8 mice. The neurons in each experiment have been registered into the Allen Institute Mouse Common Coordinate Framework (CCF) based on widefield retinotopy. In addition, these neurons contain fluorescent labels of retroAAV injected in one of the two sets of projection targets: an anterior part of anterior cingulate cortex/secondary motor cortex (ACC/M2) and striatum, or a posterior part of ACC/M2 and orbitofrontal cortex (OFC).</p>
</section>
<section id="task-description">
<h2>Task description<a class="headerlink" href="#task-description" title="Link to this heading">#</a></h2>
<p>The mouse ran down a virtual Y-maze and used visual cues (black or white) on the wall to guide its choice (left or right) into one of the two maze arms. After the reaching the end of the arm, the mouse was presented with a feedback delay, followed by a visual feedback indicating the correctness of its choice, and then received reward for correct trials or entered inter-trial intervals for incorrect trials (shown in B). The rewarded associations between cue and choice are determined by two rules (rule A or rule B as indicated in A), and the rule switched in blocks of 100-175 trials without explicit signaling multiple times within a single session. The mouse’s performance usually dropped below chance level (fraction correct &lt; 0.5) and recovered to expert level after 30-50 trials after rule switches (shown in C).</p>
<p><img alt="virtual_navigation_schema.png" src="../data/images/virtual_navigation_schema.png" /></p>
<p>This notebook is modified from this <a class="reference external" href="https://github.com/sytseng/Tutorial_notebook_for_Dandiset_000579/blob/main/notebook/Tutorial_for_reading_NWB_files_from_Dandiset_000579.ipynb">tutorial</a>. For more information on this dataset, one can visit this <a class="reference external" href="https://github.com/sytseng/Tutorial_notebook_for_Dandiset_000579/tree/main">Github repository</a>, or a <a class="reference external" href="https://github.com/sytseng/GLM_Tensorflow_2">related repo</a> on fitting <strong>generalized linear models (GLM)</strong> to the data.</p>
</section>
<section id="environment-setup">
<h2>Environment Setup<a class="headerlink" href="#environment-setup" title="Link to this heading">#</a></h2>
<p>⚠️<strong>Note: If running on a new environment, run this cell once and then restart the kernel</strong>⚠️</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">databook_utils.dandi_utils</span> <span class="kn">import</span> <span class="n">dandi_download_open</span>
<span class="k">except</span><span class="p">:</span>
    <span class="o">!</span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/AllenInstitute/openscope_databook.git
    <span class="o">%</span><span class="k">cd</span> openscope_databook
    <span class="o">%</span><span class="k">pip</span> install -e .
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">zscore</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
</section>
<section id="download-file">
<h2>Download file<a class="headerlink" href="#download-file" title="Link to this heading">#</a></h2>
<p>We first download one example file from the dandiset, which contains the imaging and behavioral data for one session recorded in area A (visA).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dandiset_id</span> <span class="o">=</span> <span class="s2">&quot;000579&quot;</span>
<span class="n">dandi_filepath</span> <span class="o">=</span> <span class="s2">&quot;sub-9/sub-9_ses-mouse-9-session-date-2017-08-19-area-visA-L23-multi-plane-imaging_behavior+ophys.nwb&quot;</span>
<span class="n">download_loc</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">io</span> <span class="o">=</span> <span class="n">dandi_download_open</span><span class="p">(</span><span class="n">dandiset_id</span><span class="p">,</span> <span class="n">dandi_filepath</span><span class="p">,</span> <span class="n">download_loc</span><span class="p">)</span>
<span class="n">nwb</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>File already exists
Opening file
</pre></div>
</div>
</div>
</div>
</section>
<section id="check-basic-information-about-this-session-and-the-animal">
<h2>Check basic information about this session and the animal<a class="headerlink" href="#check-basic-information-about-this-session-and-the-animal" title="Link to this heading">#</a></h2>
<p>Let’s first examine some basic information about this session, including the session description, subject, surgery and virus injection sites.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># examine session information</span>
<span class="n">nwb</span><span class="o">.</span><span class="n">experiment_description</span><span class="p">,</span> <span class="n">nwb</span><span class="o">.</span><span class="n">session_id</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;Mouse performing a dynamic navigation task with calcium imaging in visA layer 2/3&#39;,
 &#39;mouse_9_session_date_2017-08-19_area_visA_L23_multi_plane_imaging&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># examine the subject information</span>
<span class="n">nwb</span><span class="o">.</span><span class="n">subject</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <style>
            .container-fields {
                font-family: "Open Sans", Arial, sans-serif;
            }
            .container-fields .field-value {
                color: #00788E;
            }
            .container-fields details > summary {
                cursor: pointer;
                display: list-item;
            }
            .container-fields details > summary:hover {
                color: #0A6EAA;
            }
        </style>
        
        <script>
            function copyToClipboard(text) {
                navigator.clipboard.writeText(text).then(function() {
                    console.log('Copied to clipboard: ' + text);
                }, function(err) {
                    console.error('Could not copy text: ', err);
                });
            }

            document.addEventListener('DOMContentLoaded', function() {
                let fieldKeys = document.querySelectorAll('.container-fields .field-key');
                fieldKeys.forEach(function(fieldKey) {
                    fieldKey.addEventListener('click', function() {
                        let accessCode = fieldKey.getAttribute('title').replace('Access code: ', '');
                        copyToClipboard(accessCode);
                    });
                });
            });
        </script>
        <div class='container-wrap'><div class='container-header'><div class='xr-obj-type'><h3>subject (Subject)</h3></div></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".age__reference">age__reference: </span><span class="field-value">birth</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".description">description: </span><span class="field-value">Mouse 9 Askin, date of arrival 2017-04-26 (~8 weeks old; date of birth is approximated), training started on 2017-06-01</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".genotype">genotype: </span><span class="field-value">wildtype</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".sex">sex: </span><span class="field-value">M</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".species">species: </span><span class="field-value">Mus musculus</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".subject_id">subject_id: </span><span class="field-value">9</span></div><details><summary style="display: list-item; margin-left: 0px;" class="container-fields field-key" title=".date_of_birth"><b>date_of_birth</b></summary><span class="field-key">2017-03-01 00:00:00-05:00</span></details><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".strain">strain: </span><span class="field-value">C57BL/6J</span></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># examine the surgery and virus information (areas and site coordinates)</span>
<span class="n">nwb</span><span class="o">.</span><span class="n">surgery</span><span class="p">,</span> <span class="n">nwb</span><span class="o">.</span><span class="n">virus</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;cranial window creation date:2017-05-25, 3.5 mm diameter, left posterior cortex; AAVretro injection date:2017-05-25; GCaMP6s injection date:2017-07-26; performed by Shih-Yi Tseng and Selmaan N. Chettih&#39;,
 &#39;AAV2/1-synapsin-GCaMP6s-WPRE-SV40 in left V1 x2 sites, PM x1, AM x1, MM x1, RSC x1, visA x2, 1/10 dilution, 70nl per site in L23 and 100nl per site in L5; AAV2retro-Syn-mTagBFP2 in left posterior ACC/M2 x4, undiluted, 300 nl per site, coordinate (mm from bregma): (0, L 0.35, D 0.4), (0, L 0.35, D 0.8), (0, L 0.7, D 0.3), (0, L 0.7, D 0.8); AAV2retro-Syn-mScarlet in left ORBvl x1, ORBl x1, 1/5 dilution, 500 nl per site, coordinate (mm from bregma): (A 2.65, L 0.85, D 1.8), (A 2.6, L 1.35, D 1.75)&#39;)
</pre></div>
</div>
</div>
</div>
<p>This mouse was implanted with a 3.5 mm craniel window over left posterior cortex. GCaMP6s was injected into 6 areas: V1, PM, AM, MM, RSC, A. In addition, these neurons contained retrograde fluorecent labels through AAVretro injection: mTagBFP2 for posterior ACC/M2 projecting neurons, and mScarlet for OFC projecting neurons.</p>
<p>The information about AAVretro injuection sites can also be found in the <code class="docutils literal notranslate"><span class="pre">lab_meta_data['harvey_lab_swac_metadata_session']</span></code> :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># examine the AAVretro injection site for mTagBFP2</span>
<span class="n">nwb</span><span class="o">.</span><span class="n">lab_meta_data</span><span class="p">[</span><span class="s1">&#39;harvey_lab_swac_metadata_session&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">AAVretroInjSite__mTagBFP2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;posterior_ACC_M2&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># examine the AAVretro injection site for mScarlet</span>
<span class="n">nwb</span><span class="o">.</span><span class="n">lab_meta_data</span><span class="p">[</span><span class="s1">&#39;harvey_lab_swac_metadata_session&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">AAVretroInjSite__mScarlet</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;OFC&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="optional-more-on-lab-meta-data">
<h2>[Optional] More on lab meta data<a class="headerlink" href="#optional-more-on-lab-meta-data" title="Link to this heading">#</a></h2>
<p>One can take a look at other data in the <code class="docutils literal notranslate"><span class="pre">lab_meta_data</span></code>. It contains information for <code class="docutils literal notranslate"><span class="pre">AAVretroInjSite</span></code>, <code class="docutils literal notranslate"><span class="pre">Imaging</span></code>, <code class="docutils literal notranslate"><span class="pre">Registration</span></code>, and <code class="docutils literal notranslate"><span class="pre">TaskParam</span></code>. Some of these would become useful in the later section, but there’s no need to go through all of them for the purpose of this demonstration.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># examine the lab meta data</span>
<span class="n">nwb</span><span class="o">.</span><span class="n">lab_meta_data</span><span class="p">[</span><span class="s1">&#39;harvey_lab_swac_metadata_session&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <style>
            .container-fields {
                font-family: "Open Sans", Arial, sans-serif;
            }
            .container-fields .field-value {
                color: #00788E;
            }
            .container-fields details > summary {
                cursor: pointer;
                display: list-item;
            }
            .container-fields details > summary:hover {
                color: #0A6EAA;
            }
        </style>
        
        <script>
            function copyToClipboard(text) {
                navigator.clipboard.writeText(text).then(function() {
                    console.log('Copied to clipboard: ' + text);
                }, function(err) {
                    console.error('Could not copy text: ', err);
                });
            }

            document.addEventListener('DOMContentLoaded', function() {
                let fieldKeys = document.querySelectorAll('.container-fields .field-key');
                fieldKeys.forEach(function(fieldKey) {
                    fieldKey.addEventListener('click', function() {
                        let accessCode = fieldKey.getAttribute('title').replace('Access code: ', '');
                        copyToClipboard(accessCode);
                    });
                });
            });
        </script>
        <div class='container-wrap'><div class='container-header'><div class='xr-obj-type'><h3>harvey_lab_swac_metadata_session (LabMetaDataSession)</h3></div></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".TaskParam__maze_stem_length">TaskParam__maze_stem_length: </span><span class="field-value">200.0</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".TaskParam__maze_stem_width">TaskParam__maze_stem_width: </span><span class="field-value">10.01</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".TaskParam__maze_arm_length">TaskParam__maze_arm_length: </span><span class="field-value">50.0</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".TaskParam__maze_arm_width">TaskParam__maze_arm_width: </span><span class="field-value">60.0</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".TaskParam__cue_delay_length">TaskParam__cue_delay_length: </span><span class="field-value">10.0</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".TaskParam__wall_height">TaskParam__wall_height: </span><span class="field-value">20.0</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".TaskParam__max_position">TaskParam__max_position: </span><span class="field-value">255.0</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".TaskParam__meter_per_virmen_unit">TaskParam__meter_per_virmen_unit: </span><span class="field-value">0.01</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".TaskParam__frac_non_visually_guided_trials">TaskParam__frac_non_visually_guided_trials: </span><span class="field-value">0.8</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".TaskParam__choice_bias_penalty">TaskParam__choice_bias_penalty: </span><span class="field-value">0.0</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".TaskParam__feedback_delay_sec">TaskParam__feedback_delay_sec: </span><span class="field-value">1.0</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".TaskParam__reward_delay_sec">TaskParam__reward_delay_sec: </span><span class="field-value">3.0</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".TaskParam__iti_correct_sec">TaskParam__iti_correct_sec: </span><span class="field-value">2.0</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".TaskParam__iti_incorrect_sec">TaskParam__iti_incorrect_sec: </span><span class="field-value">4.0</span></div><details><summary style="display: list-item; margin-left: 0px;" class="container-fields field-key" title=".TaskParam__switches"><b>TaskParam__switches</b></summary><div style="margin-left: 20px;" class="container-fields">[100 250]</div></details><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".TaskParam__initial_rule">TaskParam__initial_rule: </span><span class="field-value">B</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".AAVretroInjSite__mTagBFP2">AAVretroInjSite__mTagBFP2: </span><span class="field-value">posterior_ACC_M2</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".AAVretroInjSite__mScarlet">AAVretroInjSite__mScarlet: </span><span class="field-value">OFC</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".Imaging__imaging_type">Imaging__imaging_type: </span><span class="field-value">multi-plane</span></div><details><summary style="display: list-item; margin-left: 0px;" class="container-fields field-key" title=".Imaging__num_of_frame_per_volume"><b>Imaging__num_of_frame_per_volume</b></summary><span class="field-key">5</span></details><details><summary style="display: list-item; margin-left: 0px;" class="container-fields field-key" title=".Imaging__num_of_imaging_plane"><b>Imaging__num_of_imaging_plane</b></summary><span class="field-key">4</span></details><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".Imaging__cortical_layer">Imaging__cortical_layer: </span><span class="field-value">2/3</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".Registration__fov_center_area">Registration__fov_center_area: </span><span class="field-value">visA</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".Registration__fov_center_ml_ccf_mm">Registration__fov_center_ml_ccf_mm: </span><span class="field-value">-1.49755</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".Registration__fov_center_ap_ccf_mm">Registration__fov_center_ap_ccf_mm: </span><span class="field-value">-1.65221</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".Registration__fov_depth_mm">Registration__fov_depth_mm: </span><span class="field-value">0.115</span></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".Registration__fov_plane_step_size_mm">Registration__fov_plane_step_size_mm: </span><span class="field-value">0.025</span></div><details><summary style="display: list-item; margin-left: 0px;" class="container-fields field-key" title=".Registration__fov_to_ccf_transformation_matrix"><b>Registration__fov_to_ccf_transformation_matrix</b></summary><div style="margin-left: 20px;" class="container-fields">[[-1.28091964e-04 -1.46927372e-03 -1.08862203e+00]</br> [ 1.33139914e-03 -1.40467401e-04 -1.95708382e+00]</br> [ 0.00000000e+00  0.00000000e+00  1.00000000e+00]]</div></details></div></div></div>
</div>
</section>
<section id="examine-behavioral-data-1-trial-level-information-and-behavioral-modeling-results">
<h2>Examine behavioral data (1): trial level information and behavioral modeling results<a class="headerlink" href="#examine-behavioral-data-1-trial-level-information-and-behavioral-modeling-results" title="Link to this heading">#</a></h2>
<p>The task is divided into multiple trials, each of which is a single traversal through the virtual maze. The trial table in the nwb file contains basic information about these trials, including:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">start_time</span></code>: start time of this trial from session onset in second</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stop_time</span></code>: stop time of this trial from session onset in second</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_vis</span></code>: whether the trial was a visually guided trial, meaning that a visual landmark was present in the correct maze arm to guide the mouse’s choice in that trial (so the mouse didn’t need to use the rule to make the decision)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_ruleA</span></code>: whether the trial happened during rule A; rule A: Black-Left &amp; White-Right, rule B: White-Left &amp; Black-Right</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_switch</span></code>: whether a rule switch happened on the trial</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_cueB</span></code>: whether the trial had a black cue; True: black, False: white</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_choL</span></code>: whether the mouse made a left choice on the trial; True: left, False: right</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_correct</span></code>: whether the trial was correct</p></li>
</ul>
<p>In addition, you can also find information related to the strategy variable using trial history-based RNN models in the original paper (see <span id="id2">[]</span> for modeling details and the interpretation of these variables):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">association_mat</span></code>: behavioral LSTM predicted conditional probability; order: P(R|W), P(L|W), P(R|B), P(L|B)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rule_belief</span></code>: the rule belief on the trial; directionality: positive: rule B, negative: rule A</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">signed_bias</span></code>: the signed choice bias on the trial; directionality: positive: left bias, negative: right bias</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rule_following</span></code>: the rule-following on the trial; values between -0.5 ~ 0.5</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bias_following</span></code>: the bias-following on the trial; between -0.5 ~ 0.5</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prob_actual_cho</span></code>: the probability of actual choice on the trial, i.e. P(actual choice|actual cue)</p></li>
</ul>
<p>[<em>Not super relevant for now</em>] Other information relate the trial onset and offset time to the imaging frames:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">trial_onset_plane_frame_idx</span></code>: for each imaging plane, the frame index for this trial’s onset</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trial_offset_plane_frame_idx</span></code>: for each imaging plane, the frame index for this trial’s offset</p></li>
</ul>
<p>Let’s examine the trial table:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert trial table into dataframe and examine the first 10 trials</span>
<span class="n">trial_df</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">trials</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
<span class="n">trial_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>start_time</th>
      <th>stop_time</th>
      <th>is_vis</th>
      <th>is_ruleA</th>
      <th>is_switch</th>
      <th>is_cueB</th>
      <th>is_choL</th>
      <th>is_correct</th>
      <th>association_mat</th>
      <th>rule_belief</th>
      <th>signed_bias</th>
      <th>rule_following</th>
      <th>bias_following</th>
      <th>prob_actual_cho</th>
      <th>trial_onset_plane_frame_idx</th>
      <th>trial_offset_plane_frame_idx</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>30.16975</td>
      <td>42.57175</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>[0.6423881649971008, 0.35761183500289917, 0.68...</td>
      <td>-0.039975</td>
      <td>-0.324752</td>
      <td>0.019988</td>
      <td>-0.162376</td>
      <td>0.357612</td>
      <td>[120, 120, 120, 120, 120]</td>
      <td>[162, 162, 162, 162, 161]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>42.59525</td>
      <td>62.52375</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>[0.25210845470428467, 0.7478915452957153, 0.55...</td>
      <td>-0.302109</td>
      <td>0.193674</td>
      <td>-0.151054</td>
      <td>0.096837</td>
      <td>0.445783</td>
      <td>[195, 195, 195, 194, 194]</td>
      <td>[271, 271, 271, 271, 270]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>62.55600</td>
      <td>76.31175</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>[0.34659796953201294, 0.6534020304679871, 0.36...</td>
      <td>-0.018400</td>
      <td>0.288404</td>
      <td>0.009200</td>
      <td>0.144202</td>
      <td>0.653402</td>
      <td>[315, 314, 314, 314, 314]</td>
      <td>[365, 365, 364, 364, 364]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>76.33225</td>
      <td>89.94225</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>[0.17578017711639404, 0.8242198824882507, 0.37...</td>
      <td>-0.200315</td>
      <td>0.448125</td>
      <td>0.100158</td>
      <td>0.224062</td>
      <td>0.824220</td>
      <td>[397, 397, 397, 397, 396]</td>
      <td>[447, 446, 446, 446, 446]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>89.96525</td>
      <td>102.28325</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>[0.11006782203912735, 0.8899322152137756, 0.33...</td>
      <td>-0.225436</td>
      <td>0.554428</td>
      <td>0.112718</td>
      <td>0.277214</td>
      <td>0.889932</td>
      <td>[479, 479, 479, 478, 478]</td>
      <td>[521, 520, 520, 520, 520]</td>
    </tr>
    <tr>
      <th>5</th>
      <td>102.30225</td>
      <td>116.89625</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>[0.09064366668462753, 0.9093562960624695, 0.32...</td>
      <td>-0.238642</td>
      <td>0.580070</td>
      <td>0.119321</td>
      <td>0.290035</td>
      <td>0.909356</td>
      <td>[553, 553, 553, 552, 552]</td>
      <td>[608, 608, 608, 608, 607]</td>
    </tr>
    <tr>
      <th>6</th>
      <td>116.92150</td>
      <td>130.92075</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>[0.08119164407253265, 0.9188083410263062, 0.32...</td>
      <td>-0.247270</td>
      <td>0.590347</td>
      <td>0.123635</td>
      <td>0.295173</td>
      <td>0.918808</td>
      <td>[641, 640, 640, 640, 640]</td>
      <td>[692, 692, 692, 692, 692]</td>
    </tr>
    <tr>
      <th>7</th>
      <td>130.94750</td>
      <td>145.18525</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>[0.07719285786151886, 0.9228070974349976, 0.32...</td>
      <td>-0.251956</td>
      <td>0.593658</td>
      <td>0.125978</td>
      <td>-0.296829</td>
      <td>0.329149</td>
      <td>[725, 724, 724, 724, 724]</td>
      <td>[778, 778, 778, 777, 777]</td>
    </tr>
    <tr>
      <th>8</th>
      <td>145.20575</td>
      <td>157.87650</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>[0.28123414516448975, 0.7187658548355103, 0.65...</td>
      <td>-0.370872</td>
      <td>0.066660</td>
      <td>0.185436</td>
      <td>-0.033330</td>
      <td>0.652106</td>
      <td>[810, 810, 810, 810, 809]</td>
      <td>[854, 854, 854, 853, 853]</td>
    </tr>
    <tr>
      <th>9</th>
      <td>157.89500</td>
      <td>172.04675</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>[0.17769375443458557, 0.8223062753677368, 0.78...</td>
      <td>-0.608231</td>
      <td>0.036381</td>
      <td>0.304116</td>
      <td>0.018191</td>
      <td>0.822306</td>
      <td>[886, 886, 886, 886, 885]</td>
      <td>[939, 939, 939, 938, 938]</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s extract some information from the trial table.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># extract basic trial information</span>
<span class="n">cueB</span> <span class="o">=</span> <span class="n">trial_df</span><span class="p">[</span><span class="s1">&#39;is_cueB&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">choL</span> <span class="o">=</span> <span class="n">trial_df</span><span class="p">[</span><span class="s1">&#39;is_choL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">vis</span> <span class="o">=</span> <span class="n">trial_df</span><span class="p">[</span><span class="s1">&#39;is_vis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">ruleA</span> <span class="o">=</span> <span class="n">trial_df</span><span class="p">[</span><span class="s1">&#39;is_ruleA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">correctness</span> <span class="o">=</span> <span class="n">trial_df</span><span class="p">[</span><span class="s1">&#39;is_correct&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">switches</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">trial_df</span><span class="p">[</span><span class="s1">&#39;is_switch&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We can make a plot of task performance over the session using moving average, and see how the mouse’s task performance dropped after rule switches which recovered gradually after tens of trials.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get number of trials</span>
<span class="n">nTrials</span> <span class="o">=</span> <span class="n">cueB</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># compute moving average of correct for every 7 trials</span>
<span class="n">corr_moving_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">correctness</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">7</span><span class="p">,)</span><span class="o">/</span><span class="mi">7</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)</span>

<span class="c1"># generate plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nTrials</span><span class="p">),</span> <span class="n">corr_moving_avg</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;performance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">switches</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;rule switch&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">nTrials</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Trial number&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Fraction correct&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Task performance&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a747b45f645c9249b137a12ce0f1d507986512bc7c5afaa9a9991b4d1ef24126.png" src="../_images/a747b45f645c9249b137a12ce0f1d507986512bc7c5afaa9a9991b4d1ef24126.png" />
</div>
</div>
<p>We can also extract the information about trial history RNN-derived strategy variables and make plots.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># extract stratey variables</span>
<span class="n">association_mat</span> <span class="o">=</span> <span class="n">trial_df</span><span class="p">[</span><span class="s1">&#39;association_mat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">rule_belief</span> <span class="o">=</span> <span class="n">trial_df</span><span class="p">[</span><span class="s1">&#39;rule_belief&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">signed_bias</span> <span class="o">=</span> <span class="n">trial_df</span><span class="p">[</span><span class="s1">&#39;signed_bias&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">rule_following</span> <span class="o">=</span> <span class="n">trial_df</span><span class="p">[</span><span class="s1">&#39;rule_following&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">bias_following</span> <span class="o">=</span> <span class="n">trial_df</span><span class="p">[</span><span class="s1">&#39;bias_following&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">prob_actual_cho</span> <span class="o">=</span> <span class="n">trial_df</span><span class="p">[</span><span class="s1">&#39;prob_actual_cho&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make plots for strategy variables</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nTrials</span><span class="p">),</span> <span class="n">corr_moving_avg</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">switches</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nTrials</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">],</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Fraction correct&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Task performance&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nTrials</span><span class="p">),</span> <span class="n">prob_actual_cho</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">switches</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nTrials</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">],</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;P(actual choice|actual cue)&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Probability of actual choice&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nTrials</span><span class="p">),</span> <span class="n">rule_belief</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">switches</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nTrials</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Rule belief&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Rule belief&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nTrials</span><span class="p">),</span> <span class="n">signed_bias</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">switches</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nTrials</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;P(L)-P(R)&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Signed choice bias&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nTrials</span><span class="p">),</span> <span class="n">rule_following</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">switches</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nTrials</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Rule-following&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Rule-following&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nTrials</span><span class="p">),</span> <span class="n">bias_following</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">switches</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nTrials</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Trial number&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Bias-following&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Bias-following&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/88b2739ee337dc10937440a7d0840fcc1f156a60ce15cd9dc38189e0d373a0b0.png" src="../_images/88b2739ee337dc10937440a7d0840fcc1f156a60ce15cd9dc38189e0d373a0b0.png" />
</div>
</div>
<p>We can see that after each rule switch, the mouse’s choice bias (and bias-following) increased. As the task performance went back to stable performance, the mouse’s choice bias decreased, rule belief gradually reached the correct rule with an increase in rule-following. For more details on the interpretation of these strategy variables, please refer to the original paper.</p>
</section>
<section id="examine-behavioral-data-2-trial-epoch">
<h2>Examine behavioral data (2): trial epoch<a class="headerlink" href="#examine-behavioral-data-2-trial-epoch" title="Link to this heading">#</a></h2>
<p>Epochs within the trials are labeled in the epoch table, denoting the chunking of different phases of the each trials. One can find the <code class="docutils literal notranslate"><span class="pre">start_time</span></code>, <code class="docutils literal notranslate"><span class="pre">stop_time</span></code> (both in second), and associated <code class="docutils literal notranslate"><span class="pre">trial_id</span></code> of each epoch. Every trial can be parsed into 7 epoch types (not mutually excluded):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">maze</span></code>: when the mouse was in the maze, equals to <code class="docutils literal notranslate"><span class="pre">maze_stem</span></code> + <code class="docutils literal notranslate"><span class="pre">maze_arm</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">maze_stem</span></code>: when the mouse was in the maze stem</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">maze_arm</span></code>: when the mouse was in the maze arm</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">feedback_delay</span></code>: when the mouse was in the feedback delay period (lasted 1 second after it reached the end of the maze arm)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">feedback</span></code>: when the mouse was in the feedback period with the visual feedback in correct trials (lasted 2 seconds after feedback delay)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">iti</span></code>: when the mouse was in the intertrial interval (lasted 2 seconds for correct trials and 4 seconds for inccorect trials after feedback period)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">feedback_and_iti</span></code>: when the mouse was not in the maze, equals to <code class="docutils literal notranslate"><span class="pre">feedback_delay</span> <span class="pre">+</span> <span class="pre">feedback</span> <span class="pre">period</span> <span class="pre">+</span> <span class="pre">iti</span></code></p></li>
</ul>
<p><em>Note that although the epochs are annotated here, there are other ways to identify each epoch which would be aligned with the imaging frames (more useful for analyzing neural data). You will see that in the following section “Useful trick: easy way to extract epoch information” in the Behavior Processing Module.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert epoch table into dataframe and examine it</span>
<span class="n">epoch_df</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">epochs</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
<span class="n">epoch_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>start_time</th>
      <th>stop_time</th>
      <th>epoch_type</th>
      <th>trial_id</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>30.14325</td>
      <td>37.27825</td>
      <td>maze</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>30.14325</td>
      <td>35.61125</td>
      <td>maze_stem</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>35.63400</td>
      <td>37.27825</td>
      <td>maze_arm</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>37.29775</td>
      <td>38.28250</td>
      <td>feedback_delay</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>38.30750</td>
      <td>40.28075</td>
      <td>feedback</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>40.56550</td>
      <td>42.53775</td>
      <td>iti</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>37.29775</td>
      <td>42.53775</td>
      <td>feedback_and_iti</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>42.57175</td>
      <td>55.45550</td>
      <td>maze</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>42.57175</td>
      <td>53.10850</td>
      <td>maze_stem</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>53.12700</td>
      <td>55.45550</td>
      <td>maze_arm</td>
      <td>1</td>
    </tr>
    <tr>
      <th>10</th>
      <td>55.47100</td>
      <td>56.46500</td>
      <td>feedback_delay</td>
      <td>1</td>
    </tr>
    <tr>
      <th>11</th>
      <td>56.48075</td>
      <td>58.46150</td>
      <td>feedback</td>
      <td>1</td>
    </tr>
    <tr>
      <th>12</th>
      <td>58.49375</td>
      <td>62.49225</td>
      <td>iti</td>
      <td>1</td>
    </tr>
    <tr>
      <th>13</th>
      <td>55.47100</td>
      <td>62.49225</td>
      <td>feedback_and_iti</td>
      <td>1</td>
    </tr>
    <tr>
      <th>14</th>
      <td>62.52375</td>
      <td>71.05725</td>
      <td>maze</td>
      <td>2</td>
    </tr>
    <tr>
      <th>15</th>
      <td>62.52375</td>
      <td>68.51050</td>
      <td>maze_stem</td>
      <td>2</td>
    </tr>
    <tr>
      <th>16</th>
      <td>68.53000</td>
      <td>71.05725</td>
      <td>maze_arm</td>
      <td>2</td>
    </tr>
    <tr>
      <th>17</th>
      <td>71.08500</td>
      <td>72.08050</td>
      <td>feedback_delay</td>
      <td>2</td>
    </tr>
    <tr>
      <th>18</th>
      <td>72.10900</td>
      <td>74.07625</td>
      <td>feedback</td>
      <td>2</td>
    </tr>
    <tr>
      <th>19</th>
      <td>74.31000</td>
      <td>76.28700</td>
      <td>iti</td>
      <td>2</td>
    </tr>
    <tr>
      <th>20</th>
      <td>71.08500</td>
      <td>76.28700</td>
      <td>feedback_and_iti</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="examine-behavioral-data-3-position-velocities-and-other-modeling-results">
<h2>Examine behavioral data (3): position, velocities, and other modeling results<a class="headerlink" href="#examine-behavioral-data-3-position-velocities-and-other-modeling-results" title="Link to this heading">#</a></h2>
<p>In the <code class="docutils literal notranslate"><span class="pre">behavior</span></code> module under the <code class="docutils literal notranslate"><span class="pre">processing</span></code> module, we can find behavioral data related to the mouse’s position in the maze, their running velocities, as well as other behavioral modeling results described in <span id="id3">[]</span> quantifying the mouse’s moment-by-moment decision formation (dynamic choice) and cue embodiment process (cue-biase running). These processed behavioral variables are downsampled from 2000 Hz and <em>aligned to the two-photon calcium imaging frames</em> (sampled at 30 Hz), which is useful for analyzing neural data:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">frame_aligned_position</span></code>: Position object that contains the SpatialSeries for forward and lateral position in the maze aligned to imaging frames</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">frame_aligned_velocity</span></code>: BehavioralTimeSeries object that contains the Timeseries for velocity of the spherical treadmill (pitch, roll, yaw) aligned to imaging frames. For roll velocity, positive is left</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">velocity_RNN_prediction_for_choice_and_cue</span></code>: BehavioralTimeSeries object that contains the Timeseries for velocity RNN prediction for moment-by-moment choice and cue, in the order of 1. choice: decoded forward in time, aka dynamic choice, 2. choice: decoded reverse in time, 3. cue: decoded forward in time, aka cue-biased running, 4. cue: decoded reverse in time (see original paper <span id="id4">[]</span> for modeling details and the interpretation of these results)</p></li>
</ul>
<p>One find also find variables useful for aligning the imaging frames to trial information:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">frame_aligned_trial_number</span></code>: Timeseries for trial number aligned to imaging frames</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">frame_aligned_time_from_choice_point</span></code>: Timeseries for time elapsed (sec) from choice point (the end of maze) aligned to imaging frames; negative: in maze, positive: during feedback and ITI</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plane_idx_for_imaging_frames</span></code>: Timeseries for imaging plane index (for multi-plane imaging) of each imaging frame</p></li>
</ul>
<p>Let’s extract these variables:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># extract frame-aligned behavioral variables and insepct their shape</span>
<span class="n">imaging_frame_timestamps</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">processing</span><span class="p">[</span><span class="s1">&#39;behavior&#39;</span><span class="p">][</span><span class="s1">&#39;frame_aligned_position&#39;</span><span class="p">][</span><span class="s1">&#39;frame_aligned_forward_and_lateral_position&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">timestamps</span><span class="p">[:]</span>
<span class="n">frame_aligned_position</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">processing</span><span class="p">[</span><span class="s1">&#39;behavior&#39;</span><span class="p">][</span><span class="s1">&#39;frame_aligned_position&#39;</span><span class="p">][</span><span class="s1">&#39;frame_aligned_forward_and_lateral_position&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span>
<span class="n">frame_aligned_velocity</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">processing</span><span class="p">[</span><span class="s1">&#39;behavior&#39;</span><span class="p">][</span><span class="s1">&#39;frame_aligned_velocity&#39;</span><span class="p">][</span><span class="s1">&#39;frame_aligned_pitch_roll_yaw_velocity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span>
<span class="n">frame_aligned_trial_number</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">processing</span><span class="p">[</span><span class="s1">&#39;behavior&#39;</span><span class="p">][</span><span class="s1">&#39;frame_aligned_trial_number&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span>
<span class="n">frame_aligned_time_from_choice_point</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">processing</span><span class="p">[</span><span class="s1">&#39;behavior&#39;</span><span class="p">][</span><span class="s1">&#39;frame_aligned_time_from_choice_point&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span> 
<span class="n">plane_idx_for_imaging_frames</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">processing</span><span class="p">[</span><span class="s1">&#39;behavior&#39;</span><span class="p">][</span><span class="s1">&#39;plane_idx_for_imaging_frames&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span>

<span class="n">imaging_frame_timestamps</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">frame_aligned_position</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">frame_aligned_velocity</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">frame_aligned_trial_number</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">frame_aligned_time_from_choice_point</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((162480,), (162480, 2), (162480, 3), (162480,), (162480,))
</pre></div>
</div>
</div>
</div>
<section id="positions-and-velocities">
<h3>Positions and velocities<a class="headerlink" href="#positions-and-velocities" title="Link to this heading">#</a></h3>
<p>We can further separate forward and lateral positions from <code class="docutils literal notranslate"><span class="pre">frame_aligned_position</span></code>, and pitch, roll, yaw velocites from <code class="docutils literal notranslate"><span class="pre">frame_aligned_velocity</span></code>. Note that the forward and lateral positions are <code class="docutils literal notranslate"><span class="pre">nan</span></code> when the mice was in feedback period/ITI.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get forward and lateral positions</span>
<span class="n">posF</span> <span class="o">=</span> <span class="n">frame_aligned_position</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">posL</span> <span class="o">=</span> <span class="n">frame_aligned_position</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># get pitch, roll and yaw velocities</span>
<span class="n">pitch</span> <span class="o">=</span> <span class="n">frame_aligned_velocity</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">roll</span> <span class="o">=</span> <span class="n">frame_aligned_velocity</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">yaw</span> <span class="o">=</span> <span class="n">frame_aligned_velocity</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="valid-trials">
<h3>Valid trials<a class="headerlink" href="#valid-trials" title="Link to this heading">#</a></h3>
<p>Note that <code class="docutils literal notranslate"><span class="pre">frame_aligned_trial_number</span></code> contains some <code class="docutils literal notranslate"><span class="pre">nan</span></code> because the imaging acquisition started earlier than the onset of the task. Also, sometimes the trial number in <code class="docutils literal notranslate"><span class="pre">frame_aligned_trial_number</span></code> is not continuous because the imaging acquisition was stopped briefly (for ~10 trials) in the middle of the task for adjustment of FOV shifts due to the brain motion. (Not the case in this particular session)</p>
<p>One can find the “valid trials” in where corresponding imaging frames exist.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># identify valid trials (trials that have corresponding imaging frames)</span>
<span class="n">validTrials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">frame_aligned_trial_number</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">frame_aligned_trial_number</span><span class="p">)])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">nValidTrials</span> <span class="o">=</span> <span class="n">validTrials</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">nValidTrials</span><span class="p">,</span> <span class="n">nTrials</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(410, 410)
</pre></div>
</div>
</div>
</div>
</section>
<section id="velocity-rnn-derived-variables-dynamic-choice-and-cue-biased-running">
<h3>Velocity RNN-derived variables (dynamic choice and cue-biased running)<a class="headerlink" href="#velocity-rnn-derived-variables-dynamic-choice-and-cue-biased-running" title="Link to this heading">#</a></h3>
<p>The velocity RNN-decoded choice and cues (including dynamic choice and cue-biased running) were modeled at 6 Hz instead of 30 Hz, i.e. they were aligned to the 3rd plane of the 5 planes for multi-plane imaging sessions (or equivalently, the 3rd, 8rd, 13th, …etc. planes for single plane imaging sessinon). These variables also contain <code class="docutils literal notranslate"><span class="pre">nan</span></code> in trials where imaging data for the whole trials were not available (due to interruption of acquisition).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># extract velocity RNN-derived variables and timestamps</span>
<span class="n">RNNpred_timestamps</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">processing</span><span class="p">[</span><span class="s1">&#39;behavior&#39;</span><span class="p">][</span><span class="s1">&#39;velocity_RNN_prediction_for_choice_and_cue&#39;</span><span class="p">][</span><span class="s1">&#39;velocity_RNN_prediction_for_choice_and_cue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">timestamps</span><span class="p">[:]</span>
<span class="n">velocity_RNN_prediction</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">processing</span><span class="p">[</span><span class="s1">&#39;behavior&#39;</span><span class="p">][</span><span class="s1">&#39;velocity_RNN_prediction_for_choice_and_cue&#39;</span><span class="p">][</span><span class="s1">&#39;velocity_RNN_prediction_for_choice_and_cue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span>
<span class="n">dynamic_choice</span> <span class="o">=</span> <span class="n">velocity_RNN_prediction</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># dynamic choice is the choice predicted forward in time </span>
<span class="n">cue_bias_running</span> <span class="o">=</span> <span class="n">velocity_RNN_prediction</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># cue-biased running is the cue predicted forward in time </span>

<span class="n">RNNpred_timestamps</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dynamic_choice</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">cue_bias_running</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((32496,), (32496,), (32496,))
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualization-of-behavioral-variables">
<h3>Visualization of behavioral variables<a class="headerlink" href="#visualization-of-behavioral-variables" title="Link to this heading">#</a></h3>
<p>Let’s create some visualization for the behavioral data. Let’s first examine the raw timeseries.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t_start</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">t_end</span> <span class="o">=</span> <span class="mi">6000</span>
<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">9</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">imaging_frame_timestamps</span><span class="p">[</span><span class="n">t_start</span><span class="p">:</span><span class="n">t_end</span><span class="p">],</span><span class="n">frame_aligned_trial_number</span><span class="p">[</span><span class="n">t_start</span><span class="p">:</span><span class="n">t_end</span><span class="p">],</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;frame number&#39;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;trial number&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Trial number&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">imaging_frame_timestamps</span><span class="p">[</span><span class="n">t_start</span><span class="p">:</span><span class="n">t_end</span><span class="p">],</span><span class="n">posF</span><span class="p">[</span><span class="n">t_start</span><span class="p">:</span><span class="n">t_end</span><span class="p">],</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;frame number&#39;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;position (m)&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Forward position&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">imaging_frame_timestamps</span><span class="p">[</span><span class="n">t_start</span><span class="p">:</span><span class="n">t_end</span><span class="p">],</span><span class="n">posL</span><span class="p">[</span><span class="n">t_start</span><span class="p">:</span><span class="n">t_end</span><span class="p">],</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;frame number&#39;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;position (m)&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Lateral position&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">imaging_frame_timestamps</span><span class="p">[</span><span class="n">t_start</span><span class="p">:</span><span class="n">t_end</span><span class="p">],</span><span class="n">pitch</span><span class="p">[</span><span class="n">t_start</span><span class="p">:</span><span class="n">t_end</span><span class="p">],</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;frame number&#39;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;velocity (a.u.)&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Pitch velocity&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">imaging_frame_timestamps</span><span class="p">[</span><span class="n">t_start</span><span class="p">:</span><span class="n">t_end</span><span class="p">],</span><span class="n">roll</span><span class="p">[</span><span class="n">t_start</span><span class="p">:</span><span class="n">t_end</span><span class="p">],</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;frame number&#39;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;velocity (a.u.)&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Roll velocity&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">imaging_frame_timestamps</span><span class="p">[</span><span class="n">t_start</span><span class="p">:</span><span class="n">t_end</span><span class="p">],</span><span class="n">yaw</span><span class="p">[</span><span class="n">t_start</span><span class="p">:</span><span class="n">t_end</span><span class="p">],</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;frame number&#39;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;velocity (a.u.)&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Yaw velocity&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">imaging_frame_timestamps</span><span class="p">[</span><span class="n">t_start</span><span class="p">:</span><span class="n">t_end</span><span class="p">],</span><span class="n">frame_aligned_time_from_choice_point</span><span class="p">[</span><span class="n">t_start</span><span class="p">:</span><span class="n">t_end</span><span class="p">],</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;frame number&#39;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;time (sec)&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Time from choice point&#39;</span><span class="p">)</span>

<span class="c1"># velocity RNN-derived variables are sampled at 6 Hz instead of 30 Hz</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">RNNpred_timestamps</span><span class="p">[</span><span class="n">t_start</span><span class="o">//</span><span class="mi">5</span><span class="p">:</span><span class="n">t_end</span><span class="o">//</span><span class="mi">5</span><span class="p">],</span><span class="n">dynamic_choice</span><span class="p">[</span><span class="n">t_start</span><span class="o">//</span><span class="mi">5</span><span class="p">:</span><span class="n">t_end</span><span class="o">//</span><span class="mi">5</span><span class="p">],</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;frame number&#39;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;$P_</span><span class="si">{left}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Dynamic choice&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">RNNpred_timestamps</span><span class="p">[</span><span class="n">t_start</span><span class="o">//</span><span class="mi">5</span><span class="p">:</span><span class="n">t_end</span><span class="o">//</span><span class="mi">5</span><span class="p">],</span><span class="n">cue_bias_running</span><span class="p">[</span><span class="n">t_start</span><span class="o">//</span><span class="mi">5</span><span class="p">:</span><span class="n">t_end</span><span class="o">//</span><span class="mi">5</span><span class="p">],</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;frame number&#39;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;$P_</span><span class="si">{black}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Cue-biased running&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/c7419458041bc508d6bd51303a5689eea2a17a1607a871b1844bcb7592322ce9.png" src="../_images/c7419458041bc508d6bd51303a5689eea2a17a1607a871b1844bcb7592322ce9.png" />
</div>
</div>
</section>
<section id="trial-type-averaged-plots">
<h3>Trial-type averaged plots<a class="headerlink" href="#trial-type-averaged-plots" title="Link to this heading">#</a></h3>
<p>To make trial-type average plots of these behavioral variables, we can first extract some useful task variables from <code class="docutils literal notranslate"><span class="pre">lab_meta_data</span></code>. The length of maze configuration is multiplied by 0.01 (the value of <code class="docutils literal notranslate"><span class="pre">meter_per_virmen_unit</span></code>) to convert from Virmen unit to meter (to be consistent with the measured position).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## extract important task parameters from lab meta data</span>
<span class="c1"># maze configuration</span>
<span class="n">meter_per_virmen_unit</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">lab_meta_data</span><span class="p">[</span><span class="s1">&#39;harvey_lab_swac_metadata_session&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">TaskParam__meter_per_virmen_unit</span> <span class="c1"># 1 Virmen unit in the maze ~= 0.01 m</span>
<span class="n">stem_length</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">lab_meta_data</span><span class="p">[</span><span class="s1">&#39;harvey_lab_swac_metadata_session&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">TaskParam__maze_stem_length</span><span class="o">*</span><span class="n">meter_per_virmen_unit</span>
<span class="n">arm_length</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">lab_meta_data</span><span class="p">[</span><span class="s1">&#39;harvey_lab_swac_metadata_session&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">TaskParam__maze_arm_length</span><span class="o">*</span><span class="n">meter_per_virmen_unit</span>

<span class="c1"># the length of the cue delay before the maze arms (useful if you&#39;re analyzing visual response to the cue)</span>
<span class="n">cue_delay_length</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">lab_meta_data</span><span class="p">[</span><span class="s1">&#39;harvey_lab_swac_metadata_session&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">TaskParam__cue_delay_length</span><span class="o">*</span><span class="n">meter_per_virmen_unit</span>

<span class="c1"># the length of the feedback delay in seconds</span>
<span class="n">feedback_delay</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">lab_meta_data</span><span class="p">[</span><span class="s1">&#39;harvey_lab_swac_metadata_session&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">TaskParam__feedback_delay_sec</span>

<span class="c1"># the length of the reward delay in seconds (equals length of the feedback delay + feedback period)</span>
<span class="n">reward_delay</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">lab_meta_data</span><span class="p">[</span><span class="s1">&#39;harvey_lab_swac_metadata_session&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">TaskParam__reward_delay_sec</span>

<span class="c1"># the length of ITI for correct and incorrect trials</span>
<span class="n">iti_correct</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">lab_meta_data</span><span class="p">[</span><span class="s1">&#39;harvey_lab_swac_metadata_session&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">TaskParam__iti_correct_sec</span>
<span class="n">iti_incorrect</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">lab_meta_data</span><span class="p">[</span><span class="s1">&#39;harvey_lab_swac_metadata_session&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">TaskParam__iti_incorrect_sec</span>
</pre></div>
</div>
</div>
</div>
<p>Next we created position (in the maze) and temporally-binned (in feedback/ITI) velocity, such as roll velocity, for every valid trial.</p>
<p>First we define a function for binning:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define utility function for position and temporal binning (of single trials)</span>
<span class="k">def</span> <span class="nf">pos_tm_binning</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">posF</span><span class="p">,</span> <span class="n">time_from_cho</span><span class="p">,</span> <span class="n">pos_centers</span><span class="p">,</span> <span class="n">pos_half_width</span><span class="p">,</span> <span class="n">tm_centers</span><span class="p">,</span> <span class="n">tm_half_width</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Bin input X by positions and time</span>

<span class="sd">    Input parameters::</span>
<span class="sd">    X: variable for binning, ndarray</span>
<span class="sd">    posF: position for each point in X, ndarray of shape (X.shape[0],)</span>
<span class="sd">    time_from_cho: time from choice point for each point in X, ndarray of shape (X.shape[0],)</span>
<span class="sd">    pos_centers: center locations for position bins, ndarray</span>
<span class="sd">    pos_half_width: half width of position center, float</span>
<span class="sd">    tm_centers: center locations for time bins, ndarray</span>
<span class="sd">    tm_half_width: half width of time bins, float</span>

<span class="sd">    Returns:</span>
<span class="sd">    X_pos: position-binned X, ndarray of shape (n_pos_bins, X.shape[1])</span>
<span class="sd">    X_tm: time-binned X, ndarray of shape (n_tm_bins, X.shape[1])</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Sanity check and prelocate</span>
    <span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">X_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">pos_centers</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
    <span class="n">X_tm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">tm_centers</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
    
    <span class="c1"># Calculate position-binned X</span>
    <span class="k">for</span> <span class="n">pos_ind</span><span class="p">,</span> <span class="n">pos_cent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pos_centers</span><span class="p">):</span>
        <span class="n">these_frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">posF</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">pos_cent</span> <span class="o">-</span> <span class="n">pos_half_width</span><span class="p">),</span> <span class="n">posF</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">pos_cent</span> <span class="o">+</span> <span class="n">pos_half_width</span><span class="p">))</span>
        <span class="n">X_pos</span><span class="p">[</span><span class="n">pos_ind</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">these_frames</span><span class="p">,:],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Calculate time-binned X  </span>
    <span class="k">for</span> <span class="n">tm_ind</span><span class="p">,</span> <span class="n">tm_cent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tm_centers</span><span class="p">):</span>
        <span class="n">these_frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">time_from_cho</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">tm_cent</span> <span class="o">-</span> <span class="n">tm_half_width</span><span class="p">),</span> <span class="n">time_from_cho</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">tm_cent</span> <span class="o">+</span> <span class="n">tm_half_width</span><span class="p">))</span>
        <span class="n">X_tm</span><span class="p">[</span><span class="n">tm_ind</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">these_frames</span><span class="p">,:],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">X_pos</span><span class="p">,</span> <span class="n">X_tm</span>
</pre></div>
</div>
</div>
</div>
<p>We then perform spatial and temporal binning for roll velocity for all valid trials as an example (one can process the pitch and yaw velocities as well as dynamic choice and cue-biased running the same way):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## perform spatial and temporal binning for roll velocity for all valid trials</span>
<span class="c1"># select roll velocity</span>
<span class="n">this_vel</span> <span class="o">=</span> <span class="n">roll</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># set up position bins</span>
<span class="n">pos_half_width</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">maze_length</span> <span class="o">=</span> <span class="p">(</span><span class="n">stem_length</span> <span class="o">+</span> <span class="n">arm_length</span><span class="p">)</span>
<span class="n">pos_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">maze_length</span> <span class="o">+</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">pos_half_width</span><span class="p">)</span>

<span class="c1"># set up time bins</span>
<span class="n">tm_half_width</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span>
<span class="n">feedback_iti_corr_length</span> <span class="o">=</span> <span class="n">reward_delay</span> <span class="o">+</span> <span class="n">iti_correct</span>
<span class="n">tm_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">feedback_iti_corr_length</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">tm_half_width</span><span class="p">)</span>

<span class="c1"># prelocate</span>
<span class="n">vel_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">nValidTrials</span><span class="p">,</span> <span class="n">pos_bins</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
<span class="n">vel_tm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">nValidTrials</span><span class="p">,</span> <span class="n">tm_bins</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
                             
<span class="c1"># loop over trials for binning</span>
<span class="k">for</span> <span class="n">i_trial</span><span class="p">,</span> <span class="n">this_trial</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">validTrials</span><span class="p">):</span>
    <span class="n">these_frames</span> <span class="o">=</span> <span class="n">frame_aligned_trial_number</span><span class="o">==</span><span class="n">this_trial</span>
    <span class="n">this_pos</span><span class="p">,</span> <span class="n">this_tm</span> <span class="o">=</span> <span class="n">pos_tm_binning</span><span class="p">(</span><span class="n">this_vel</span><span class="p">[</span><span class="n">these_frames</span><span class="p">],</span> <span class="n">posF</span><span class="p">[</span><span class="n">these_frames</span><span class="p">],</span> <span class="n">frame_aligned_time_from_choice_point</span><span class="p">[</span><span class="n">these_frames</span><span class="p">],</span> 
                                       <span class="n">pos_bins</span><span class="p">,</span> <span class="n">pos_half_width</span><span class="p">,</span> <span class="n">tm_bins</span><span class="p">,</span> <span class="n">tm_half_width</span><span class="p">)</span>
    <span class="n">vel_pos</span><span class="p">[</span><span class="n">i_trial</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">this_pos</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">vel_tm</span><span class="p">[</span><span class="n">i_trial</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">this_tm</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    

<span class="c1"># find cue and choice for valid trials</span>
<span class="n">cue_valid</span> <span class="o">=</span> <span class="n">cueB</span><span class="p">[</span><span class="n">validTrials</span><span class="p">]</span>
<span class="n">cho_valid</span> <span class="o">=</span> <span class="n">choL</span><span class="p">[</span><span class="n">validTrials</span><span class="p">]</span>
<span class="n">trial_type</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">cue_valid</span> <span class="o">+</span> <span class="n">cho_valid</span>
<span class="n">trial_type_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;white-right&#39;</span><span class="p">,</span><span class="s1">&#39;white-left&#39;</span><span class="p">,</span><span class="s1">&#39;black-right&#39;</span><span class="p">,</span> <span class="s1">&#39;black-left&#39;</span><span class="p">]</span>
<span class="n">trial_type_color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pink&#39;</span><span class="p">,</span><span class="s1">&#39;skyblue&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Then we can generate plots for average roll velocity for each of the four trial types: white-right, white-left, black-right, and black-left.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot average roll velocity (mean+-SEM)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i_type</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">this_mean_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">vel_pos</span><span class="p">[</span><span class="n">trial_type</span><span class="o">==</span><span class="n">i_type</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">this_sem_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">vel_pos</span><span class="p">[</span><span class="n">trial_type</span><span class="o">==</span><span class="n">i_type</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">trial_type</span><span class="o">==</span><span class="n">i_type</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pos_bins</span><span class="p">,</span> <span class="n">this_mean_pos</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">trial_type_color</span><span class="p">[</span><span class="n">i_type</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">pos_bins</span><span class="p">,</span> <span class="n">this_mean_pos</span><span class="o">-</span><span class="n">this_sem_pos</span><span class="p">,</span> <span class="n">this_mean_pos</span><span class="o">+</span><span class="n">this_sem_pos</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">trial_type_color</span><span class="p">[</span><span class="n">i_type</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>       

    <span class="n">this_mean_tm</span> <span class="o">=</span> <span class="n">vel_tm</span><span class="p">[</span><span class="n">trial_type</span><span class="o">==</span><span class="n">i_type</span><span class="p">,:]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">this_sem_tm</span> <span class="o">=</span> <span class="n">vel_tm</span><span class="p">[</span><span class="n">trial_type</span><span class="o">==</span><span class="n">i_type</span><span class="p">,:]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">trial_type</span><span class="o">==</span><span class="n">i_type</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tm_bins</span><span class="p">,</span> <span class="n">this_mean_tm</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">trial_type_color</span><span class="p">[</span><span class="n">i_type</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">trial_type_name</span><span class="p">[</span><span class="n">i_type</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">tm_bins</span><span class="p">,</span> <span class="n">this_mean_tm</span><span class="o">-</span><span class="n">this_sem_tm</span><span class="p">,</span> <span class="n">this_mean_tm</span><span class="o">+</span><span class="n">this_sem_tm</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">trial_type_color</span><span class="p">[</span><span class="n">i_type</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">y1_min</span><span class="p">,</span> <span class="n">y1_max</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
<span class="n">y2_min</span><span class="p">,</span> <span class="n">y2_max</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">stem_length</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">y1_min</span><span class="p">,</span><span class="n">y2_min</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">y1_max</span><span class="p">,</span><span class="n">y2_max</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;stem end&#39;</span><span class="p">)</span> 
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">y1_min</span><span class="p">,</span><span class="n">y2_min</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">y1_max</span><span class="p">,</span><span class="n">y2_max</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;stem end&#39;</span><span class="p">)</span> 
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">feedback_delay</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">y1_min</span><span class="p">,</span><span class="n">y2_min</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">y1_max</span><span class="p">,</span><span class="n">y2_max</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;feedback&#39;</span><span class="p">)</span>  
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">reward_delay</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">y1_min</span><span class="p">,</span><span class="n">y2_min</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">y1_max</span><span class="p">,</span><span class="n">y2_max</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;reward&#39;</span><span class="p">)</span> 
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">y1_min</span><span class="p">,</span><span class="n">y2_min</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">y1_max</span><span class="p">,</span><span class="n">y2_max</span><span class="p">))],</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">2.5</span><span class="p">],</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Position in maze (m)&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Velocity (a.u.)&#39;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;maze traversal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">y1_min</span><span class="p">,</span><span class="n">y2_min</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">y1_max</span><span class="p">,</span><span class="n">y2_max</span><span class="p">))],</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Time (sec)&#39;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;feedback/ITI&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3f9d95261f00a58deac0ea0f43021a32da74e9e864fe8c7d60e77faf652eb1c4.png" src="../_images/3f9d95261f00a58deac0ea0f43021a32da74e9e864fe8c7d60e77faf652eb1c4.png" />
</div>
</div>
<p>We can see that the mouse’s running trajectories for left and right trials diverged early in the maze before the intersection (stem end). On top of that, the mouse also ran differently for trials with black vs. white cue, described as cue-biased running.</p>
<p>We can also plot traces for individual trials on top of the average to see the trial-by-trial variability:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot average roll velocity with single trial traces</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i_trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nValidTrials</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pos_bins</span><span class="p">,</span> <span class="n">vel_pos</span><span class="p">[</span><span class="n">i_trial</span><span class="p">,:],</span> <span class="n">color</span><span class="o">=</span><span class="n">trial_type_color</span><span class="p">[</span><span class="n">trial_type</span><span class="p">[</span><span class="n">i_trial</span><span class="p">]],</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tm_bins</span><span class="p">,</span> <span class="n">vel_tm</span><span class="p">[</span><span class="n">i_trial</span><span class="p">,:],</span> <span class="n">color</span><span class="o">=</span><span class="n">trial_type_color</span><span class="p">[</span><span class="n">trial_type</span><span class="p">[</span><span class="n">i_trial</span><span class="p">]],</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    
<span class="k">for</span> <span class="n">i_type</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">this_mean_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">vel_pos</span><span class="p">[</span><span class="n">trial_type</span><span class="o">==</span><span class="n">i_type</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pos_bins</span><span class="p">,</span> <span class="n">this_mean_pos</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">trial_type_color</span><span class="p">[</span><span class="n">i_type</span><span class="p">])</span>    
    <span class="n">this_mean_tm</span> <span class="o">=</span> <span class="n">vel_tm</span><span class="p">[</span><span class="n">trial_type</span><span class="o">==</span><span class="n">i_type</span><span class="p">,:]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tm_bins</span><span class="p">,</span> <span class="n">this_mean_tm</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">trial_type_color</span><span class="p">[</span><span class="n">i_type</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">trial_type_name</span><span class="p">[</span><span class="n">i_type</span><span class="p">])</span>

<span class="n">y1_min</span><span class="p">,</span> <span class="n">y1_max</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
<span class="n">y2_min</span><span class="p">,</span> <span class="n">y2_max</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">stem_length</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">y1_min</span><span class="p">,</span><span class="n">y2_min</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">y1_max</span><span class="p">,</span><span class="n">y2_max</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;stem end&#39;</span><span class="p">)</span> 
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">y1_min</span><span class="p">,</span><span class="n">y2_min</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">y1_max</span><span class="p">,</span><span class="n">y2_max</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;stem end&#39;</span><span class="p">)</span> 
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">feedback_delay</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">y1_min</span><span class="p">,</span><span class="n">y2_min</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">y1_max</span><span class="p">,</span><span class="n">y2_max</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;feedback&#39;</span><span class="p">)</span>  
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">reward_delay</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">y1_min</span><span class="p">,</span><span class="n">y2_min</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">y1_max</span><span class="p">,</span><span class="n">y2_max</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;reward&#39;</span><span class="p">)</span> 
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">y1_min</span><span class="p">,</span><span class="n">y2_min</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">y1_max</span><span class="p">,</span><span class="n">y2_max</span><span class="p">))],</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">2.5</span><span class="p">],</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Position in maze (m)&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Velocity (a.u.)&#39;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;maze traversal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">y1_min</span><span class="p">,</span><span class="n">y2_min</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">y1_max</span><span class="p">,</span><span class="n">y2_max</span><span class="p">))],</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Time (sec)&#39;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;feedback/ITI&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/30d17a5df399259163370da0d0a1331c61fa2e4fcad17e11729064617e3f0f53.png" src="../_images/30d17a5df399259163370da0d0a1331c61fa2e4fcad17e11729064617e3f0f53.png" />
</div>
</div>
</section>
</section>
<section id="useful-trick-easy-way-to-extract-epoch-information">
<h2>Useful trick: easy way to extract epoch information<a class="headerlink" href="#useful-trick-easy-way-to-extract-epoch-information" title="Link to this heading">#</a></h2>
<p>As we see a little bit in the binning function, using these frame aligned behavioral variables, we can find the imaging frames corresponding to each epoch easily (instead of using time interval information from trial table and epoch table):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># find corresponding imaging frames for different epochs</span>
<span class="n">maze_stem_frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">posF</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">posF</span> <span class="o">&lt;</span> <span class="n">stem_length</span><span class="p">)</span>
<span class="n">maze_arm_frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">posF</span> <span class="o">&gt;=</span> <span class="n">stem_length</span><span class="p">,</span> <span class="n">posF</span> <span class="o">&lt;=</span> <span class="n">maze_length</span><span class="p">)</span>
<span class="n">maze_frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">posF</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">posF</span> <span class="o">&lt;=</span> <span class="n">maze_length</span><span class="p">)</span>
<span class="n">feedback_delay_frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">frame_aligned_time_from_choice_point</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">frame_aligned_time_from_choice_point</span> <span class="o">&lt;</span> <span class="n">feedback_delay</span><span class="p">)</span>
<span class="n">feedback_frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">frame_aligned_time_from_choice_point</span> <span class="o">&gt;=</span> <span class="n">feedback_delay</span><span class="p">,</span> <span class="n">frame_aligned_time_from_choice_point</span> <span class="o">&lt;</span> <span class="n">reward_delay</span><span class="p">)</span>
<span class="n">iti_frames</span> <span class="o">=</span> <span class="n">frame_aligned_time_from_choice_point</span> <span class="o">&gt;=</span> <span class="n">reward_delay</span>
</pre></div>
</div>
</div>
</div>
<p>We can also restrict on a particular trial:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># find corresponding imaging frames for maze stem during trial 0 </span>
<span class="n">this_trial</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">this_trial_maze_stem_frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">maze_stem_frames</span><span class="p">,</span> <span class="n">frame_aligned_trial_number</span><span class="o">==</span><span class="n">this_trial</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="examine-two-photon-calcium-imaging-data">
<h2>Examine two-photon calcium imaging data<a class="headerlink" href="#examine-two-photon-calcium-imaging-data" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">ophys</span></code> module in the <code class="docutils literal notranslate"><span class="pre">processing</span></code> module of the nwb file contains data for two-photon calcium imaging, including ImageSegmentation (with neuron information in each imaging planes), deconvolved activity and dF/F. The static GCaMP/retrograde images for each imaging planes, and the vessel pattern image of this FOV taken at the top of the brain, are also included in this module.</p>
<section id="information-about-neurons">
<h3>Information about neurons<a class="headerlink" href="#information-about-neurons" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">ImageSegmentation</span></code> under the ophys processing module contains <code class="docutils literal notranslate"><span class="pre">PlaneSegmentation</span></code> objects for each imaging plane (4 planes for multi-plane imaging sessions and 1 plane for single plane imaging session). Within each <code class="docutils literal notranslate"><span class="pre">PlaneSegmentation</span></code>, one can find information about each neuron recorded from this plane:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ml</span></code>: the coordinate along medial-lateral axis in minimeters after registration into Allen Institute’s Mouse Common Coordinate Framework (CCF)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ap</span></code>: the coordinate along anterior-posterior axis in minimeters in CCF</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">depth</span></code>: the depth underneath the pia in minimeters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">area</span></code>: one of the 6 discrete cortical areas that this neuron resided in</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mTagBFP2</span></code>: whether this neuron was labeled with mTagBFP2 (see the AAVretro injection site to know which area this neuron projected to)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mScarlet</span></code>: whether this neuron was labeled with mScarlet</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pixel_mask</span></code>: the pixel mask (spatial footprint) of this neuron, in the format of [x, y, pixel intesnity] in the raw images (512 x 512)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># view content of ImageSegmentation</span>
<span class="n">nwb</span><span class="o">.</span><span class="n">processing</span><span class="p">[</span><span class="s1">&#39;ophys&#39;</span><span class="p">][</span><span class="s1">&#39;ImageSegmentation&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <style>
            .container-fields {
                font-family: "Open Sans", Arial, sans-serif;
            }
            .container-fields .field-value {
                color: #00788E;
            }
            .container-fields details > summary {
                cursor: pointer;
                display: list-item;
            }
            .container-fields details > summary:hover {
                color: #0A6EAA;
            }
        </style>
        
        <script>
            function copyToClipboard(text) {
                navigator.clipboard.writeText(text).then(function() {
                    console.log('Copied to clipboard: ' + text);
                }, function(err) {
                    console.error('Could not copy text: ', err);
                });
            }

            document.addEventListener('DOMContentLoaded', function() {
                let fieldKeys = document.querySelectorAll('.container-fields .field-key');
                fieldKeys.forEach(function(fieldKey) {
                    fieldKey.addEventListener('click', function() {
                        let accessCode = fieldKey.getAttribute('title').replace('Access code: ', '');
                        copyToClipboard(accessCode);
                    });
                });
            });
        </script>
        <div class='container-wrap'><div class='container-header'><div class='xr-obj-type'><h3>ImageSegmentation</h3></div></div><details><summary style="display: list-item; margin-left: 0px;" class="container-fields field-key" title=".plane_segmentations"><b>plane_segmentations</b></summary><details><summary style="display: list-item; margin-left: 20px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_0']"><b>PlaneSegmentation_0</b></summary><div style="margin-left: 40px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_0']">description: </span><span class="field-value">Plane segmentation of imagine plane 0</span></div><details><summary style="display: list-item; margin-left: 40px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_0']"><b>imaging_plane</b></summary><details><summary style="display: list-item; margin-left: 60px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_0'].optical_channel"><b>optical_channel</b></summary><details><summary style="display: list-item; margin-left: 80px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_0'].optical_channel[0]"><b>0</b></summary><div style="margin-left: 100px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_0'].optical_channel[0].description">description: </span><span class="field-value">optical channel for GCaMP</span></div><div style="margin-left: 100px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_0'].optical_channel[0].emission_lambda">emission_lambda: </span><span class="field-value">525.0</span></div></details></details><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_0'].description">description: </span><span class="field-value">volume calcium imaging in visA layer 2/3</span></div><details><summary style="display: list-item; margin-left: 60px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_0'].device"><b>device</b></summary><div style="margin-left: 80px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_0'].device.description">description: </span><span class="field-value">Two-photon microscope</span></div><div style="margin-left: 80px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_0'].device.manufacturer">manufacturer: </span><span class="field-value">Harvey Lab custom-bulit two-photon microscope (Odin)</span></div></details><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_0'].excitation_lambda">excitation_lambda: </span><span class="field-value">920.0</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_0'].imaging_rate">imaging_rate: </span><span class="field-value">30.0</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_0'].indicator">indicator: </span><span class="field-value">GCaMP6s</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_0'].location">location: </span><span class="field-value">visA</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_0'].conversion">conversion: </span><span class="field-value">1.0</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_0'].unit">unit: </span><span class="field-value">meters</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_0'].reference_frame">reference_frame: </span><span class="field-value">[p->a, l->m, depth from pia] in minimeters from bregma in Allen Institute Mouse Common Coordinate Framework (CCF); i.e. directionality of the imaging FOV: x-axis: posterior to anterior; y-axis: laterl (left) to medial (right); however, the FOV axes does not run parallelly to the CCF coordinate system. The following transformation matrix can be applied to a column vector of pixel coordinate ([x,y,1].T) to [ml, ap, _] in mm in CCF: np.array([[-0.000128,-0.001469,-1.088622],[0.001331,-0.000140,-1.957084],[0.000000,0.000000,1.000000]])</span></div></details><details><summary style="display: list-item; margin-left: 40px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_0']"><b>table</b></summary><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ml</th>
      <th>ap</th>
      <th>depth</th>
      <th>area</th>
      <th>mTagBFP2</th>
      <th>mScarlet</th>
      <th>pixel_mask</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-1.83153</td>
      <td>-1.67308</td>
      <td>0.115</td>
      <td>A</td>
      <td>True</td>
      <td>False</td>
      <td>[[483, 258, 91007.11], [482, 259, 157956.42], [483, 259, 247654.84], [484, 259, 175354.88], [481, 260, 169253.83], [482, 260, 328937.47], [483, 260, 380361.25], [484, 260, 342891.0], [485, 260, 156837.55], [480, 261, 139835.08], [481, 261, 320548.3], [482, 261, 328538.8], [483, 261, 284250.38], [484, 261, 272464.12], [485, 261, 263009.78], [486, 261, 114113.06], [479, 262, 130135.49], [480, 262, 350195.44], [481, 262, 344748.8], [482, 262, 263407.06], [483, 262, 228751.84], [484, 262, 207297.28], [485, 262, 223281.47], [486, 262, 214495.58], [479, 263, 270379.03], [480, 263, 450994.62], [481, 263, 325501.34], [482, 263, 261987.56], [483, 263, 233517.36], [484, 263, 214340.12], [485, 263, 202163.22], [486, 263, 230735.47], [479, 264, 326150.06], [480, 264, 476270.56], [481, 264, 333029.28], [482, 264, 265543.38], [483, 264, 236059.42], [484, 264, 218495.77], [485, 264, 204481.16], [486, 264, 268010.78], [487, 264, 129516.695], [478, 265, 109774.41], [479, 265, 310635.3], [480, 265, 478236.94], [481, 265, 377786.2], [482, 265, 281787.9], [483, 265, 253100.7], [484, 265, 228369.28], [485, 265, 223610.05], [486, 265, 330142.8], [487, 265, 157617.06], [479, 266, 166514.53], [480, 266, 430299.75], [481, 266, 460057.44], [482, 266, 308356.97], [483, 266, 276319.9], [484, 266, 262071.53], [485, 266, 282850.75], [486, 266, 351484.25], [480, 267, 223096.55], [481, 267, 472413.94], [482, 267, 400318.12], [483, 267, 341142.75], [484, 267, 350033.25], [485, 267, 394185.56], [486, 267, 239445.08], [481, 268, 215518.58], [482, 268, 379879.94], [483, 268, 439134.2], [484, 268, 445183.56], [485, 268, 331286.72], [482, 269, 100239.83], [483, 269, 223852.78], [484, 269, 204007.98]]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-1.81635</td>
      <td>-1.72861</td>
      <td>0.115</td>
      <td>A</td>
      <td>False</td>
      <td>True</td>
      <td>[[475, 217, 11779.721], [476, 217, 21893.092], [477, 217, 23192.68], [478, 217, 18077.207], [474, 218, 27621.184], [475, 218, 45044.8], [476, 218, 56738.1], [477, 218, 59457.008], [478, 218, 48369.43], [479, 218, 12665.242], [472, 219, 12816.762], [473, 219, 32254.629], [474, 219, 42073.28], [475, 219, 40477.832], [476, 219, 42192.938], [477, 219, 53071.88], [478, 219, 61973.242], [479, 219, 26224.95], [472, 220, 29170.098], [473, 220, 36263.19], [474, 220, 20734.17], [475, 220, 23104.074], [476, 220, 27555.078], [477, 220, 33960.977], [478, 220, 50999.695], [479, 220, 41034.797], [472, 221, 37479.72], [473, 221, 23905.121], [474, 221, 14156.272], [475, 221, 19098.836], [476, 221, 20715.451], [477, 221, 24270.803], [478, 221, 40262.656], [479, 221, 49374.586], [480, 221, 8807.097], [471, 222, 9034.222], [472, 222, 44253.723], [473, 222, 25068.469], [474, 222, 17174.328], [475, 222, 19703.775], [476, 222, 18325.326], [477, 222, 22856.584], [478, 222, 36802.316], [479, 222, 50652.03], [480, 222, 11847.38], [472, 223, 46447.465], [473, 223, 35605.07], [474, 223, 18739.86], [475, 223, 20567.977], [476, 223, 19826.758], [477, 223, 22451.738], [478, 223, 34963.312], [479, 223, 48713.07], [480, 223, 11620.417], [472, 224, 30984.92], [473, 224, 46513.94], [474, 224, 25852.896], [475, 224, 19138.723], [476, 224, 22233.225], [477, 224, 27827.264], [478, 224, 45244.23], [479, 224, 44777.91], [480, 224, 11101.3955], [472, 225, 9798.707], [473, 225, 42598.45], [474, 225, 43409.465], [475, 225, 34840.586], [476, 225, 36535.746], [477, 225, 42026.746], [478, 225, 45569.97], [479, 225, 33260.34], [480, 225, 8740.246], [473, 226, 15096.922], [474, 226, 31177.703], [475, 226, 39540.508], [476, 226, 38490.17], [477, 226, 33005.82], [478, 226, 24084.61], [479, 226, 17231.744], [475, 227, 17536.627], [476, 227, 11626.823]]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-1.40609</td>
      <td>-1.43519</td>
      <td>0.115</td>
      <td>A</td>
      <td>False</td>
      <td>False</td>
      <td>[[178, 405, 32037.309], [179, 405, 28367.28], [180, 405, 22740.55], [178, 406, 49287.418], [179, 406, 77518.414], [180, 406, 67876.07], [181, 406, 61937.824], [182, 406, 68309.266], [183, 406, 24239.715], [178, 407, 69871.7], [179, 407, 72018.234], [180, 407, 56953.594], [181, 407, 56053.12], [182, 407, 80453.46], [183, 407, 81597.305], [184, 407, 23621.553], [177, 408, 48576.777], [178, 408, 77786.12], [179, 408, 55984.98], [180, 408, 50533.477], [181, 408, 52787.09], [182, 408, 63563.54], [183, 408, 112992.12], [184, 408, 75882.96], [177, 409, 67347.086], [178, 409, 77002.47], [179, 409, 55371.684], [180, 409, 51000.75], [181, 409, 51419.348], [182, 409, 58725.332], [183, 409, 114647.03], [184, 409, 101665.65], [177, 410, 74202.19], [178, 410, 75644.46], [179, 410, 55892.496], [180, 410, 47841.797], [181, 410, 49068.387], [182, 410, 59874.043], [183, 410, 111127.9], [184, 410, 99859.836], [177, 411, 94655.65], [178, 411, 86854.11], [179, 411, 58681.523], [180, 411, 48304.203], [181, 411, 51326.863], [182, 411, 61971.895], [183, 411, 115961.234], [184, 411, 91740.99], [176, 412, 27772.012], [177, 412, 120215.67], [178, 412, 114160.29], [179, 412, 71993.9], [180, 412, 62098.45], [181, 412, 59333.758], [182, 412, 75147.984], [183, 412, 122726.94], [184, 412, 76248.016], [176, 413, 30632.07], [177, 413, 132753.81], [178, 413, 155358.08], [179, 413, 128421.81], [180, 413, 111980.48], [181, 413, 94046.664], [182, 413, 101115.97], [183, 413, 103329.83], [184, 413, 38284.61], [176, 414, 30348.316], [177, 414, 105145.84], [178, 414, 134515.81], [179, 414, 138606.23], [180, 414, 125665.12], [181, 414, 118764.85], [182, 414, 98895.125], [183, 414, 63616.16], [175, 415, 21947.162], [176, 415, 36471.523], [177, 415, 47442.668], [178, 415, 50510.016], [179, 415, 65668.99], [180, 415, 67600.03], [181, 415, 80247.08], [182, 415, 68049.61], [183, 415, 36324.883], [175, 416, 24278.654], [181, 416, 39606.33], [182, 416, 36787.703]]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-1.35358</td>
      <td>-1.47856</td>
      <td>0.115</td>
      <td>A</td>
      <td>True</td>
      <td>False</td>
      <td>[[146, 371, 16934.56], [147, 371, 34940.188], [148, 371, 37597.117], [149, 371, 33068.87], [145, 372, 17398.12], [146, 372, 49466.68], [147, 372, 57905.902], [148, 372, 51037.902], [149, 372, 58547.566], [150, 372, 58545.125], [151, 372, 30182.604], [145, 373, 50427.953], [146, 373, 65703.46], [147, 373, 45523.984], [148, 373, 37536.12], [149, 373, 43694.145], [150, 373, 70622.07], [151, 373, 67974.9], [152, 373, 17481.072], [144, 374, 32390.61], [145, 374, 72466.55], [146, 374, 51935.742], [147, 374, 38058.234], [148, 374, 35878.285], [149, 374, 36538.246], [150, 374, 50961.047], [151, 374, 71556.51], [152, 374, 37928.926], [144, 375, 53536.242], [145, 375, 75379.66], [146, 375, 46385.227], [147, 375, 36893.24], [148, 375, 36025.89], [149, 375, 36507.75], [150, 375, 47480.69], [151, 375, 69799.86], [152, 375, 42584.04], [144, 376, 63746.75], [145, 376, 79705.26], [146, 376, 53863.176], [147, 376, 36438.215], [148, 376, 35401.31], [149, 376, 36938.37], [150, 376, 54663.426], [151, 376, 63014.816], [152, 376, 21333.14], [144, 377, 51157.45], [145, 377, 90364.83], [146, 377, 65920.6], [147, 377, 40195.49], [148, 377, 37356.797], [149, 377, 45672.81], [150, 377, 51050.1], [151, 377, 26788.98], [144, 378, 23436.592], [145, 378, 61648.535], [146, 378, 73479.06], [147, 378, 58223.074], [148, 378, 50781.723], [149, 378, 43713.66], [150, 378, 20872.053], [145, 379, 18803.438], [146, 379, 31090.203], [147, 379, 30570.53], [148, 379, 21850.73]]</td>
    </tr>
  </tbody>
</table><p>... and 220 more rows.</p></details></details><details><summary style="display: list-item; margin-left: 20px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_1']"><b>PlaneSegmentation_1</b></summary><div style="margin-left: 40px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_1']">description: </span><span class="field-value">Plane segmentation of imagine plane 1</span></div><details><summary style="display: list-item; margin-left: 40px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_1']"><b>imaging_plane</b></summary><details><summary style="display: list-item; margin-left: 60px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_1'].optical_channel"><b>optical_channel</b></summary><details><summary style="display: list-item; margin-left: 80px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_1'].optical_channel[0]"><b>0</b></summary><div style="margin-left: 100px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_1'].optical_channel[0].description">description: </span><span class="field-value">optical channel for GCaMP</span></div><div style="margin-left: 100px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_1'].optical_channel[0].emission_lambda">emission_lambda: </span><span class="field-value">525.0</span></div></details></details><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_1'].description">description: </span><span class="field-value">volume calcium imaging in visA layer 2/3</span></div><details><summary style="display: list-item; margin-left: 60px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_1'].device"><b>device</b></summary><div style="margin-left: 80px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_1'].device.description">description: </span><span class="field-value">Two-photon microscope</span></div><div style="margin-left: 80px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_1'].device.manufacturer">manufacturer: </span><span class="field-value">Harvey Lab custom-bulit two-photon microscope (Odin)</span></div></details><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_1'].excitation_lambda">excitation_lambda: </span><span class="field-value">920.0</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_1'].imaging_rate">imaging_rate: </span><span class="field-value">30.0</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_1'].indicator">indicator: </span><span class="field-value">GCaMP6s</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_1'].location">location: </span><span class="field-value">visA</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_1'].conversion">conversion: </span><span class="field-value">1.0</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_1'].unit">unit: </span><span class="field-value">meters</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_1'].reference_frame">reference_frame: </span><span class="field-value">[p->a, l->m, depth from pia] in minimeters from bregma in Allen Institute Mouse Common Coordinate Framework (CCF); i.e. directionality of the imaging FOV: x-axis: posterior to anterior; y-axis: laterl (left) to medial (right); however, the FOV axes does not run parallelly to the CCF coordinate system. The following transformation matrix can be applied to a column vector of pixel coordinate ([x,y,1].T) to [ml, ap, _] in mm in CCF: np.array([[-0.000128,-0.001469,-1.088622],[0.001331,-0.000140,-1.957084],[0.000000,0.000000,1.000000]])</span></div></details><details><summary style="display: list-item; margin-left: 40px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_1']"><b>table</b></summary><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ml</th>
      <th>ap</th>
      <th>depth</th>
      <th>area</th>
      <th>mTagBFP2</th>
      <th>mScarlet</th>
      <th>pixel_mask</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-1.74051</td>
      <td>-1.73168</td>
      <td>0.14</td>
      <td>A</td>
      <td>False</td>
      <td>True</td>
      <td>[[418, 205, 80954.92], [419, 206, 106628.51], [420, 206, 71980.125], [419, 207, 66816.54], [420, 207, 134012.6], [420, 208, 106484.19], [421, 208, 124369.63], [421, 209, 133296.33], [422, 209, 77688.93], [428, 209, 85140.31], [421, 210, 63801.777], [422, 210, 154372.94], [423, 210, 120622.56], [424, 210, 191736.75], [425, 210, 257740.8], [426, 210, 263139.56], [427, 210, 206639.5], [428, 210, 127587.52], [422, 211, 214593.34], [423, 211, 296451.62], [424, 211, 317929.12], [425, 211, 348076.75], [426, 211, 370676.78], [427, 211, 357356.25], [428, 211, 222814.45], [422, 212, 265213.56], [423, 212, 312027.9], [424, 212, 290475.56], [425, 212, 326428.2], [426, 212, 346077.62], [427, 212, 362241.88], [428, 212, 312615.88], [429, 212, 115635.375], [422, 213, 285515.1], [423, 213, 286348.97], [424, 213, 277571.94], [425, 213, 307762.34], [426, 213, 300866.88], [427, 213, 319051.66], [428, 213, 323915.9], [429, 213, 198792.58], [422, 214, 275262.78], [423, 214, 285173.0], [424, 214, 273413.28], [425, 214, 284702.6], [426, 214, 262519.53], [427, 214, 281516.78], [428, 214, 305891.47], [429, 214, 239727.06], [422, 215, 239352.89], [423, 215, 285932.03], [424, 215, 267950.38], [425, 215, 278662.4], [426, 215, 260541.75], [427, 215, 275679.7], [428, 215, 280789.84], [429, 215, 242092.53], [430, 215, 68862.36], [422, 216, 164213.67], [423, 216, 278138.56], [424, 216, 280982.25], [425, 216, 301893.16], [426, 216, 297371.03], [427, 216, 292953.62], [428, 216, 255792.55], [429, 216, 205874.1], [422, 217, 91650.914], [423, 217, 287728.06], [424, 217, 323231.7], [425, 217, 326706.16], [426, 217, 316796.56], [427, 217, 278671.5], [428, 217, 221073.0], [429, 217, 125364.07], [423, 218, 285386.8], [424, 218, 346141.75], [425, 218, 330276.84], [426, 218, 298269.78], [427, 218, 218828.44], [428, 218, 127287.72], [423, 219, 281046.4], [424, 219, 279774.22], [425, 219, 209622.2], [426, 219, 154638.48], [427, 219, 93138.664], [422, 220, 118295.625], [423, 220, 226160.62], [424, 220, 111444.65], [421, 221, 67580.63], [422, 221, 104084.13], [423, 221, 78847.4]]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-1.86115</td>
      <td>-1.72994</td>
      <td>0.14</td>
      <td>A</td>
      <td>True</td>
      <td>False</td>
      <td>[[505, 220, 58717.656], [506, 220, 59157.453], [507, 220, 37949.51], [508, 220, 34401.824], [509, 220, 24819.156], [504, 221, 73709.81], [505, 221, 151153.0], [506, 221, 142337.55], [507, 221, 81303.625], [508, 221, 63926.797], [509, 221, 51074.98], [510, 221, 26319.35], [503, 222, 49863.098], [504, 222, 115891.14], [505, 222, 177364.84], [506, 222, 170445.39], [507, 222, 121882.14], [508, 222, 95807.12], [509, 222, 79446.71], [510, 222, 43476.28], [502, 223, 32153.977], [503, 223, 69536.64], [504, 223, 109411.48], [505, 223, 147429.4], [506, 223, 142484.14], [507, 223, 121745.31], [508, 223, 106557.69], [509, 223, 94126.125], [510, 223, 57618.168], [502, 224, 42249.74], [503, 224, 62905.492], [504, 224, 77768.95], [505, 224, 104085.06], [506, 224, 105990.84], [507, 224, 105042.836], [508, 224, 101964.266], [509, 224, 95924.4], [510, 224, 60721.17], [501, 225, 26475.72], [502, 225, 48274.945], [503, 225, 63017.883], [504, 225, 69668.58], [505, 225, 79739.91], [506, 225, 93178.12], [507, 225, 95592.11], [508, 225, 96745.35], [509, 225, 92093.29], [510, 225, 56640.84], [502, 226, 46989.76], [503, 226, 67352.32], [504, 226, 72204.734], [505, 226, 81049.52], [506, 226, 95201.18], [507, 226, 99863.016], [508, 226, 97634.72], [509, 226, 86581.18], [510, 226, 56020.242], [502, 227, 30419.225], [503, 227, 54363.676], [504, 227, 63399.04], [505, 227, 74784.87], [506, 227, 87050.3], [507, 227, 91917.37], [508, 227, 87050.3], [509, 227, 76632.016], [510, 227, 51485.453], [503, 228, 28581.855], [504, 228, 31572.469], [505, 228, 40119.17], [506, 228, 50586.316], [507, 228, 60139.664], [508, 228, 53948.312], [509, 228, 44942.266], [510, 228, 28078.533]]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-1.76924</td>
      <td>-1.82857</td>
      <td>0.14</td>
      <td>A</td>
      <td>False</td>
      <td>False</td>
      <td>[[446, 138, 14899.492], [447, 138, 15248.103], [447, 139, 23149.13], [447, 140, 16052.7705], [448, 140, 23163.457], [449, 140, 15594.324], [450, 140, 16544.645], [451, 140, 18571.836], [452, 140, 20725.576], [453, 140, 24751.305], [454, 140, 17227.537], [448, 141, 43991.707], [449, 141, 76001.734], [450, 141, 82228.96], [451, 141, 56627.62], [452, 141, 44825.027], [453, 141, 40632.156], [454, 141, 30085.514], [455, 141, 16902.805], [447, 142, 19238.014], [448, 142, 75423.91], [449, 142, 126808.05], [450, 142, 115318.25], [451, 142, 61111.797], [452, 142, 39421.574], [453, 142, 35603.58], [454, 142, 29840.096], [455, 142, 30312.348], [456, 142, 27119.941], [447, 143, 29154.295], [448, 143, 90457.11], [449, 143, 117968.64], [450, 143, 90337.72], [451, 143, 47611.52], [452, 143, 35190.5], [453, 143, 36116.94], [454, 143, 26864.453], [455, 143, 24653.406], [456, 143, 33440.285], [457, 143, 19631.99], [447, 144, 31382.055], [448, 144, 87400.805], [449, 144, 99482.766], [450, 144, 68623.625], [451, 144, 43963.055], [452, 144, 38468.863], [453, 144, 44462.09], [454, 144, 35147.52], [455, 144, 26857.29], [456, 144, 34786.973], [457, 144, 25782.807], [447, 145, 20116.703], [448, 145, 75462.11], [449, 145, 91751.266], [450, 145, 63480.434], [451, 145, 40975.992], [452, 145, 24198.412], [453, 145, 29660.496], [454, 145, 22845.889], [455, 145, 20670.658], [456, 145, 29479.027], [457, 145, 23977.676], [448, 146, 52162.55], [449, 146, 93489.54], [450, 146, 63341.945], [451, 146, 37408.707], [452, 146, 22334.912], [453, 146, 19467.236], [454, 146, 17349.312], [455, 146, 17970.125], [456, 146, 23528.781], [448, 147, 32960.35], [449, 147, 91154.33], [450, 147, 70486.06], [451, 147, 36432.125], [452, 147, 20195.498], [453, 147, 17153.518], [454, 147, 18208.898], [455, 147, 24297.633], [456, 147, 18664.957], [448, 148, 35080.664], [449, 148, 61044.938], [450, 148, 57644.797], [451, 148, 39751.082], [452, 148, 23395.068], [453, 148, 18829.71], [454, 148, 21186.41], [455, 148, 20467.7], [447, 149, 15436.733], [448, 149, 30061.635], [449, 149, 16489.727], [450, 149, 24674.896], [451, 149, 28133.105], [452, 149, 19149.668], [447, 150, 20150.13]]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-1.52488</td>
      <td>-1.68150</td>
      <td>0.14</td>
      <td>A</td>
      <td>False</td>
      <td>True</td>
      <td>[[276, 232, 76022.45], [277, 232, 84155.92], [278, 232, 82370.22], [279, 232, 54377.13], [274, 233, 67319.484], [275, 233, 121896.15], [276, 233, 165350.12], [277, 233, 173068.16], [278, 233, 174482.92], [279, 233, 143426.02], [280, 233, 41130.008], [273, 234, 88310.05], [274, 234, 155442.8], [275, 234, 195334.47], [276, 234, 203181.34], [277, 234, 203225.44], [278, 234, 202431.92], [279, 234, 184115.19], [280, 234, 73818.0], [273, 235, 104072.81], [274, 235, 188677.84], [275, 235, 192204.53], [276, 235, 174086.17], [277, 235, 168840.22], [278, 235, 172499.16], [279, 235, 176907.52], [280, 235, 106726.414], [273, 236, 123805.28], [274, 236, 183916.81], [275, 236, 147239.25], [276, 236, 134499.1], [277, 236, 124051.27], [278, 236, 119025.74], [279, 236, 140362.2], [280, 236, 111443.36], [281, 236, 36104.477], [273, 237, 128988.64], [274, 237, 156144.14], [275, 237, 124359.86], [276, 237, 120083.75], [277, 237, 106880.71], [278, 237, 94383.01], [279, 237, 95176.51], [280, 237, 81135.88], [273, 238, 109415.516], [274, 238, 122949.18], [275, 238, 105844.74], [276, 238, 107431.75], [277, 238, 96499.016], [278, 238, 83450.27], [279, 238, 72649.79], [280, 238, 40623.043], [273, 239, 103816.9], [274, 239, 125550.12], [275, 239, 100202.04], [276, 239, 105580.24], [277, 239, 95683.47], [278, 239, 87814.55], [279, 239, 60438.625], [273, 240, 44326.066], [274, 240, 127423.67], [275, 240, 114925.97], [276, 240, 119598.83], [277, 240, 106990.914], [278, 240, 81819.18], [279, 240, 41063.88], [274, 241, 43554.605], [275, 241, 107586.05], [276, 241, 110385.35], [277, 241, 82965.35], [278, 241, 46353.914]]</td>
    </tr>
  </tbody>
</table><p>... and 187 more rows.</p></details></details><details><summary style="display: list-item; margin-left: 20px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_2']"><b>PlaneSegmentation_2</b></summary><div style="margin-left: 40px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_2']">description: </span><span class="field-value">Plane segmentation of imagine plane 2</span></div><details><summary style="display: list-item; margin-left: 40px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_2']"><b>imaging_plane</b></summary><details><summary style="display: list-item; margin-left: 60px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_2'].optical_channel"><b>optical_channel</b></summary><details><summary style="display: list-item; margin-left: 80px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_2'].optical_channel[0]"><b>0</b></summary><div style="margin-left: 100px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_2'].optical_channel[0].description">description: </span><span class="field-value">optical channel for GCaMP</span></div><div style="margin-left: 100px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_2'].optical_channel[0].emission_lambda">emission_lambda: </span><span class="field-value">525.0</span></div></details></details><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_2'].description">description: </span><span class="field-value">volume calcium imaging in visA layer 2/3</span></div><details><summary style="display: list-item; margin-left: 60px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_2'].device"><b>device</b></summary><div style="margin-left: 80px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_2'].device.description">description: </span><span class="field-value">Two-photon microscope</span></div><div style="margin-left: 80px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_2'].device.manufacturer">manufacturer: </span><span class="field-value">Harvey Lab custom-bulit two-photon microscope (Odin)</span></div></details><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_2'].excitation_lambda">excitation_lambda: </span><span class="field-value">920.0</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_2'].imaging_rate">imaging_rate: </span><span class="field-value">30.0</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_2'].indicator">indicator: </span><span class="field-value">GCaMP6s</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_2'].location">location: </span><span class="field-value">visA</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_2'].conversion">conversion: </span><span class="field-value">1.0</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_2'].unit">unit: </span><span class="field-value">meters</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_2'].reference_frame">reference_frame: </span><span class="field-value">[p->a, l->m, depth from pia] in minimeters from bregma in Allen Institute Mouse Common Coordinate Framework (CCF); i.e. directionality of the imaging FOV: x-axis: posterior to anterior; y-axis: laterl (left) to medial (right); however, the FOV axes does not run parallelly to the CCF coordinate system. The following transformation matrix can be applied to a column vector of pixel coordinate ([x,y,1].T) to [ml, ap, _] in mm in CCF: np.array([[-0.000128,-0.001469,-1.088622],[0.001331,-0.000140,-1.957084],[0.000000,0.000000,1.000000]])</span></div></details><details><summary style="display: list-item; margin-left: 40px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_2']"><b>table</b></summary><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ml</th>
      <th>ap</th>
      <th>depth</th>
      <th>area</th>
      <th>mTagBFP2</th>
      <th>mScarlet</th>
      <th>pixel_mask</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-1.43297</td>
      <td>-1.72679</td>
      <td>0.165</td>
      <td>MM</td>
      <td>True</td>
      <td>False</td>
      <td>[[215, 192, 63482.414], [216, 192, 149908.53], [217, 192, 182727.72], [218, 192, 155130.8], [219, 192, 71471.36], [214, 193, 61038.125], [215, 193, 213503.92], [216, 193, 231565.48], [217, 193, 211168.48], [218, 193, 232933.81], [219, 193, 223243.9], [220, 193, 93869.516], [214, 194, 149996.27], [215, 194, 207052.47], [216, 194, 158505.88], [217, 194, 145993.98], [218, 194, 163402.16], [219, 194, 262627.7], [220, 194, 185477.14], [214, 195, 177353.6], [215, 195, 142412.81], [216, 195, 125967.375], [217, 195, 130043.69], [218, 195, 133977.75], [219, 195, 247141.5], [220, 195, 228367.5], [214, 196, 157667.4], [215, 196, 118241.734], [216, 196, 114095.21], [217, 196, 115660.34], [218, 196, 123871.85], [219, 196, 243809.1], [220, 196, 236873.72], [214, 197, 127226.56], [215, 197, 115616.47], [216, 197, 102485.0], [217, 197, 105075.77], [218, 197, 129407.04], [219, 197, 237801.66], [220, 197, 210917.19], [214, 198, 77726.89], [215, 198, 140823.77], [216, 198, 94305.45], [217, 198, 105455.88], [218, 198, 154801.94], [219, 198, 239654.44], [220, 198, 142350.56], [215, 199, 148498.66], [216, 199, 164591.61], [217, 199, 161733.55], [218, 199, 213753.98], [219, 199, 200660.84], [216, 200, 182167.97], [217, 200, 226381.39], [218, 200, 207889.3], [219, 200, 79900.18], [217, 201, 78502.38], [218, 201, 62715.55]]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-1.70887</td>
      <td>-1.85857</td>
      <td>0.165</td>
      <td>A</td>
      <td>False</td>
      <td>False</td>
      <td>[[412, 114, 160243.02], [413, 114, 200628.88], [414, 114, 179605.11], [415, 114, 190153.11], [416, 114, 236535.45], [417, 114, 185168.1], [410, 115, 212549.56], [411, 115, 428181.06], [412, 115, 530579.2], [413, 115, 596901.6], [414, 115, 580718.4], [415, 115, 509916.7], [416, 115, 437814.53], [417, 115, 217028.86], [409, 116, 342537.28], [410, 116, 525521.94], [411, 116, 562848.9], [412, 116, 543982.94], [413, 116, 574216.2], [414, 116, 587943.0], [415, 116, 567280.5], [416, 116, 440415.4], [417, 116, 203663.23], [408, 117, 367735.3], [409, 117, 517204.56], [410, 117, 536742.8], [411, 117, 498777.16], [412, 117, 498646.2], [413, 117, 510205.66], [414, 117, 544161.56], [415, 117, 536214.44], [416, 117, 351696.56], [417, 117, 127804.28], [407, 118, 358003.75], [408, 118, 517141.34], [409, 118, 531446.2], [410, 118, 492144.0], [411, 118, 490988.06], [412, 118, 515551.9], [413, 118, 527111.4], [414, 118, 557888.44], [415, 118, 507749.28], [416, 118, 239353.06], [407, 119, 505539.88], [408, 119, 517336.4], [409, 119, 484196.88], [410, 119, 471336.97], [411, 119, 489513.8], [412, 119, 507654.88], [413, 119, 514251.47], [414, 119, 509338.7], [415, 119, 338981.16], [416, 119, 132680.92], [407, 120, 451116.75], [408, 120, 451289.06], [409, 120, 422176.03], [410, 120, 429760.16], [411, 120, 442723.88], [412, 120, 433423.1], [413, 120, 397789.9], [414, 120, 204306.05], [408, 121, 180644.11], [409, 121, 215513.42], [410, 121, 205104.22], [411, 121, 172290.78], [412, 121, 135132.36]]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-1.66363</td>
      <td>-1.55203</td>
      <td>0.165</td>
      <td>A</td>
      <td>False</td>
      <td>False</td>
      <td>[[361, 338, 82727.47], [362, 338, 84487.625], [359, 339, 76780.984], [360, 339, 225110.05], [361, 339, 297609.56], [362, 339, 317589.75], [363, 339, 305982.22], [364, 339, 214549.1], [359, 340, 244329.08], [360, 340, 327484.7], [361, 340, 328055.56], [362, 340, 372392.53], [363, 340, 418632.38], [364, 340, 399603.62], [365, 340, 247088.25], [358, 341, 202751.28], [359, 341, 290949.5], [360, 341, 300844.47], [361, 341, 326723.56], [362, 341, 371250.8], [363, 341, 415968.38], [364, 341, 399413.34], [365, 341, 285050.6], [357, 342, 131678.9], [358, 342, 248134.83], [359, 342, 264499.56], [360, 342, 297038.72], [361, 342, 321593.97], [362, 342, 336977.62], [363, 342, 361165.56], [364, 342, 366874.2], [365, 342, 262977.25], [356, 343, 101518.35], [357, 343, 207889.03], [358, 343, 224919.77], [359, 343, 239952.47], [360, 343, 255330.55], [361, 343, 267256.4], [362, 343, 272037.72], [363, 343, 303698.78], [364, 343, 345181.44], [365, 343, 249276.56], [356, 344, 95904.875], [357, 344, 211694.78], [358, 344, 201894.98], [359, 344, 210697.3], [360, 344, 212808.38], [361, 344, 216677.84], [362, 344, 230402.17], [363, 344, 294755.25], [364, 344, 367254.78], [365, 344, 244519.38], [357, 345, 135008.94], [358, 345, 193046.61], [359, 345, 218164.56], [360, 345, 221114.02], [361, 345, 225966.34], [362, 345, 234338.98], [363, 345, 314735.44], [364, 345, 330339.0], [365, 345, 186481.7], [358, 346, 107607.555], [359, 346, 211504.5], [360, 346, 232055.55], [361, 346, 216737.4], [362, 346, 179536.2], [363, 346, 171448.98], [364, 346, 136245.81], [365, 346, 116646.2]]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-1.85260</td>
      <td>-1.71299</td>
      <td>0.165</td>
      <td>A</td>
      <td>True</td>
      <td>False</td>
      <td>[[498, 231, 17505.365], [499, 231, 12477.909], [497, 232, 19963.219], [498, 232, 41850.125], [499, 232, 35684.906], [500, 232, 30366.857], [501, 232, 23129.676], [497, 233, 54028.42], [498, 233, 41109.066], [499, 233, 30732.39], [500, 233, 35686.67], [501, 233, 50912.535], [502, 233, 29839.82], [496, 234, 24426.693], [497, 234, 55739.11], [498, 234, 33018.266], [499, 234, 29705.512], [500, 234, 31221.172], [501, 234, 43722.402], [502, 234, 58117.55], [495, 235, 13100.926], [496, 235, 39397.336], [497, 235, 47894.887], [498, 235, 30800.63], [499, 235, 33915.81], [500, 235, 37008.24], [501, 235, 39285.906], [502, 235, 57875.82], [503, 235, 28034.422], [495, 236, 22423.73], [496, 236, 51501.08], [497, 236, 51978.18], [498, 236, 39289.883], [499, 236, 29646.836], [500, 236, 41512.4], [501, 236, 41391.918], [502, 236, 64378.367], [503, 236, 55068.59], [496, 237, 42173.977], [497, 237, 60974.32], [498, 237, 43145.37], [499, 237, 29748.775], [500, 237, 38458.9], [501, 237, 39421.707], [502, 237, 67924.516], [503, 237, 49837.676], [496, 238, 17777.371], [497, 238, 55631.652], [498, 238, 46446.39], [499, 238, 26367.27], [500, 238, 36650.785], [501, 238, 44404.746], [502, 238, 50224.51], [503, 238, 24375.115], [497, 239, 27293.596], [498, 239, 45303.07], [499, 239, 37931.65], [500, 239, 37566.3], [501, 239, 40841.535], [502, 239, 23635.824], [498, 240, 26833.688], [499, 240, 37643.67], [500, 240, 38909.492], [501, 240, 29485.793], [499, 241, 24246.168], [500, 241, 16752.25], [501, 241, 12240.44]]</td>
    </tr>
  </tbody>
</table><p>... and 140 more rows.</p></details></details><details><summary style="display: list-item; margin-left: 20px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_3']"><b>PlaneSegmentation_3</b></summary><div style="margin-left: 40px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_3']">description: </span><span class="field-value">Plane segmentation of imagine plane 3</span></div><details><summary style="display: list-item; margin-left: 40px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_3']"><b>imaging_plane</b></summary><details><summary style="display: list-item; margin-left: 60px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_3'].optical_channel"><b>optical_channel</b></summary><details><summary style="display: list-item; margin-left: 80px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_3'].optical_channel[0]"><b>0</b></summary><div style="margin-left: 100px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_3'].optical_channel[0].description">description: </span><span class="field-value">optical channel for GCaMP</span></div><div style="margin-left: 100px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_3'].optical_channel[0].emission_lambda">emission_lambda: </span><span class="field-value">525.0</span></div></details></details><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_3'].description">description: </span><span class="field-value">volume calcium imaging in visA layer 2/3</span></div><details><summary style="display: list-item; margin-left: 60px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_3'].device"><b>device</b></summary><div style="margin-left: 80px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_3'].device.description">description: </span><span class="field-value">Two-photon microscope</span></div><div style="margin-left: 80px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_3'].device.manufacturer">manufacturer: </span><span class="field-value">Harvey Lab custom-bulit two-photon microscope (Odin)</span></div></details><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_3'].excitation_lambda">excitation_lambda: </span><span class="field-value">920.0</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_3'].imaging_rate">imaging_rate: </span><span class="field-value">30.0</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_3'].indicator">indicator: </span><span class="field-value">GCaMP6s</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_3'].location">location: </span><span class="field-value">visA</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_3'].conversion">conversion: </span><span class="field-value">1.0</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_3'].unit">unit: </span><span class="field-value">meters</span></div><div style="margin-left: 60px;" class="container-fields"><span class="field-key" title=".plane_segmentations['PlaneSegmentation_3'].reference_frame">reference_frame: </span><span class="field-value">[p->a, l->m, depth from pia] in minimeters from bregma in Allen Institute Mouse Common Coordinate Framework (CCF); i.e. directionality of the imaging FOV: x-axis: posterior to anterior; y-axis: laterl (left) to medial (right); however, the FOV axes does not run parallelly to the CCF coordinate system. The following transformation matrix can be applied to a column vector of pixel coordinate ([x,y,1].T) to [ml, ap, _] in mm in CCF: np.array([[-0.000128,-0.001469,-1.088622],[0.001331,-0.000140,-1.957084],[0.000000,0.000000,1.000000]])</span></div></details><details><summary style="display: list-item; margin-left: 40px;" class="container-fields field-key" title=".plane_segmentations['PlaneSegmentation_3']"><b>table</b></summary><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ml</th>
      <th>ap</th>
      <th>depth</th>
      <th>area</th>
      <th>mTagBFP2</th>
      <th>mScarlet</th>
      <th>pixel_mask</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-1.43901</td>
      <td>-1.45756</td>
      <td>0.19</td>
      <td>A</td>
      <td>False</td>
      <td>False</td>
      <td>[[203, 392, 163163.88], [204, 392, 158278.22], [205, 392, 138995.62], [201, 393, 129277.055], [202, 393, 284141.16], [203, 393, 353207.62], [204, 393, 354892.03], [205, 393, 318330.3], [206, 393, 248795.62], [207, 393, 150956.34], [201, 394, 248046.42], [202, 394, 461554.44], [203, 394, 627572.1], [204, 394, 641951.44], [205, 394, 501093.66], [206, 394, 382545.8], [207, 394, 247435.97], [208, 394, 125776.56], [201, 395, 368866.5], [202, 395, 739483.6], [203, 395, 837345.1], [204, 395, 795799.4], [205, 395, 638318.0], [206, 395, 435998.56], [207, 395, 316869.6], [208, 395, 162894.72], [200, 396, 122847.73], [201, 396, 508838.94], [202, 396, 848253.7], [203, 396, 833614.1], [204, 396, 791158.2], [205, 396, 693900.75], [206, 396, 475296.5], [207, 396, 322061.06], [208, 396, 185756.1], [201, 397, 504595.88], [202, 397, 839298.4], [203, 397, 820657.8], [204, 397, 773041.94], [205, 397, 700297.9], [206, 397, 514015.2], [207, 397, 322736.22], [208, 397, 168583.9], [201, 398, 376118.94], [202, 398, 752879.9], [203, 398, 805245.9], [204, 398, 752979.1], [205, 398, 666002.1], [206, 398, 486192.3], [207, 398, 277888.25], [208, 398, 119801.67], [201, 399, 203926.86], [202, 399, 559982.5], [203, 399, 723135.94], [204, 399, 700457.94], [205, 399, 591766.5], [206, 399, 392650.72], [207, 399, 183950.88], [202, 400, 291365.78], [203, 400, 515337.44], [204, 400, 567589.2], [205, 400, 435895.4], [206, 400, 221180.81], [203, 401, 257725.11], [204, 401, 368854.78], [205, 401, 215269.23], [204, 402, 214619.75], [204, 403, 151162.81], [204, 404, 168748.6]]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-1.83887</td>
      <td>-1.75568</td>
      <td>0.19</td>
      <td>A</td>
      <td>False</td>
      <td>False</td>
      <td>[[492, 198, 187391.72], [493, 198, 150639.34], [491, 199, 262635.75], [492, 199, 344534.56], [493, 199, 325931.5], [494, 199, 201608.67], [490, 200, 274357.2], [491, 200, 471126.06], [492, 200, 491241.56], [493, 200, 473545.97], [494, 200, 395655.16], [495, 200, 189509.14], [490, 201, 431802.53], [491, 201, 572157.25], [492, 201, 585315.5], [493, 201, 574425.94], [494, 201, 548109.44], [495, 201, 415165.66], [496, 201, 176275.25], [489, 202, 181115.08], [490, 202, 493056.47], [491, 202, 615261.9], [492, 202, 635528.6], [493, 202, 629478.9], [494, 202, 632806.25], [495, 202, 583046.9], [496, 202, 395050.16], [497, 202, 128746.73], [489, 203, 211288.31], [490, 203, 506970.97], [491, 203, 604523.56], [492, 203, 621489.5], [493, 203, 624790.3], [494, 203, 653980.44], [495, 203, 658971.5], [496, 203, 510909.88], [497, 203, 252199.9], [489, 204, 202440.52], [490, 204, 452976.75], [491, 204, 531321.3], [492, 204, 574892.4], [493, 204, 601952.4], [494, 204, 627815.2], [495, 204, 685893.0], [496, 204, 546346.0], [497, 204, 285019.9], [489, 205, 151849.3], [490, 205, 362986.38], [491, 205, 453884.22], [492, 205, 526722.2], [493, 205, 573518.44], [494, 205, 609060.9], [495, 205, 627994.9], [496, 205, 475500.4], [497, 205, 256207.88], [490, 206, 305816.0], [491, 206, 398075.06], [492, 206, 454942.9], [493, 206, 478990.75], [494, 206, 483021.25], [495, 206, 433426.62], [496, 206, 288933.75], [497, 206, 161226.45], [490, 207, 240932.2], [491, 207, 334401.2], [492, 207, 362230.16], [493, 207, 339997.22], [494, 207, 301429.94], [495, 207, 207960.94], [490, 208, 128028.32], [491, 208, 186786.73], [492, 208, 214993.8], [493, 208, 185954.89]]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-1.40346</td>
      <td>-1.48436</td>
      <td>0.19</td>
      <td>A</td>
      <td>False</td>
      <td>False</td>
      <td>[[180, 371, 95635.44], [181, 371, 94044.93], [182, 371, 98119.03], [183, 371, 50283.227], [179, 372, 69018.375], [180, 372, 175559.08], [181, 372, 180136.4], [182, 372, 176668.31], [183, 372, 146762.19], [184, 372, 116104.04], [179, 373, 81010.55], [180, 373, 191814.33], [181, 373, 188300.0], [182, 373, 178528.17], [183, 373, 183847.9], [184, 373, 153502.62], [179, 374, 66518.5], [180, 374, 193058.22], [181, 374, 189365.08], [182, 374, 191734.92], [183, 374, 189356.05], [184, 374, 143594.64], [180, 375, 169460.34], [181, 375, 210231.3], [182, 375, 221452.39], [183, 375, 181360.4], [184, 375, 119993.72], [180, 376, 139232.34], [181, 376, 220223.78], [182, 376, 219269.94], [183, 376, 162306.7], [184, 376, 64966.273], [180, 377, 81964.6], [181, 377, 213753.95], [182, 377, 173447.44], [183, 377, 94828.81], [181, 378, 104155.664], [182, 378, 85971.41]]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-1.48421</td>
      <td>-1.68091</td>
      <td>0.19</td>
      <td>A</td>
      <td>False</td>
      <td>False</td>
      <td>[[247, 230, 56648.055], [248, 230, 76853.14], [249, 230, 103793.26], [250, 230, 87776.805], [251, 230, 43325.613], [246, 231, 91448.78], [247, 231, 127411.99], [248, 231, 127651.875], [249, 231, 147451.02], [250, 231, 170442.38], [251, 231, 126157.25], [246, 232, 105048.01], [247, 232, 134017.86], [248, 232, 123352.52], [249, 232, 133538.11], [250, 232, 175959.56], [251, 232, 183893.98], [252, 232, 49848.44], [246, 233, 117318.67], [247, 233, 137080.9], [248, 233, 113259.2], [249, 233, 111875.3], [250, 233, 150311.1], [251, 233, 198489.62], [252, 233, 83864.95], [246, 234, 137246.98], [247, 234, 135494.03], [248, 234, 112797.91], [249, 234, 99992.12], [250, 234, 138686.25], [251, 234, 194891.45], [252, 234, 101246.87], [246, 235, 144923.06], [247, 235, 138870.77], [248, 235, 97556.44], [249, 235, 102353.99], [250, 235, 148318.27], [251, 235, 194928.36], [252, 235, 75958.21], [246, 236, 112124.4], [247, 236, 146085.55], [248, 236, 116986.54], [249, 236, 133907.14], [250, 236, 168984.0], [251, 236, 144923.06], [246, 237, 46264.117], [247, 237, 104673.64], [248, 237, 128749.77], [249, 237, 124049.625], [250, 237, 103737.91], [251, 237, 52825.137], [248, 238, 56089.73], [249, 238, 40282.54]]</td>
    </tr>
  </tbody>
</table><p>... and 113 more rows.</p></details></details></details></div></div></div>
</div>
<p>There are 4 imaging planes in this session (PlaneSegmentation_0 to 3). We can extract the information of the first PlaneSegmentation.</p>
<p><em>Note that although this imaging FOV was centered on the brain area visA, some neurons were labeled to be in retrosplenial cortex (RSC), because we classified each neuron’s location based on post hoc registration using anatomical and retinotopy information.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert the first PlaneSegmentation into dataframe and examine the information</span>
<span class="n">planeSeg_0_df</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">processing</span><span class="p">[</span><span class="s1">&#39;ophys&#39;</span><span class="p">][</span><span class="s1">&#39;ImageSegmentation&#39;</span><span class="p">][</span><span class="s1">&#39;PlaneSegmentation_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
<span class="n">planeSeg_0_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ml</th>
      <th>ap</th>
      <th>depth</th>
      <th>area</th>
      <th>mTagBFP2</th>
      <th>mScarlet</th>
      <th>pixel_mask</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-1.83153</td>
      <td>-1.67308</td>
      <td>0.115</td>
      <td>A</td>
      <td>True</td>
      <td>False</td>
      <td>[[483, 258, 91007.11], [482, 259, 157956.42], ...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-1.81635</td>
      <td>-1.72861</td>
      <td>0.115</td>
      <td>A</td>
      <td>False</td>
      <td>True</td>
      <td>[[475, 217, 11779.721], [476, 217, 21893.092],...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-1.40609</td>
      <td>-1.43519</td>
      <td>0.115</td>
      <td>A</td>
      <td>False</td>
      <td>False</td>
      <td>[[178, 405, 32037.309], [179, 405, 28367.28], ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-1.35358</td>
      <td>-1.47856</td>
      <td>0.115</td>
      <td>A</td>
      <td>True</td>
      <td>False</td>
      <td>[[146, 371, 16934.56], [147, 371, 34940.188], ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-1.33481</td>
      <td>-1.46609</td>
      <td>0.115</td>
      <td>A</td>
      <td>False</td>
      <td>False</td>
      <td>[[136, 379, 49693.73], [134, 380, 106279.6], [...</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-1.39399</td>
      <td>-1.43513</td>
      <td>0.115</td>
      <td>A</td>
      <td>False</td>
      <td>False</td>
      <td>[[171, 407, 129510.016], [172, 407, 175824.52]...</td>
    </tr>
    <tr>
      <th>6</th>
      <td>-1.80346</td>
      <td>-1.75859</td>
      <td>0.115</td>
      <td>A</td>
      <td>False</td>
      <td>False</td>
      <td>[[470, 192, 61868.5], [471, 192, 107326.45], [...</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-1.42985</td>
      <td>-1.66434</td>
      <td>0.115</td>
      <td>A</td>
      <td>False</td>
      <td>False</td>
      <td>[[210, 238, 121663.39], [211, 238, 87916.88], ...</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-1.48183</td>
      <td>-1.45869</td>
      <td>0.115</td>
      <td>A</td>
      <td>False</td>
      <td>False</td>
      <td>[[232, 395, 18493.646], [233, 395, 28247.006],...</td>
    </tr>
    <tr>
      <th>9</th>
      <td>-1.37887</td>
      <td>-1.51958</td>
      <td>0.115</td>
      <td>A</td>
      <td>False</td>
      <td>False</td>
      <td>[[167, 342, 48770.152], [168, 342, 76514.98], ...</td>
    </tr>
    <tr>
      <th>10</th>
      <td>-1.78028</td>
      <td>-1.71546</td>
      <td>0.115</td>
      <td>A</td>
      <td>False</td>
      <td>False</td>
      <td>[[450, 226, 53196.914], [451, 226, 93504.33], ...</td>
    </tr>
    <tr>
      <th>11</th>
      <td>-1.66180</td>
      <td>-1.50749</td>
      <td>0.115</td>
      <td>A</td>
      <td>False</td>
      <td>False</td>
      <td>[[356, 370, 4947.9463], [357, 370, 8767.414], ...</td>
    </tr>
    <tr>
      <th>12</th>
      <td>-1.49552</td>
      <td>-1.56499</td>
      <td>0.115</td>
      <td>A</td>
      <td>False</td>
      <td>False</td>
      <td>[[248, 316, 55648.473], [249, 316, 87538.38], ...</td>
    </tr>
    <tr>
      <th>13</th>
      <td>-1.38089</td>
      <td>-1.84033</td>
      <td>0.115</td>
      <td>RSC</td>
      <td>False</td>
      <td>True</td>
      <td>[[192, 100, 14801.511], [192, 101, 19253.402],...</td>
    </tr>
    <tr>
      <th>14</th>
      <td>-1.75161</td>
      <td>-1.86832</td>
      <td>0.115</td>
      <td>A</td>
      <td>False</td>
      <td>False</td>
      <td>[[438, 106, 62507.734], [438, 107, 80477.586],...</td>
    </tr>
    <tr>
      <th>15</th>
      <td>-1.34168</td>
      <td>-1.46794</td>
      <td>0.115</td>
      <td>A</td>
      <td>False</td>
      <td>False</td>
      <td>[[140, 376, 48653.43], [139, 377, 88938.766], ...</td>
    </tr>
    <tr>
      <th>16</th>
      <td>-1.11977</td>
      <td>-1.74185</td>
      <td>0.115</td>
      <td>RSC</td>
      <td>False</td>
      <td>False</td>
      <td>[[6, 159, 49519.68], [7, 159, 79625.13], [8, 1...</td>
    </tr>
    <tr>
      <th>17</th>
      <td>-1.32015</td>
      <td>-1.50724</td>
      <td>0.115</td>
      <td>RSC</td>
      <td>True</td>
      <td>False</td>
      <td>[[126, 344, 8035.863], [126, 345, 7577.288], [...</td>
    </tr>
    <tr>
      <th>18</th>
      <td>-1.48569</td>
      <td>-1.56739</td>
      <td>0.115</td>
      <td>A</td>
      <td>False</td>
      <td>False</td>
      <td>[[242, 313, 28570.904], [243, 313, 38922.367],...</td>
    </tr>
    <tr>
      <th>19</th>
      <td>-1.35470</td>
      <td>-1.53476</td>
      <td>0.115</td>
      <td>A</td>
      <td>False</td>
      <td>False</td>
      <td>[[152, 328, 40406.5], [150, 329, 48559.832], [...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="visualize-pixel-masks-for-neurons">
<h3>Visualize pixel masks for neurons<a class="headerlink" href="#visualize-pixel-masks-for-neurons" title="Link to this heading">#</a></h3>
<p>We can visualize the pixel masks for all neurons in this imaging plane:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># extract information for these neurons in plane 0</span>
<span class="n">ml_0</span> <span class="o">=</span> <span class="n">planeSeg_0_df</span><span class="p">[</span><span class="s1">&#39;ml&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">ap_0</span> <span class="o">=</span> <span class="n">planeSeg_0_df</span><span class="p">[</span><span class="s1">&#39;ap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">depth_0</span> <span class="o">=</span> <span class="n">planeSeg_0_df</span><span class="p">[</span><span class="s1">&#39;depth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">area_0</span> <span class="o">=</span> <span class="n">planeSeg_0_df</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">mTagBFP2_0</span> <span class="o">=</span> <span class="n">planeSeg_0_df</span><span class="p">[</span><span class="s1">&#39;mTagBFP2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">mScarlet_0</span> <span class="o">=</span> <span class="n">planeSeg_0_df</span><span class="p">[</span><span class="s1">&#39;mScarlet&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># compute number of neurons in this plane</span>
<span class="n">n_neurons_0</span> <span class="o">=</span> <span class="n">ml_0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># overlay pixel masks for all sources in plane 0</span>
<span class="n">source_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">512</span><span class="p">,</span><span class="mi">512</span><span class="p">))</span> <span class="c1"># the imaging FOV was 512 x 512</span>

<span class="k">for</span> <span class="n">i_neuron</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_neurons_0</span><span class="p">):</span>
    <span class="n">n_pixels</span> <span class="o">=</span> <span class="n">planeSeg_0_df</span><span class="p">[</span><span class="s1">&#39;pixel_mask&#39;</span><span class="p">][</span><span class="n">i_neuron</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i_pixel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_pixels</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">planeSeg_0_df</span><span class="p">[</span><span class="s1">&#39;pixel_mask&#39;</span><span class="p">][</span><span class="n">i_neuron</span><span class="p">][</span><span class="n">i_pixel</span><span class="p">]</span>
        <span class="n">source_img</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span> <span class="o">+=</span> <span class="n">w</span>
        
<span class="c1"># display the overlay image</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">source_img</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">source_img</span><span class="p">[:],</span><span class="mf">99.5</span><span class="p">)</span> <span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e28254223901ed427c5d01633abb406c953b3f1b7bdd6863ddc25ab955245403.png" src="../_images/e28254223901ed427c5d01633abb406c953b3f1b7bdd6863ddc25ab955245403.png" />
</div>
</div>
</section>
<section id="extract-neural-activity-df-f-and-deconvolved-activity">
<h3>Extract neural activity (dF/F and deconvolved activity)<a class="headerlink" href="#extract-neural-activity-df-f-and-deconvolved-activity" title="Link to this heading">#</a></h3>
<p>For each <code class="docutils literal notranslate"><span class="pre">PlaneSegmentation</span></code>, there is a corresponding <code class="docutils literal notranslate"><span class="pre">deconvolved_activity</span></code> and a <code class="docutils literal notranslate"><span class="pre">df_over_f</span></code> object that have the <code class="docutils literal notranslate"><span class="pre">RoiResponseSeries</span></code> for the deconvolved activity and dF/F timeseries for all neurons in that imaging plane. They share the same timestamps.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># extract data from deconvolved_activity_plane_0 and inspect their shape</span>
<span class="n">imaging_timestamps_0</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">processing</span><span class="p">[</span><span class="s1">&#39;ophys&#39;</span><span class="p">][</span><span class="s1">&#39;deconvolved_activity_plane_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">timestamps</span>
<span class="n">deconv_0</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">processing</span><span class="p">[</span><span class="s1">&#39;ophys&#39;</span><span class="p">][</span><span class="s1">&#39;deconvolved_activity_plane_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span>
<span class="n">df_0</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">processing</span><span class="p">[</span><span class="s1">&#39;ophys&#39;</span><span class="p">][</span><span class="s1">&#39;df_over_f_plane_0&#39;</span><span class="p">][</span><span class="s1">&#39;dF_over_F_plane_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span>

<span class="n">imaging_timestamps_0</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">deconv_0</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">df_0</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">n_neurons_0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((32496,), (32496, 224), (32496, 224), 224)
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualization-of-neural-activity">
<h3>Visualization  of neural activity<a class="headerlink" href="#visualization-of-neural-activity" title="Link to this heading">#</a></h3>
<p>First we can examine the raw timeseries of the dF/F and deconvloved activity of some neurons. Here we z-score the neural activity for visualization.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot z-scored dF/F and deconvoled activity for the first 20 neurons in this imaging plane</span>
<span class="n">n_selected_neurons</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">frame_start</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">n_frames</span> <span class="o">=</span> <span class="mi">2500</span>
<span class="n">df_z</span> <span class="o">=</span> <span class="n">zscore</span><span class="p">(</span><span class="n">df_0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">deconv_z</span> <span class="o">=</span> <span class="n">zscore</span><span class="p">(</span><span class="n">deconv_0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_frames</span><span class="p">),</span> <span class="n">df_z</span><span class="p">[</span><span class="n">frame_start</span><span class="p">:</span><span class="n">frame_start</span><span class="o">+</span><span class="n">n_frames</span><span class="p">,</span> <span class="p">:</span><span class="n">n_selected_neurons</span><span class="p">]</span><span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_selected_neurons</span><span class="p">),</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;frame number&#39;</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;dF/F&#39;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;dF/F for example neurons&#39;</span><span class="p">);</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_frames</span><span class="p">),</span> <span class="n">deconv_z</span><span class="p">[</span><span class="n">frame_start</span><span class="p">:</span><span class="n">frame_start</span><span class="o">+</span><span class="n">n_frames</span><span class="p">,</span> <span class="p">:</span><span class="n">n_selected_neurons</span><span class="p">]</span><span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_selected_neurons</span><span class="p">),</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;frame number&#39;</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;deconvloved activity&#39;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Deconvoled activity for example neurons&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2219bd1d2497d45694a05f404db41eea3c5004e989a4bf16cdd7cd7b628daf8b.png" src="../_images/2219bd1d2497d45694a05f404db41eea3c5004e989a4bf16cdd7cd7b628daf8b.png" />
<img alt="../_images/6868dd98db1844e9504f63c2a930a0d7c7f4c5fff2ceb2c5ffe7eac0173537b5.png" src="../_images/6868dd98db1844e9504f63c2a930a0d7c7f4c5fff2ceb2c5ffe7eac0173537b5.png" />
</div>
</div>
</section>
</section>
<section id="combine-2p-imaging-and-behavioral-data">
<h2>Combine 2P imaging and behavioral data<a class="headerlink" href="#combine-2p-imaging-and-behavioral-data" title="Link to this heading">#</a></h2>
<p>Now we are ready to combine the neural activity and behavioral variables to explore their relationship. But just before this, there’s a final piece of processing to align behavioral timeseries to timestamps for individual imaging planes.</p>
<section id="aligning-behavioral-timeseries-to-individual-imaging-plane">
<h3>Aligning behavioral timeseries to individual imaging plane<a class="headerlink" href="#aligning-behavioral-timeseries-to-individual-imaging-plane" title="Link to this heading">#</a></h3>
<p>Remember that the behavioral timeseries were downsampled to match the original imaging sampling rate at 30 Hz. However, for multi-plane imaging sessions, there are 5 planes per “volume” (4 imaging planes + 1 flyback frame), so the sampling rate for each plane is 30/5 = 6 Hz. To find the corresponding behavioral timeseries aligned to the imaging frames of each imaging plane, we can use (1) the <code class="docutils literal notranslate"><span class="pre">plane_idx_for_imaging_frames</span></code> (previously described in the behavior processingmodule) or (2) regular spacing for indexing those behavioral timeseries. In this way, we can avoid complicated alignment through the timestamps stored in those objects, although the information is present in the nwb.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># use plane_idx_for_imaging_frames to identify behavioral variables corresponding to this imaging plane</span>
<span class="n">nPlane</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">frame_idx_0</span> <span class="o">=</span> <span class="n">plane_idx_for_imaging_frames</span> <span class="o">==</span> <span class="n">nPlane</span>
<span class="n">trial_number_0</span> <span class="o">=</span> <span class="n">frame_aligned_trial_number</span><span class="p">[</span><span class="n">frame_idx_0</span><span class="p">]</span>
<span class="n">posF_0</span> <span class="o">=</span> <span class="n">posF</span><span class="p">[</span><span class="n">frame_idx_0</span><span class="p">]</span>
<span class="n">time_from_choice_point_0</span> <span class="o">=</span> <span class="n">frame_aligned_time_from_choice_point</span><span class="p">[</span><span class="n">frame_idx_0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># alternatively, use regular spacing for every 5 planes</span>
<span class="n">n_planes</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">trial_number_0</span> <span class="o">=</span> <span class="n">frame_aligned_trial_number</span><span class="p">[</span><span class="n">nPlane</span><span class="p">::</span><span class="n">n_planes</span><span class="p">]</span>
<span class="n">posF_0</span> <span class="o">=</span> <span class="n">posF</span><span class="p">[</span><span class="n">nPlane</span><span class="p">::</span><span class="n">n_planes</span><span class="p">]</span>
<span class="n">time_from_choice_point_0</span> <span class="o">=</span> <span class="n">frame_aligned_time_from_choice_point</span><span class="p">[</span><span class="n">nPlane</span><span class="p">::</span><span class="n">n_planes</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="examine-trial-type-averaged-activity">
<h3>Examine trial-type averaged activity<a class="headerlink" href="#examine-trial-type-averaged-activity" title="Link to this heading">#</a></h3>
<p>Now we can bin the deconvolved activity of the neurons into spatial (in the maze) and temporal (during feedback/ITI) bins for every trial.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># position and temporal binning for deconvolved activity</span>
<span class="n">activity_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">nValidTrials</span><span class="p">,</span> <span class="n">pos_bins</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n_neurons_0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
<span class="n">activity_tm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">nValidTrials</span><span class="p">,</span> <span class="n">tm_bins</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n_neurons_0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
                             
<span class="k">for</span> <span class="n">i_neuron</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_neurons_0</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i_trial</span><span class="p">,</span> <span class="n">this_trial</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">validTrials</span><span class="p">):</span>
        <span class="n">these_frames</span> <span class="o">=</span> <span class="n">trial_number_0</span><span class="o">==</span><span class="n">this_trial</span>
        <span class="n">this_pos</span><span class="p">,</span> <span class="n">this_tm</span> <span class="o">=</span> <span class="n">pos_tm_binning</span><span class="p">(</span><span class="n">deconv_0</span><span class="p">[</span><span class="n">these_frames</span><span class="p">,</span><span class="n">i_neuron</span><span class="p">],</span> <span class="n">posF_0</span><span class="p">[</span><span class="n">these_frames</span><span class="p">],</span> <span class="n">time_from_choice_point_0</span><span class="p">[</span><span class="n">these_frames</span><span class="p">],</span> 
                                           <span class="n">pos_bins</span><span class="p">,</span> <span class="n">pos_half_width</span><span class="p">,</span> <span class="n">tm_bins</span><span class="p">,</span> <span class="n">tm_half_width</span><span class="p">)</span>
        <span class="n">activity_pos</span><span class="p">[</span><span class="n">i_trial</span><span class="p">,:,</span><span class="n">i_neuron</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_pos</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">activity_tm</span><span class="p">[</span><span class="n">i_trial</span><span class="p">,:,</span><span class="n">i_neuron</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_tm</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We can plot trial-type average deconvolved activity for some selected neurons, which shows us how these neurons change their activity according to different trial types (cue-choice combination) and trial phases (position in the maze or time in feedback/ITI).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot trial-type average deconvolved activity for 4 selected neurons (mean+-SEM) </span>
<span class="k">for</span> <span class="n">i_neuron</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i_type</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">this_mean_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">activity_pos</span><span class="p">[</span><span class="n">trial_type</span><span class="o">==</span><span class="n">i_type</span><span class="p">,:,</span><span class="n">i_neuron</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">this_sem_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">activity_pos</span><span class="p">[</span><span class="n">trial_type</span><span class="o">==</span><span class="n">i_type</span><span class="p">,:,</span><span class="n">i_neuron</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">trial_type</span><span class="o">==</span><span class="n">i_type</span><span class="p">))</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pos_bins</span><span class="p">,</span> <span class="n">this_mean_pos</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">trial_type_color</span><span class="p">[</span><span class="n">i_type</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">pos_bins</span><span class="p">,</span> <span class="n">this_mean_pos</span><span class="o">-</span><span class="n">this_sem_pos</span><span class="p">,</span> <span class="n">this_mean_pos</span><span class="o">+</span><span class="n">this_sem_pos</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">trial_type_color</span><span class="p">[</span><span class="n">i_type</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>       

        <span class="n">this_mean_tm</span> <span class="o">=</span> <span class="n">activity_tm</span><span class="p">[</span><span class="n">trial_type</span><span class="o">==</span><span class="n">i_type</span><span class="p">,:,</span><span class="n">i_neuron</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">this_sem_tm</span> <span class="o">=</span> <span class="n">activity_tm</span><span class="p">[</span><span class="n">trial_type</span><span class="o">==</span><span class="n">i_type</span><span class="p">,:,</span><span class="n">i_neuron</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">trial_type</span><span class="o">==</span><span class="n">i_type</span><span class="p">))</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tm_bins</span><span class="p">,</span> <span class="n">this_mean_tm</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">trial_type_color</span><span class="p">[</span><span class="n">i_type</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">trial_type_name</span><span class="p">[</span><span class="n">i_type</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">tm_bins</span><span class="p">,</span> <span class="n">this_mean_tm</span><span class="o">-</span><span class="n">this_sem_tm</span><span class="p">,</span> <span class="n">this_mean_tm</span><span class="o">+</span><span class="n">this_sem_tm</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">trial_type_color</span><span class="p">[</span><span class="n">i_type</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">y1_min</span><span class="p">,</span> <span class="n">y1_max</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    <span class="n">y2_min</span><span class="p">,</span> <span class="n">y2_max</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">stem_length</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">y1_min</span><span class="p">,</span><span class="n">y2_min</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">y1_max</span><span class="p">,</span><span class="n">y2_max</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;stem end&#39;</span><span class="p">)</span> 
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">y1_min</span><span class="p">,</span><span class="n">y2_min</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">y1_max</span><span class="p">,</span><span class="n">y2_max</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;stem end&#39;</span><span class="p">)</span> 
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">feedback_delay</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">y1_min</span><span class="p">,</span><span class="n">y2_min</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">y1_max</span><span class="p">,</span><span class="n">y2_max</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;feedback&#39;</span><span class="p">)</span>  
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">reward_delay</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">y1_min</span><span class="p">,</span><span class="n">y2_min</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">y1_max</span><span class="p">,</span><span class="n">y2_max</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;reward&#39;</span><span class="p">)</span> 
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">y1_min</span><span class="p">,</span><span class="n">y2_min</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">y1_max</span><span class="p">,</span><span class="n">y2_max</span><span class="p">))],</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">2.5</span><span class="p">],</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Position in maze (m)&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Deconvolved activity (a.u.)&#39;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;maze traversal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">y1_min</span><span class="p">,</span><span class="n">y2_min</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">y1_max</span><span class="p">,</span><span class="n">y2_max</span><span class="p">))],</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Time (sec)&#39;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;feedback/ITI&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Neuron </span><span class="si">{</span><span class="n">i_neuron</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b57744907f2269685620df4f099c3eb93796dde1c894bbadc79ddff3f3a85e59.png" src="../_images/b57744907f2269685620df4f099c3eb93796dde1c894bbadc79ddff3f3a85e59.png" />
<img alt="../_images/a6ee46e9a0b4877d7256a0e76233618c8930bbb0a3f8896e15a19f4662a2d93b.png" src="../_images/a6ee46e9a0b4877d7256a0e76233618c8930bbb0a3f8896e15a19f4662a2d93b.png" />
<img alt="../_images/d1081b82e884c074a0b1b28290b797f9d1d7de5a1f85b894cff7853c937d5eff.png" src="../_images/d1081b82e884c074a0b1b28290b797f9d1d7de5a1f85b894cff7853c937d5eff.png" />
<img alt="../_images/99c045a73b4c2ab10cf7875b0f5d2b9d4083d302cd386b9c0b396002052ce61c.png" src="../_images/99c045a73b4c2ab10cf7875b0f5d2b9d4083d302cd386b9c0b396002052ce61c.png" />
</div>
</div>
<p>At first glance, we can observe diverse activity patterns for these neurons. Some of them showed high activity only at a particular trial phase (maze position or time in feedback/ITI). On top of the trial phase-specificity, their activity were also modulated/multiplexed by trial type: cue, choice, or a combination of both. Here we cannot present additional tuning such as tuning to reward or running velocities. For a more comprehensive study of each neuron’s tuning properties over a large spectrum of task and behavioral variables, one can use more complicated statistical methods, such as generalized linear models (GLM).</p>
</section>
<section id="view-static-images">
<h3>View static images<a class="headerlink" href="#view-static-images" title="Link to this heading">#</a></h3>
<p>In the ophys processing module, you can also find <code class="docutils literal notranslate"><span class="pre">static_GCaMP_and_retrograde_label_image</span></code> for each imaging plane and <code class="docutils literal notranslate"><span class="pre">vessel_img</span></code> as the vessel pattern at brain surface for this FOV.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># view content of the static images for plane 0</span>
<span class="n">nwb</span><span class="o">.</span><span class="n">processing</span><span class="p">[</span><span class="s1">&#39;ophys&#39;</span><span class="p">][</span><span class="s1">&#39;static_GCaMP_and_retrograde_label_image_plane_0&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <style>
            .container-fields {
                font-family: "Open Sans", Arial, sans-serif;
            }
            .container-fields .field-value {
                color: #00788E;
            }
            .container-fields details > summary {
                cursor: pointer;
                display: list-item;
            }
            .container-fields details > summary:hover {
                color: #0A6EAA;
            }
        </style>
        
        <script>
            function copyToClipboard(text) {
                navigator.clipboard.writeText(text).then(function() {
                    console.log('Copied to clipboard: ' + text);
                }, function(err) {
                    console.error('Could not copy text: ', err);
                });
            }

            document.addEventListener('DOMContentLoaded', function() {
                let fieldKeys = document.querySelectorAll('.container-fields .field-key');
                fieldKeys.forEach(function(fieldKey) {
                    fieldKey.addEventListener('click', function() {
                        let accessCode = fieldKey.getAttribute('title').replace('Access code: ', '');
                        copyToClipboard(accessCode);
                    });
                });
            });
        </script>
        <div class='container-wrap'><div class='container-header'><div class='xr-obj-type'><h3>static_GCaMP_and_retrograde_label_image_plane_0 (Images)</h3></div></div><div style="margin-left: 0px;" class="container-fields"><span class="field-key" title=".description">description: </span><span class="field-value">static unmixed images for GCaMP and retrograde labels of the FOV</span></div><details><summary style="display: list-item; margin-left: 0px;" class="container-fields field-key" title=".images"><b>images</b></summary><details><summary style="display: list-item; margin-left: 20px;" class="container-fields field-key" title=".images['GCaMP_800nm']"><b>GCaMP_800nm</b></summary></details><details><summary style="display: list-item; margin-left: 20px;" class="container-fields field-key" title=".images['GCaMP_850nm']"><b>GCaMP_850nm</b></summary></details><details><summary style="display: list-item; margin-left: 20px;" class="container-fields field-key" title=".images['mScarlet_800nm']"><b>mScarlet_800nm</b></summary></details><details><summary style="display: list-item; margin-left: 20px;" class="container-fields field-key" title=".images['mTagBFP2_850nm']"><b>mTagBFP2_850nm</b></summary></details></details></div></div></div>
</div>
<p>Let’s extract static images for this imaging plane and visualize them:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># extract static images for this imaging plane</span>
<span class="c1"># (GCaMP image acquired at 850 nm shows the anatomical image)</span>
<span class="n">GCaMP_img</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">processing</span><span class="p">[</span><span class="s1">&#39;ophys&#39;</span><span class="p">][</span><span class="s1">&#39;static_GCaMP_and_retrograde_label_image_plane_0&#39;</span><span class="p">][</span><span class="s1">&#39;GCaMP_850nm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span>
<span class="n">mScarlet_img</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">processing</span><span class="p">[</span><span class="s1">&#39;ophys&#39;</span><span class="p">][</span><span class="s1">&#39;static_GCaMP_and_retrograde_label_image_plane_0&#39;</span><span class="p">][</span><span class="s1">&#39;mScarlet_800nm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span>
<span class="n">mTagBFP2_img</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">processing</span><span class="p">[</span><span class="s1">&#39;ophys&#39;</span><span class="p">][</span><span class="s1">&#39;static_GCaMP_and_retrograde_label_image_plane_0&#39;</span><span class="p">][</span><span class="s1">&#39;mTagBFP2_850nm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span>
<span class="n">vessel_img</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">processing</span><span class="p">[</span><span class="s1">&#39;ophys&#39;</span><span class="p">][</span><span class="s1">&#39;vessel_img&#39;</span><span class="p">][</span><span class="s1">&#39;vessel_img&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># visualize the static images</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">GCaMP_img</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">GCaMP_img</span><span class="p">[:],</span> <span class="mf">99.5</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;GCaMP&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mTagBFP2_img</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">mTagBFP2_img</span><span class="p">[:],</span> <span class="mf">99.5</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;mTagBFP2&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mScarlet_img</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">mScarlet_img</span><span class="p">[:],</span> <span class="mf">99.5</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;mScarlet&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">vessel_img</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">vessel_img</span><span class="p">[:],</span> <span class="mf">99.5</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;vessel&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b1f12af45cd29d691106d0d9bab030fa7fe37954aab6de61d9c6cbd962d5f734.png" src="../_images/b1f12af45cd29d691106d0d9bab030fa7fe37954aab6de61d9c6cbd962d5f734.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "AllenInstitute/openscope_databook",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./visualization"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-description">Dataset description</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#task-description">Task description</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#environment-setup">Environment Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-file">Download file</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#check-basic-information-about-this-session-and-the-animal">Check basic information about this session and the animal</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-more-on-lab-meta-data">[Optional] More on lab meta data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examine-behavioral-data-1-trial-level-information-and-behavioral-modeling-results">Examine behavioral data (1): trial level information and behavioral modeling results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examine-behavioral-data-2-trial-epoch">Examine behavioral data (2): trial epoch</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examine-behavioral-data-3-position-velocities-and-other-modeling-results">Examine behavioral data (3): position, velocities, and other modeling results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#positions-and-velocities">Positions and velocities</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#valid-trials">Valid trials</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#velocity-rnn-derived-variables-dynamic-choice-and-cue-biased-running">Velocity RNN-derived variables (dynamic choice and cue-biased running)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-of-behavioral-variables">Visualization of behavioral variables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#trial-type-averaged-plots">Trial-type averaged plots</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#useful-trick-easy-way-to-extract-epoch-information">Useful trick: easy way to extract epoch information</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examine-two-photon-calcium-imaging-data">Examine two-photon calcium imaging data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#information-about-neurons">Information about neurons</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-pixel-masks-for-neurons">Visualize pixel masks for neurons</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extract-neural-activity-df-f-and-deconvolved-activity">Extract neural activity (dF/F and deconvolved activity)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-of-neural-activity">Visualization  of neural activity</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combine-2p-imaging-and-behavioral-data">Combine 2P imaging and behavioral data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aligning-behavioral-timeseries-to-individual-imaging-plane">Aligning behavioral timeseries to individual imaging plane</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examine-trial-type-averaged-activity">Examine trial-type averaged activity</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#view-static-images">View static images</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Carter Peene
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>