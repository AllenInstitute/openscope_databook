
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Environment setup &#8212; OpenScope Databook</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">OpenScope Databook</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    OpenScope Databook: “NWB for Dummies”
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  NWB Basics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../basics/download_nwb.html">
   Download an NWB File
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../basics/read_nwb.html">
   Reading an NWB File
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../basics/use_nwbwidgets.html">
   Exploring an NWB File
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../basics/stream_nwb.html">
   Stream an NWB File with fsspec
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Visualizing NWB Files
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="visualize_neuropixel_probes.html">
   Visualizing Neuropixel Probe Locations
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/AllenInstitute/openscope_databook/main?urlpath=lab/tree/docs/visualization/visualize_lfp_responses.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://hub.dandiarchive.org/hub/user-redirect/git-pull?repo=https%3A//github.com/AllenInstitute/openscope_databook&urlpath=lab/tree/openscope_databook/docs/visualization/visualize_lfp_responses.ipynb&branch=main"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on JupyterHub"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_jupyterhub.svg">
  </span>
<span class="headerbtn__text-container">JupyterHub</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/AllenInstitute/openscope_databook"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/AllenInstitute/openscope_databook/issues/new?title=Issue%20on%20page%20%2Fvisualization/visualize_lfp_responses.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/visualization/visualize_lfp_responses.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Environment setup
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#read-nwb-files">
   Read NWB files
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualizing-stimuli">
   Visualizing stimuli
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#break">
   BREAK
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   BREAK
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Environment setup</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Environment setup
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#read-nwb-files">
   Read NWB files
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualizing-stimuli">
   Visualizing stimuli
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#break">
   BREAK
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   BREAK
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="environment-setup">
<h1>Environment setup<a class="headerlink" href="#environment-setup" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install pynwb
<span class="o">!</span>pip install matplotlib
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install scipy
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pynwb</span> <span class="kn">import</span> <span class="n">NWBHDF5IO</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="read-nwb-files">
<h1>Read NWB files<a class="headerlink" href="#read-nwb-files" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lfp_filepath</span> <span class="o">=</span> <span class="s2">&quot;../../../data/Illusion/lfp_testing/probeA_lfp.nwb&quot;</span>
<span class="n">stim_filepath</span> <span class="o">=</span> <span class="s2">&quot;../../../data/Illusion/lfp_testing/spike_times.nwb&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lfp_io</span> <span class="o">=</span> <span class="n">NWBHDF5IO</span><span class="p">(</span><span class="n">lfp_filepath</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">load_namespaces</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">lfp_file</span> <span class="o">=</span> <span class="n">lfp_io</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">stim_io</span> <span class="o">=</span> <span class="n">NWBHDF5IO</span><span class="p">(</span><span class="n">stim_filepath</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">load_namespaces</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">stim_file</span> <span class="o">=</span> <span class="n">stim_io</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\rcpee\miniconda3\envs\databook\lib\site-packages\hdmf\spec\namespace.py:531: UserWarning: Ignoring cached namespace &#39;hdmf-common&#39; version 1.5.0 because version 1.5.1 is already loaded.
  warn(&quot;Ignoring cached namespace &#39;%s&#39; version %s because version %s is already loaded.&quot;
C:\Users\rcpee\miniconda3\envs\databook\lib\site-packages\hdmf\spec\namespace.py:531: UserWarning: Ignoring cached namespace &#39;core&#39; version 2.4.0 because version 2.5.0 is already loaded.
  warn(&quot;Ignoring cached namespace &#39;%s&#39; version %s because version %s is already loaded.&quot;
C:\Users\rcpee\miniconda3\envs\databook\lib\site-packages\hdmf\spec\namespace.py:531: UserWarning: Ignoring cached namespace &#39;hdmf-experimental&#39; version 0.1.0 because version 0.2.0 is already loaded.
  warn(&quot;Ignoring cached namespace &#39;%s&#39; version %s because version %s is already loaded.&quot;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lfp</span> <span class="o">=</span> <span class="n">lfp_file</span><span class="o">.</span><span class="n">acquisition</span><span class="p">[</span><span class="s2">&quot;probe_0_lfp_data&quot;</span><span class="p">]</span>
<span class="n">series</span> <span class="o">=</span> <span class="n">lfp</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stimulus_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">stim_file</span><span class="o">.</span><span class="n">intervals</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stimulus_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;ICkcfg0_presentations&#39;, &#39;ICkcfg1_presentations&#39;, &#39;ICwcfg0_presentations&#39;, &#39;ICwcfg1_presentations&#39;, &#39;RFCI_presentations&#39;, &#39;invalid_times&#39;, &#39;sizeCI_presentations&#39;, &#39;spontaneous_presentations&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualizing-stimuli">
<h1>Visualizing stimuli<a class="headerlink" href="#visualizing-stimuli" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stim_name</span> <span class="o">=</span> <span class="s2">&quot;ICwcfg1_presentations&quot;</span>
<span class="n">stim_table</span> <span class="o">=</span> <span class="n">stim_file</span><span class="o">.</span><span class="n">intervals</span><span class="p">[</span><span class="n">stim_name</span><span class="p">]</span>

<span class="nb">print</span><span class="p">({</span><span class="n">frame</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">stim_table</span><span class="o">.</span><span class="n">frame</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 11.0, 12.0, 13.0, 14.0, 15.0, 16.0, 17.0, 18.0, 19.0, 20.0, 21.0}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">stim_table</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    start_time   stop_time stimulus_name  stimulus_block  frame  \
id                                                                
0    99.256575   99.656919       ICwcfg1             0.0    0.0   
1    99.656919  100.057262       ICwcfg1             0.0    0.0   
2   100.057262  100.457598       ICwcfg1             0.0    0.0   
3   100.457598  100.857927       ICwcfg1             0.0    0.0   
4   100.857927  101.258255       ICwcfg1             0.0    0.0   
5   101.258255  101.658603       ICwcfg1             0.0    0.0   
6   101.658603  102.058950       ICwcfg1             0.0    0.0   
7   102.058950  102.459292       ICwcfg1             0.0    0.0   
8   102.459292  102.859629       ICwcfg1             0.0    0.0   
9   102.859629  103.259965       ICwcfg1             0.0    0.0   
10  103.259965  103.660305       ICwcfg1             0.0    0.0   
11  103.660305  104.060644       ICwcfg1             0.0    0.0   
12  104.060644  104.460976       ICwcfg1             0.0    0.0   
13  104.460976  104.861301       ICwcfg1             0.0    0.0   
14  104.861301  105.261625       ICwcfg1             0.0    0.0   
15  105.261625  105.661977       ICwcfg1             0.0    0.0   
16  105.661977  106.062328       ICwcfg1             0.0    0.0   
17  106.062328  106.462662       ICwcfg1             0.0    0.0   
18  106.462662  106.862979       ICwcfg1             0.0    0.0   
19  106.862979  107.263295       ICwcfg1             0.0    0.0   
20  107.263295  107.663651       ICwcfg1             0.0    0.0   
21  107.663651  108.064006       ICwcfg1             0.0    0.0   
22  108.064006  108.464336       ICwcfg1             0.0    0.0   
23  108.464336  108.864641       ICwcfg1             0.0    0.0   
24  108.864641  109.264945       ICwcfg1             0.0    0.0   
25  109.264945  109.665317       ICwcfg1             0.0    0.0   
26  109.665317  110.065688       ICwcfg1             0.0    0.0   
27  110.065688  110.466034       ICwcfg1             0.0    0.0   
28  110.466034  110.866355       ICwcfg1             0.0    0.0   
29  110.866355  111.266675       ICwcfg1             0.0    0.0   
30  111.266675  111.667035       ICwcfg1             0.0    0.0   
31  111.667035  112.067394       ICwcfg1             0.0    0.0   
32  112.067394  112.467730       ICwcfg1             0.0    0.0   
33  112.467730  112.868043       ICwcfg1             0.0    0.0   
34  112.868043  113.268355       ICwcfg1             0.0    0.0   
35  113.268355  113.668707       ICwcfg1             0.0    0.0   
36  113.668707  114.069058       ICwcfg1             0.0    0.0   
37  114.069058  114.469392       ICwcfg1             0.0    0.0   
38  114.469392  114.869709       ICwcfg1             0.0    0.0   
39  114.869709  115.270025       ICwcfg1             0.0    0.0   
40  115.270025  115.670377       ICwcfg1             0.0    0.0   
41  115.670377  116.070728       ICwcfg1             0.0    0.0   
42  116.070728  116.471068       ICwcfg1             0.0    0.0   
43  116.471068  116.871397       ICwcfg1             0.0    0.0   
44  116.871397  117.271725       ICwcfg1             0.0    0.0   
45  117.271725  117.672081       ICwcfg1             0.0    0.0   
46  117.672081  118.072436       ICwcfg1             0.0    0.0   
47  118.072436  118.472770       ICwcfg1             0.0    0.0   
48  118.472770  118.873083       ICwcfg1             0.0    0.0   
49  118.873083  119.273395       ICwcfg1             0.0    0.0   

    stimulus_index                      tags  \
id                                             
0              0.0  [stimulus_time_interval]   
1              0.0  [stimulus_time_interval]   
2              0.0  [stimulus_time_interval]   
3              0.0  [stimulus_time_interval]   
4              0.0  [stimulus_time_interval]   
5              0.0  [stimulus_time_interval]   
6              0.0  [stimulus_time_interval]   
7              0.0  [stimulus_time_interval]   
8              0.0  [stimulus_time_interval]   
9              0.0  [stimulus_time_interval]   
10             0.0  [stimulus_time_interval]   
11             0.0  [stimulus_time_interval]   
12             0.0  [stimulus_time_interval]   
13             0.0  [stimulus_time_interval]   
14             0.0  [stimulus_time_interval]   
15             0.0  [stimulus_time_interval]   
16             0.0  [stimulus_time_interval]   
17             0.0  [stimulus_time_interval]   
18             0.0  [stimulus_time_interval]   
19             0.0  [stimulus_time_interval]   
20             0.0  [stimulus_time_interval]   
21             0.0  [stimulus_time_interval]   
22             0.0  [stimulus_time_interval]   
23             0.0  [stimulus_time_interval]   
24             0.0  [stimulus_time_interval]   
25             0.0  [stimulus_time_interval]   
26             0.0  [stimulus_time_interval]   
27             0.0  [stimulus_time_interval]   
28             0.0  [stimulus_time_interval]   
29             0.0  [stimulus_time_interval]   
30             0.0  [stimulus_time_interval]   
31             0.0  [stimulus_time_interval]   
32             0.0  [stimulus_time_interval]   
33             0.0  [stimulus_time_interval]   
34             0.0  [stimulus_time_interval]   
35             0.0  [stimulus_time_interval]   
36             0.0  [stimulus_time_interval]   
37             0.0  [stimulus_time_interval]   
38             0.0  [stimulus_time_interval]   
39             0.0  [stimulus_time_interval]   
40             0.0  [stimulus_time_interval]   
41             0.0  [stimulus_time_interval]   
42             0.0  [stimulus_time_interval]   
43             0.0  [stimulus_time_interval]   
44             0.0  [stimulus_time_interval]   
45             0.0  [stimulus_time_interval]   
46             0.0  [stimulus_time_interval]   
47             0.0  [stimulus_time_interval]   
48             0.0  [stimulus_time_interval]   
49             0.0  [stimulus_time_interval]   

                                           timeseries  
id                                                     
0   [(1, 1, timestamps pynwb.base.TimeSeries at 0x...  
1   [(2, 1, timestamps pynwb.base.TimeSeries at 0x...  
2   [(3, 1, timestamps pynwb.base.TimeSeries at 0x...  
3   [(4, 1, timestamps pynwb.base.TimeSeries at 0x...  
4   [(5, 1, timestamps pynwb.base.TimeSeries at 0x...  
5   [(6, 1, timestamps pynwb.base.TimeSeries at 0x...  
6   [(7, 1, timestamps pynwb.base.TimeSeries at 0x...  
7   [(8, 1, timestamps pynwb.base.TimeSeries at 0x...  
8   [(9, 1, timestamps pynwb.base.TimeSeries at 0x...  
9   [(10, 1, timestamps pynwb.base.TimeSeries at 0...  
10  [(11, 1, timestamps pynwb.base.TimeSeries at 0...  
11  [(12, 1, timestamps pynwb.base.TimeSeries at 0...  
12  [(13, 1, timestamps pynwb.base.TimeSeries at 0...  
13  [(14, 1, timestamps pynwb.base.TimeSeries at 0...  
14  [(15, 1, timestamps pynwb.base.TimeSeries at 0...  
15  [(16, 1, timestamps pynwb.base.TimeSeries at 0...  
16  [(17, 1, timestamps pynwb.base.TimeSeries at 0...  
17  [(18, 1, timestamps pynwb.base.TimeSeries at 0...  
18  [(19, 1, timestamps pynwb.base.TimeSeries at 0...  
19  [(20, 1, timestamps pynwb.base.TimeSeries at 0...  
20  [(21, 1, timestamps pynwb.base.TimeSeries at 0...  
21  [(22, 1, timestamps pynwb.base.TimeSeries at 0...  
22  [(23, 1, timestamps pynwb.base.TimeSeries at 0...  
23  [(24, 1, timestamps pynwb.base.TimeSeries at 0...  
24  [(25, 1, timestamps pynwb.base.TimeSeries at 0...  
25  [(26, 1, timestamps pynwb.base.TimeSeries at 0...  
26  [(27, 1, timestamps pynwb.base.TimeSeries at 0...  
27  [(28, 1, timestamps pynwb.base.TimeSeries at 0...  
28  [(29, 1, timestamps pynwb.base.TimeSeries at 0...  
29  [(30, 1, timestamps pynwb.base.TimeSeries at 0...  
30  [(31, 1, timestamps pynwb.base.TimeSeries at 0...  
31  [(32, 1, timestamps pynwb.base.TimeSeries at 0...  
32  [(33, 1, timestamps pynwb.base.TimeSeries at 0...  
33  [(34, 1, timestamps pynwb.base.TimeSeries at 0...  
34  [(35, 1, timestamps pynwb.base.TimeSeries at 0...  
35  [(36, 1, timestamps pynwb.base.TimeSeries at 0...  
36  [(37, 1, timestamps pynwb.base.TimeSeries at 0...  
37  [(38, 1, timestamps pynwb.base.TimeSeries at 0...  
38  [(39, 1, timestamps pynwb.base.TimeSeries at 0...  
39  [(40, 1, timestamps pynwb.base.TimeSeries at 0...  
40  [(41, 1, timestamps pynwb.base.TimeSeries at 0...  
41  [(42, 1, timestamps pynwb.base.TimeSeries at 0...  
42  [(43, 1, timestamps pynwb.base.TimeSeries at 0...  
43  [(44, 1, timestamps pynwb.base.TimeSeries at 0...  
44  [(45, 1, timestamps pynwb.base.TimeSeries at 0...  
45  [(46, 1, timestamps pynwb.base.TimeSeries at 0...  
46  [(47, 1, timestamps pynwb.base.TimeSeries at 0...  
47  [(48, 1, timestamps pynwb.base.TimeSeries at 0...  
48  [(49, 1, timestamps pynwb.base.TimeSeries at 0...  
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>49  [(50, 1, timestamps pynwb.base.TimeSeries at 0...  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select_frame</span> <span class="o">=</span> <span class="mf">13.0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### extract timestamps for given stimulus frame</span>

<span class="n">stim_timestamps</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">prev_frame</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stim_table</span><span class="p">)):</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">stim_table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">frame</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">prev_frame</span> <span class="ow">and</span> <span class="n">row</span><span class="o">.</span><span class="n">frame</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">select_frame</span><span class="p">:</span>
        <span class="n">stim_timestamps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">start_time</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prev_frame</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">frame</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stim_timestamps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[128.08084646720096, 139.29023498262623, 142.492946467201, 148.09768446720096, 175.32051498262624, 188.13134646720096, 236.17172846720095, 242.577108467201, 250.583848467201, 254.58722046720095, 260.19194246720093, 329.8504967249136, 343.4619449826262, 347.4652849826262, 358.6747204672009, 363.47873498262624, 370.68482046720095, 371.4854849826263, 375.4888249826262, 377.0902127249136, 411.51910498262623, 428.33328046720095, 447.5494449826262, 481.9783927249136, 502.795910467201, 505.9985747249136, 510.802626467201, 523.6133649826262, 526.0154287249137, 529.2181067249136, 541.2282127249135, 551.6369649826262, 559.6436749826262, 562.846384467201, 571.6537649826262, 589.2686027249135, 590.0692787249136, 592.4712984672009, 596.474656467201, 603.6807049826263, 614.890148467201, 617.2921567249136, 618.0928247249136, 630.903616467201, 651.7210749826262, 661.3291587249136, 666.9338924672011, 674.1399267249136, 687.7513849826262, 695.7581149826262, 702.1635207249136, 719.7783249826263, 720.579004467201, 722.981014467201, 731.7883949826262, 742.997828467201, 746.2005147249137, 747.001214467201, 764.6160264672011, 773.4234147249136, 775.0247724672009, 781.4301607249135, 809.4537007249136, 810.2543767249136, 823.8658049826262, 859.8960949826262, 870.3048567249136, 895.9263849826262, 898.3284287249136, 916.743904467201, 928.754020467201, 934.3587247249136, 936.760742467201, 948.7708404672012, 968.787666467201, 972.791022467201, 999.213242467201, 1000.0138749826262, 1004.817956467201, 1040.848244467201, 1068.0710949826262, 1088.0879249826262, 1100.8987244672007, 1116.1114949826265, 1123.3175704672012, 1131.324302467201, 1144.9357604672014, 1155.344486467201, 1161.7498907249137, 1163.3512264672008, 1167.3545524672008, 1176.1619649826262, 1178.5640107249135, 1194.5774767249136, 1208.9895904672012, 1210.590938724914, 1211.3916184672012, 1235.4118164672009, 1236.2124649826264, 1238.6144927249138, 1242.6178667249137, 1251.425268467201, 1252.2259249826266, 1279.4488244672011, 1292.2595549826265, 1295.462278467201, 1308.2730249826263, 1309.073744467201, 1329.8912327249136, 1341.9013307249138, 1342.7019987249137, 1353.9114167249136, 1373.1275864672011, 1377.9316107249138, 1384.3369949826265, 1386.7390287249136, 1389.9417167249137, 1390.7423887249138, 1426.7726707249135, 1427.5733664672011, 1429.9753487249136, 1437.982092724914, 1440.3841149826262, 1442.7861487249138, 1462.8029727249136, 1470.8096947249137, 1485.2218084672008, 1510.0426967249136, 1515.6473984672011, 1526.856794724914, 1534.0628727249136, 1555.681048467201, 1558.0830767249136, 1562.0864347249135, 1565.2891304672012, 1566.0897967249134, 1590.1099947249136, 1628.5422749826262, 1640.5523849826263, 1653.3631884672009, 1663.7719324672007, 1665.3732924672013, 1673.3800084672012, 1679.785380467201, 1684.5894049826263, 1696.5995049826265, 1709.410316467201, 1729.4271204672011, 1731.0284647249136, 1734.2311507249135, 1743.0385707249138, 1752.6466249826262, 1759.8527064672012, 1760.6533549826263, 1775.8661584672009, 1796.6836249826265, 1810.2950887249133, 1823.105878724914, 1832.7139249826264, 1847.9267384672007, 1848.7273949826265, 1856.7341449826265, 1862.3388727249132, 1874.3489707249137, 1875.1496467249133, 1886.3590507249137, 1889.5617444672007, 1948.0109004672008, 1952.8149249826265, 1966.4263687249136, 1968.8283949826264, 1969.629090467201, 1984.041170467201, 1992.8485749826264, 1997.652622467201, 2000.8553149826264, 2023.2741707249136, 2056.902414982626, 2059.304452724913, 2067.3111827249136, 2085.726680467201, 2098.5374247249133, 2104.1421824672007, 2104.942814982626, 2155.3852327249137, 2161.790622467201, 2173.0000449826266, 2178.604758724914, 2179.405434724914, 2183.408788724914, 2196.219578467201, 2229.0471549826266, 2245.8613024672013, 2250.665342724914, 2260.2733924672016, 2265.0774649826267, 2265.8781524672013, 2277.8882184672016, 2288.2969784672014, 2298.705738724914, 2308.3138004672014, 2313.918530467201, 2336.3373664672013, 2337.938718467202, 2362.759572724914, 2373.9689984672013, 2374.769668724914, 2383.577076724914, 2404.394616467201, 2434.820156724914, 2439.624192724914, 2456.438334467201, 2474.853802724914, 2475.654478724914, 2504.478710467202, 2505.2793749826265, 2506.880732724914, 2507.6814087249136, 2516.4888424672013, 2534.904284724914, 2540.5090304672017, 2550.1171124672014, 2551.718432724914, 2559.725172724914, 2560.5258564672013, 2575.738636724914, 2577.3399849826264, 2578.140664467201, 2586.1473984672016, 2594.1541204672017, 2598.9581687249142, 2606.164232467201, 2612.569600467202, 2624.5797004672017, 2634.1877884672017, 2661.4106449826263, 2667.015348724914, 2675.022088724914, 2683.829512724914, 2689.4342349826265, 2690.2349064672017, 2711.052382724914, 2713.4544049826263, 2720.6604684672016, 2721.461124982626, 2726.2652064672016, 2729.4678849826264, 2754.288760467201, 2768.7008704672016, 2771.903568724914, 2783.112980724913, 2786.315662467201, 2797.5251049826265, 2839.960792724914, 2872.7883784672013, 2873.5890749826262, 2881.5957549826267, 2887.200492724914, 2890.403186467201, 2909.6193449826264, 2912.822036467201, 2916.024718724914, 2928.835492467201, 2932.038198724914, 2932.838882467201, 2941.6462549826265, 2944.8489564672013, 2970.470522467201, 2978.477238467201, 2994.490702467201, 3008.102130724914, 3008.9028064672016, 3018.510890467201, 3020.112228724914, 3022.514236467201, 3028.919650467202, 3031.321684724914, 3041.7303949826264, 3054.541174467201, 3066.5512944672014, 3067.3519447249137, 3076.960032467201, 3083.365410724913, 3108.9869804672016, 3112.189660724914, 3124.199750724914, 3128.2030967249143, 3140.213190724914, 3143.4158967249136, 3153.023972467201, 3156.226690724914, 3175.4428327249143, 3183.449558724914, 3187.452934724914, 3229.0879484672014, 3233.0913064672013, 3241.0980364672014, 3252.3074687249136, 3255.510138724914, 3259.5135047249137, 3263.5168667249136, 3281.1317084672014, 3284.3343787249137, 3317.1619544672017, 3350.790254467201, 3355.5942907249137, 3358.796978467202, 3363.601006724913, 3370.0064149826267, 3400.431988724914, 3403.6346707249136, 3406.0366849826264, 3426.0535149826264, 3429.256218467201, 3431.6582487249143, 3433.259586467201, 3439.6649787249144, 3472.492566724914, 3474.0939349826263, 3492.509390724914, 3509.3235344672016, 3524.536314724914, 3528.539686724914, 3532.543066724914, 3542.951826467201, 3555.762568724914, 3557.3639064672016, 3583.786134724914, 3597.3975764672014, 3600.6002807249142, 3609.4076744672016, 3629.424514467202, 3642.2352749826255, 3644.637310724914, 3648.640658724914, 3650.241994982626, 3651.042690467201, 3655.046052467201, 3667.0561604672016, 3671.860192724914, 3680.667584724914, 3700.684418724914, 3711.893838724914, 3737.515396467201, 3747.1234684672017, 3750.3261449826255, 3779.150402467201, 3779.9510607249135, 3791.9611567249135, 3817.5827304672016, 3840.802232724914, 3850.4103149826265, 3858.4170149826255, 3879.234548467202, 3893.646642467201, 3896.048688724914, 3901.6533644672018, 3912.862820724914, 3934.4809749826254, 3942.4877149826266, 3950.494444982626, 3965.707240467201, 3972.112636724914, 3981.7207104672016, 3991.3287964672018, 3992.930134724914, 3996.933496724914, 3998.5348449826265, 4029.7610944672015, 4035.3657884672016, 4039.3691904672014, 4064.990728724914, 4094.6156549826255, 4103.4230284672, 4104.223692724913, 4112.230436724913, 4117.835128467201, 4130.645904982626, 4147.4600524672005, 4171.480236467201, 4211.513930467201, 4213.915924467201, 4226.726684982626, 4244.3414987249125, 4251.547572467201, 4265.1589987249135, 4269.162362724914, 4293.182572724913, 4297.9866224672, 4312.398726724913, 4318.0034204672, 4319.604780467201, 4320.405464724913, 4323.6081384672, 4324.408802724914, 4328.412176724913, 4329.212848724914, 4337.219586724913, 4346.026986467201, 4357.236410724914]
</pre></div>
</div>
</div>
</div>
</section>
<section id="break">
<h1>BREAK<a class="headerlink" href="#break" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># finding nearest neighbor in lfp time for each stim time</span>

<span class="n">intp_stim_timestamps</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">lfp_ts_idx</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">stim_ts</span> <span class="ow">in</span> <span class="n">stim_timestamps</span><span class="p">:</span>
    <span class="n">nearest_lfp_ts</span> <span class="o">=</span> <span class="n">lfp</span><span class="o">.</span><span class="n">timestamps</span><span class="p">[</span><span class="n">lfp_ts_idx</span><span class="p">]</span>
    <span class="c1"># find nearest neighbor to stim timestamp within lfp timestamps</span>
    <span class="k">while</span><span class="p">(</span><span class="n">stim_ts</span> <span class="o">-</span> <span class="n">nearest_lfp_ts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">diff_t</span> <span class="o">=</span> <span class="n">stim_ts</span> <span class="o">-</span> <span class="n">nearest_lfp_ts</span>
        <span class="n">lfp_ts_idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">nearest_lfp_ts</span> <span class="o">=</span> <span class="n">lfp</span><span class="o">.</span><span class="n">timestamps</span><span class="p">[</span><span class="n">lfp_ts_idx</span><span class="p">]</span>
    <span class="c1"># save nearest neighbor timestamp</span>
    <span class="n">intp_stim_timestamps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nearest_lfp_ts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">intp_stim_timestamps</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>3 arrays:
stim_timestamps
lfp.timestamps
lfp.data</p>
<p>goal: using lfp.timestamps, interpolate every lfp.data element to a stim_timestamps element
iterpolate lfp.timestamps to7 stim_timestamps to create interpolated_timestamps (the main axis) which should be same length as lfp.data
then use interpolated_timestamps as display axis for lfp data
view window can then be filtered based on this axis</p>
<ol class="simple">
<li><p>align stimulus and lfp</p></li>
<li><p>identify events within lfp</p></li>
<li><p>get window of lfp around event</p></li>
<li><p>split lfp eventwise into 3d array</p></li>
<li><p>calculate average across events</p></li>
<li><p>calculate average across nodes and events</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stop_time</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lfp</span><span class="o">.</span><span class="n">timestamps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">stim_timestamps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">time_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">stop_time</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time_axis</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4357237
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lfp</span><span class="o">.</span><span class="n">timestamps</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(11252278,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lfp</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(11252278, 89)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">lfp</span><span class="o">.</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">lfp</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;extrapolate&quot;</span><span class="p">)</span>
<span class="n">intp_lfp</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">time_axis</span><span class="p">)</span>
<span class="nb">print</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">lfp</span><span class="o">.</span><span class="n">data</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lfp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">intp_lfp</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">intp_lfp</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>11252278
[[ 5.55750012e-05  6.37650010e-05  3.97799995e-05 ... -1.95000007e-06
   7.99499958e-06  7.99499958e-06]
 [ 3.12000011e-05  3.72450013e-05 -1.71600004e-05 ... -1.17000000e-05
   1.38449996e-05 -1.17000002e-06]
 [ 7.27349980e-05  9.88649990e-05  5.92799988e-05 ... -2.00849991e-05
  -1.15049997e-05 -5.84999998e-06]
 ...
 [-1.81740004e-04 -1.41960001e-04 -2.02800002e-04 ... -4.17299998e-05
  -3.50999994e-06 -6.43500016e-06]
 [-1.82324991e-04 -1.60290001e-04 -2.15474996e-04 ... -3.25649999e-05
  -3.31499996e-06  1.20899995e-05]
 [-2.08650003e-04 -1.86809993e-04 -2.50574987e-04 ... -2.82750007e-05
   5.84999998e-06 -1.95000007e-06]]
4357237
[[ 5.5575e-05  6.3765e-05  3.9780e-05 ... -1.9500e-06  7.9950e-06
   7.9950e-06]
 [ 5.5575e-05  6.3765e-05  3.9780e-05 ... -1.9500e-06  7.9950e-06
   7.9950e-06]
 [ 5.5575e-05  6.3765e-05  3.9780e-05 ... -1.9500e-06  7.9950e-06
   7.9950e-06]
 ...
 [ 5.5575e-05  6.3765e-05  3.9780e-05 ... -1.9500e-06  7.9950e-06
   7.9950e-06]
 [ 5.5575e-05  6.3765e-05  3.9780e-05 ... -1.9500e-06  7.9950e-06
   7.9950e-06]
 [ 5.5575e-05  6.3765e-05  3.9780e-05 ... -1.9500e-06  7.9950e-06
   7.9950e-06]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">intp_lfp_measurements</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">lfp_idx</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="n">time_axis</span><span class="p">:</span>
    <span class="n">nearest_lfp_ts</span> <span class="o">=</span> <span class="n">lfp</span><span class="o">.</span><span class="n">timestamps</span><span class="p">[</span><span class="n">lfp_idx</span><span class="p">]</span>
    <span class="c1"># find nearest neighbor to timestamp within lfp timestamps</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
    <span class="k">while</span><span class="p">(</span><span class="n">nearest_lfp_ts</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">diff_t</span> <span class="o">=</span> <span class="n">nearest_lfp_ts</span> <span class="o">-</span> <span class="n">ts</span>
        <span class="n">lfp_idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">nearest_lfp_ts</span> <span class="o">=</span> <span class="n">lfp</span><span class="o">.</span><span class="n">timestamps</span><span class="p">[</span><span class="n">lfp_idx</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">lfp_idx</span><span class="p">,</span> <span class="n">nearest_lfp_ts</span><span class="p">)</span>
    <span class="c1"># save nearest neighbor timestamp</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;saving&quot;</span><span class="p">,</span><span class="n">lfp_idx</span><span class="p">)</span>
    <span class="n">intp_lfp_measurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lfp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">lfp_idx</span><span class="p">])</span>
    <span class="k">break</span>
<span class="nb">print</span><span class="p">(</span><span class="n">intp_lfp_measurements</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id1">
<h1>BREAK<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### get closest corresponding lfp index to the stimulus timestamps</span>

<span class="n">lfp_events</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">lfp_ts_idx</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">stim_ts</span> <span class="ow">in</span> <span class="n">stim_timestamps</span><span class="p">:</span>

    <span class="n">lfp_ts</span> <span class="o">=</span> <span class="n">lfp</span><span class="o">.</span><span class="n">timestamps</span><span class="p">[</span><span class="n">lfp_ts_idx</span><span class="p">]</span>
    <span class="k">while</span><span class="p">(</span><span class="n">lfp_ts</span> <span class="o">&lt;</span> <span class="n">stim_ts</span><span class="p">):</span>
        <span class="n">lfp_ts_idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">lfp_ts</span> <span class="o">=</span> <span class="n">lfp</span><span class="o">.</span><span class="n">timestamps</span><span class="p">[</span><span class="n">lfp_ts_idx</span><span class="p">]</span>
    <span class="n">lfp_ts_idx</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="n">lfp_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lfp_ts_idx</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">lfp_events</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interval_start</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.05</span>
<span class="n">interval_end</span> <span class="o">=</span> <span class="mf">0.25</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get lfp data intervals for viewing</span>

<span class="k">if</span> <span class="n">interval_start</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;interval start must be non-positive&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">interval_end</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;interval end must be positive&quot;</span><span class="p">)</span>
    
<span class="n">lfp_event_intervals</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">lfp_event</span> <span class="ow">in</span> <span class="n">lfp_events</span><span class="p">:</span>
    <span class="n">event_ts</span> <span class="o">=</span> <span class="n">lfp</span><span class="o">.</span><span class="n">timestamps</span><span class="p">[</span><span class="n">lfp_event</span><span class="p">]</span>
    
    <span class="c1"># iterate backward to get start time idx</span>
    <span class="n">start_idx</span> <span class="o">=</span> <span class="n">lfp_event</span>
    <span class="n">start_ts</span> <span class="o">=</span> <span class="n">lfp</span><span class="o">.</span><span class="n">timestamps</span><span class="p">[</span><span class="n">start_idx</span><span class="p">]</span>
    <span class="k">while</span><span class="p">(</span><span class="n">start_ts</span> <span class="o">&gt;</span> <span class="n">event_ts</span> <span class="o">+</span> <span class="n">interval_start</span><span class="p">):</span>
        <span class="n">start_idx</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">start_idx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">start_ts</span> <span class="o">=</span> <span class="n">lfp</span><span class="o">.</span><span class="n">timestamps</span><span class="p">[</span><span class="n">start_idx</span><span class="p">]</span>
    
    <span class="c1"># iterate forward to get end time idx</span>
    <span class="n">end_idx</span> <span class="o">=</span> <span class="n">lfp_event</span>
    <span class="n">end_ts</span> <span class="o">=</span> <span class="n">lfp</span><span class="o">.</span><span class="n">timestamps</span><span class="p">[</span><span class="n">end_idx</span><span class="p">]</span>
    <span class="k">while</span><span class="p">(</span><span class="n">end_ts</span> <span class="o">&lt;</span> <span class="n">event_ts</span> <span class="o">+</span> <span class="n">interval_end</span><span class="p">):</span>
        <span class="n">end_idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">end_idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lfp</span><span class="o">.</span><span class="n">timestamps</span><span class="p">):</span>
            <span class="k">break</span>
        <span class="n">end_ts</span> <span class="o">=</span> <span class="n">lfp</span><span class="o">.</span><span class="n">timestamps</span><span class="p">[</span><span class="n">end_idx</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">start_idx</span> <span class="o">&gt;=</span> <span class="n">end_idx</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;interval too small&quot;</span><span class="p">)</span>
        
    <span class="n">lfp_event_intervals</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Interval for event at </span><span class="si">{</span><span class="n">lfp_event</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">start_idx</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">end_idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">node</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">event_num</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># nodewise view</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span> <span class="o">=</span> <span class="n">lfp_event_intervals</span><span class="p">[</span><span class="n">event_num</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lfp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">,</span><span class="n">node</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "AllenInstitute/openscope_databook",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./visualization"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Carter Peene<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>