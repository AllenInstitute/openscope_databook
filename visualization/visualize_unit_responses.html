
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Visualizing Neuronal Unit Responses &#8212; OpenScope Databook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-TJPN1M4PDX"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-TJPN1M4PDX');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-TJPN1M4PDX');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'visualization/visualize_unit_responses';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Visualizing 2P Responses to Stimulus" href="visualize_2p_responses.html" />
    <link rel="prev" title="Visualizing LFP Responses to Stimuli" href="visualize_lfp_responses.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="OpenScope Databook - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="OpenScope Databook - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    OpenScope Databook
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../basics/background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/download_nwb.html">Downloading an NWB File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/stream_nwb.html">Streaming an NWB File with remfile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/read_nwb.html">Reading an NWB File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/use_nwbwidgets.html">Exploring an NWB File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/get_dandiset_metadata.html">Getting Experimental Metadata from DANDI</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Visualizing NWB Files</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="visualize_2p_raw.html">Visualizing Raw 2-Photon Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualize_unit_metrics.html">Visualizing Unit Quality Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualize_lfp_responses.html">Visualizing LFP Responses to Stimuli</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Visualizing Neuronal Unit Responses</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualize_2p_responses.html">Visualizing 2P Responses to Stimulus</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualize_unit_spikes.html">Visualizing Neuronal Unit Spikes</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">First-Order Analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../first-order/receptive_fields.html">Showing Receptive Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="../first-order/optotagging.html">Identifying Optotagged Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../first-order/current_source_density.html">Current Source Density Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../first-order/classify_waveforms.html">Classifying Fast-Spiking and Regular-Spiking Neurons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../first-order/test_2p_responses.html">Statistically Testing 2P Responses to Stimulus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../first-order/suite2p.html">Identifying Regions of Interest with Segmentation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Higher-Order Analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../higher-order/cebra_time.html">Using CEBRA-Time to Identify Latent Embeddings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../higher-order/tca.html">Tensor Decomposition of Spiking Activity Through Trials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../higher-order/behavioral_state.html">Behavioral State from Trial Outcomes</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Openscope Experimental Projects</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../projects/cred_assign_figures.html">Replicating OpenScope Credit Assignment project figures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects/glo.html">OpenScope’s Global/Local Oddball Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects/illusion.html">OpenScope’s Illusion Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects/dendritic_coupling.html">OpenScope’s Dendritic Coupling Dataset</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Embargoed Datasets</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../embargoed/modality_alignment.html">Aligning Data across Modalities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../embargoed/visualize_behavior.html">Visualizing Behavioral Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../embargoed/test_2p_responses_embargoed.html">Statistically Testing 2P Responses to Stimulus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../embargoed/cell_matching.html">Cell Matching Across Days</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Methods</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../methods/jupyter_book.html">Jupyter/Jupyter Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methods/github.html">Git/Github</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methods/environments.html">Managing Environments on Multiple Platforms</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../contribution.html">Contributing to the Databook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors_index.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html">FAQ</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/AllenInstitute/openscope_databook/main?urlpath=tree/docs/visualization/visualize_unit_responses.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://hub.dandiarchive.org/hub/user-redirect/git-pull?repo=https%3A//github.com/AllenInstitute/openscope_databook&urlpath=tree/openscope_databook/docs/visualization/visualize_unit_responses.ipynb&branch=main" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on JupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="JupyterHub logo" src="../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/AllenInstitute/openscope_databook/blob/main/docs/visualization/visualize_unit_responses.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/AllenInstitute/openscope_databook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/AllenInstitute/openscope_databook/issues/new?title=Issue%20on%20page%20%2Fvisualization/visualize_unit_responses.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/visualization/visualize_unit_responses.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Visualizing Neuronal Unit Responses</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#environment-setup">Environment Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-ecephys-file">Downloading Ecephys File</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-unit-data-and-stimulus-data">Extracting Unit Data and Stimulus Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-stimulus-epochs">Getting Stimulus Epochs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-unit-activity-throughout-epochs">Visualizing Unit Activity Throughout Epochs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#probewise-activity-throughout-epochs">Probewise Activity Throughout Epochs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regionwise-activity-throughout-epochs">Regionwise Activity Throughout Epochs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#showing-spike-times">Showing Spike Times</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-waveforms">Visualizing Waveforms</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#peak-waveform">Peak waveform</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#waveforms">Waveforms</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#waveform-image">Waveform Image</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="visualizing-neuronal-unit-responses">
<h1>Visualizing Neuronal Unit Responses<a class="headerlink" href="#visualizing-neuronal-unit-responses" title="Link to this heading">#</a></h1>
<p>Note: Some of this content is adapted from the <a class="reference external" href="https://allensdk.readthedocs.io/en/latest/_static/examples/nb/ecephys_session.html">Allen SDK Documentation</a>.</p>
<p>After processing Neuropixels ecephys data with <strong><a class="reference external" href="https://github.com/MouseLand/Kilosort">Kilosort</a></strong>, individual neuronal units have been identified and are stored in the units table, in the <code class="docutils literal notranslate"><span class="pre">Units</span></code> section of the NWB file. The units table contains information about hypothetical neurons determined by Kilosort. With this information and the stimulus information found in the stimulus tables of the <code class="docutils literal notranslate"><span class="pre">Intervals</span></code> section, this notebook helps examine the spiking behavior of these units in response to stimuli and their associated waveforms</p>
<section id="environment-setup">
<h2>Environment Setup<a class="headerlink" href="#environment-setup" title="Link to this heading">#</a></h2>
<p>⚠️<strong>Note: If running on a new environment, run this cell once and then restart the kernel</strong>⚠️</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">databook_utils.dandi_utils</span> <span class="kn">import</span> <span class="n">dandi_download_open</span>
<span class="k">except</span><span class="p">:</span>
    <span class="o">!</span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/AllenInstitute/openscope_databook.git
    <span class="o">%</span><span class="k">cd</span> openscope_databook
    <span class="o">%</span><span class="k">pip</span> install -e .
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
</section>
<section id="downloading-ecephys-file">
<h2>Downloading Ecephys File<a class="headerlink" href="#downloading-ecephys-file" title="Link to this heading">#</a></h2>
<p>Change the values below to download the file you’re interested in. Set <code class="docutils literal notranslate"><span class="pre">dandiset_id</span></code> and <code class="docutils literal notranslate"><span class="pre">dandi_filepath</span></code> to correspond to the dandiset id and filepath of the file you want. If you’re accessing an embargoed dataset, set <code class="docutils literal notranslate"><span class="pre">dandi_api_key</span></code> to your DANDI API key. If you want to stream a file instead of downloading it, use <code class="docutils literal notranslate"><span class="pre">dandi_stream_open</span></code> instead. Checkout <a class="reference internal" href="../basics/stream_nwb.html"><span class="std std-doc">Streaming an NWB File with remfile</span></a> for more details on this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dandiset_id</span> <span class="o">=</span> <span class="s2">&quot;000021&quot;</span>
<span class="n">dandi_filepath</span> <span class="o">=</span> <span class="s2">&quot;sub-703279277/sub-703279277_ses-719161530.nwb&quot;</span>
<span class="n">download_loc</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
<span class="n">dandi_api_key</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This can sometimes take a while depending on the size of the file</span>
<span class="n">io</span> <span class="o">=</span> <span class="n">dandi_download_open</span><span class="p">(</span><span class="n">dandiset_id</span><span class="p">,</span> <span class="n">dandi_filepath</span><span class="p">,</span> <span class="n">download_loc</span><span class="p">,</span> <span class="n">dandi_api_key</span><span class="o">=</span><span class="n">dandi_api_key</span><span class="p">)</span>
<span class="n">nwb</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A newer version (0.62.1) of dandi/dandi-cli is available. You are using 0.55.1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>File already exists
Opening file
</pre></div>
</div>
</div>
</div>
</section>
<section id="extracting-unit-data-and-stimulus-data">
<h2>Extracting Unit Data and Stimulus Data<a class="headerlink" href="#extracting-unit-data-and-stimulus-data" title="Link to this heading">#</a></h2>
<p>Below, the <code class="docutils literal notranslate"><span class="pre">Units</span></code> table is read from the file. Individual units (putative neurons) are identified with the <code class="docutils literal notranslate"><span class="pre">id</span></code> column. Note that, while each id is unique, they are not perfectly ordinal; some ids are missing. In the cells below, the unit properties are listed and a slice of the units table is shown. More thorough descriptions of units and their properties can be found in <a class="reference internal" href="visualize_unit_metrics.html"><span class="std std-doc">Visualizing Unit Quality Metrics</span></a></p>
<p>Additionally, the stimulus data is also read from the NWB file’s <code class="docutils literal notranslate"><span class="pre">Intervals</span></code> section. Stimulus information is stored as a series of tables depending on the type of stimulus shown in the session. One such table is displayed below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">units</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">units</span>
<span class="n">units</span><span class="o">.</span><span class="n">colnames</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;waveform_duration&#39;,
 &#39;cluster_id&#39;,
 &#39;peak_channel_id&#39;,
 &#39;cumulative_drift&#39;,
 &#39;amplitude_cutoff&#39;,
 &#39;snr&#39;,
 &#39;recovery_slope&#39;,
 &#39;isolation_distance&#39;,
 &#39;nn_miss_rate&#39;,
 &#39;silhouette_score&#39;,
 &#39;velocity_above&#39;,
 &#39;quality&#39;,
 &#39;PT_ratio&#39;,
 &#39;l_ratio&#39;,
 &#39;velocity_below&#39;,
 &#39;max_drift&#39;,
 &#39;isi_violations&#39;,
 &#39;firing_rate&#39;,
 &#39;amplitude&#39;,
 &#39;local_index&#39;,
 &#39;spread&#39;,
 &#39;waveform_halfwidth&#39;,
 &#39;d_prime&#39;,
 &#39;presence_ratio&#39;,
 &#39;repolarization_slope&#39;,
 &#39;nn_hit_rate&#39;,
 &#39;spike_times&#39;,
 &#39;spike_amplitudes&#39;,
 &#39;waveform_mean&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">units</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>waveform_duration</th>
      <th>cluster_id</th>
      <th>peak_channel_id</th>
      <th>cumulative_drift</th>
      <th>amplitude_cutoff</th>
      <th>snr</th>
      <th>recovery_slope</th>
      <th>isolation_distance</th>
      <th>nn_miss_rate</th>
      <th>silhouette_score</th>
      <th>...</th>
      <th>local_index</th>
      <th>spread</th>
      <th>waveform_halfwidth</th>
      <th>d_prime</th>
      <th>presence_ratio</th>
      <th>repolarization_slope</th>
      <th>nn_hit_rate</th>
      <th>spike_times</th>
      <th>spike_amplitudes</th>
      <th>waveform_mean</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>950921187</th>
      <td>0.604355</td>
      <td>4</td>
      <td>850249267</td>
      <td>481.80</td>
      <td>0.425574</td>
      <td>2.209140</td>
      <td>-0.118430</td>
      <td>17.537571</td>
      <td>0.009496</td>
      <td>0.036369</td>
      <td>...</td>
      <td>4</td>
      <td>50.0</td>
      <td>0.357119</td>
      <td>2.962274</td>
      <td>0.99</td>
      <td>0.381716</td>
      <td>0.473829</td>
      <td>[1.0439430431793884, 1.543311060144649, 2.7287...</td>
      <td>[0.0001908626967721937, 0.00016134635752077775...</td>
      <td>[[0.0, 0.5961149999999966, 5.378099999999993, ...</td>
    </tr>
    <tr>
      <th>950921172</th>
      <td>0.521943</td>
      <td>3</td>
      <td>850249267</td>
      <td>681.53</td>
      <td>0.390098</td>
      <td>1.959983</td>
      <td>-0.109729</td>
      <td>14.677643</td>
      <td>0.003857</td>
      <td>0.103446</td>
      <td>...</td>
      <td>3</td>
      <td>40.0</td>
      <td>0.260972</td>
      <td>2.067810</td>
      <td>0.99</td>
      <td>0.536663</td>
      <td>0.445946</td>
      <td>[10.406435026164546, 17.127986534673788, 18.48...</td>
      <td>[0.00014485615850768024, 0.0001722424107984555...</td>
      <td>[[0.0, -1.341600000000002, -0.4586399999999933...</td>
    </tr>
    <tr>
      <th>950921152</th>
      <td>0.467002</td>
      <td>2</td>
      <td>850249267</td>
      <td>1070.71</td>
      <td>0.500000</td>
      <td>2.522905</td>
      <td>-0.109867</td>
      <td>15.783665</td>
      <td>0.017776</td>
      <td>0.027818</td>
      <td>...</td>
      <td>2</td>
      <td>50.0</td>
      <td>0.247236</td>
      <td>2.220043</td>
      <td>0.99</td>
      <td>0.566559</td>
      <td>0.284058</td>
      <td>[1.2775103414155262, 2.3915133536963493, 3.701...</td>
      <td>[0.00014859435856024575, 0.0001531048673600236...</td>
      <td>[[0.0, -0.6427199999999993, -2.836079999999998...</td>
    </tr>
    <tr>
      <th>950921135</th>
      <td>0.467002</td>
      <td>1</td>
      <td>850249267</td>
      <td>253.42</td>
      <td>0.500000</td>
      <td>2.803475</td>
      <td>-0.150379</td>
      <td>26.666930</td>
      <td>0.023742</td>
      <td>0.076530</td>
      <td>...</td>
      <td>1</td>
      <td>40.0</td>
      <td>0.233501</td>
      <td>2.339206</td>
      <td>0.99</td>
      <td>0.669090</td>
      <td>0.590737</td>
      <td>[9.473732504122962, 13.198542576065163, 18.302...</td>
      <td>[0.00032386170367170055, 0.0004518112387675137...</td>
      <td>[[0.0, -3.2800950000000078, -6.087510000000009...</td>
    </tr>
    <tr>
      <th>950921111</th>
      <td>0.439531</td>
      <td>0</td>
      <td>850249267</td>
      <td>141.82</td>
      <td>0.018056</td>
      <td>4.647943</td>
      <td>-0.328727</td>
      <td>66.901065</td>
      <td>0.006595</td>
      <td>NaN</td>
      <td>...</td>
      <td>0</td>
      <td>30.0</td>
      <td>0.219765</td>
      <td>4.395994</td>
      <td>0.99</td>
      <td>1.261416</td>
      <td>0.952667</td>
      <td>[1.1677100445138795, 1.1707767194728813, 1.349...</td>
      <td>[0.00015644521007973124, 0.000214412247939483,...</td>
      <td>[[0.0, -0.9291749999999945, -6.120270000000007...</td>
    </tr>
    <tr>
      <th>950927711</th>
      <td>1.455946</td>
      <td>482</td>
      <td>850249273</td>
      <td>2.46</td>
      <td>0.000895</td>
      <td>1.651500</td>
      <td>-0.039932</td>
      <td>39.400278</td>
      <td>0.000033</td>
      <td>NaN</td>
      <td>...</td>
      <td>464</td>
      <td>100.0</td>
      <td>0.274707</td>
      <td>5.557479</td>
      <td>0.37</td>
      <td>0.467365</td>
      <td>0.000000</td>
      <td>[2613.8652081509977, 2624.5193369599215, 2734....</td>
      <td>[0.00012946663895843286, 0.0001203425053985725...</td>
      <td>[[0.0, 6.3216435986159105, 10.324204152249129,...</td>
    </tr>
    <tr>
      <th>950921285</th>
      <td>2.087772</td>
      <td>11</td>
      <td>850249273</td>
      <td>318.53</td>
      <td>0.036848</td>
      <td>1.379817</td>
      <td>NaN</td>
      <td>27.472722</td>
      <td>0.000903</td>
      <td>0.291953</td>
      <td>...</td>
      <td>11</td>
      <td>100.0</td>
      <td>0.288442</td>
      <td>2.751337</td>
      <td>0.89</td>
      <td>0.372116</td>
      <td>0.258065</td>
      <td>[39.04904580954626, 39.457346913598556, 40.495...</td>
      <td>[7.768399792002802e-05, 8.405736507197006e-05,...</td>
      <td>[[0.0, 5.330324999999991, 2.4261899999999486, ...</td>
    </tr>
    <tr>
      <th>950921271</th>
      <td>0.947739</td>
      <td>10</td>
      <td>850249273</td>
      <td>1008.50</td>
      <td>0.001727</td>
      <td>1.420617</td>
      <td>-0.008204</td>
      <td>30.027595</td>
      <td>0.000707</td>
      <td>0.406673</td>
      <td>...</td>
      <td>10</td>
      <td>100.0</td>
      <td>0.288442</td>
      <td>3.847234</td>
      <td>0.96</td>
      <td>0.498618</td>
      <td>0.796491</td>
      <td>[16.751918851114475, 26.127977537450867, 28.65...</td>
      <td>[0.00016516929470324686, 0.0001501058102103845...</td>
      <td>[[0.0, -3.103230000000032, 5.680349999999983, ...</td>
    </tr>
    <tr>
      <th>950921260</th>
      <td>0.453266</td>
      <td>9</td>
      <td>850249273</td>
      <td>175.00</td>
      <td>0.000081</td>
      <td>4.969091</td>
      <td>-0.184456</td>
      <td>89.804006</td>
      <td>0.000000</td>
      <td>0.223876</td>
      <td>...</td>
      <td>9</td>
      <td>60.0</td>
      <td>0.192295</td>
      <td>5.274090</td>
      <td>0.99</td>
      <td>1.140487</td>
      <td>0.997333</td>
      <td>[0.9620761551434307, 2.092045877265143, 2.4040...</td>
      <td>[0.0003836112198262231, 0.0004093908262843732,...</td>
      <td>[[0.0, 1.9104149999999982, -7.270770000000016,...</td>
    </tr>
    <tr>
      <th>950921248</th>
      <td>0.439531</td>
      <td>8</td>
      <td>850249273</td>
      <td>261.11</td>
      <td>0.065478</td>
      <td>2.147758</td>
      <td>-0.085677</td>
      <td>84.145512</td>
      <td>0.005474</td>
      <td>0.076346</td>
      <td>...</td>
      <td>8</td>
      <td>60.0</td>
      <td>0.274707</td>
      <td>3.022387</td>
      <td>0.99</td>
      <td>0.463570</td>
      <td>0.976667</td>
      <td>[1.316477113448928, 1.779311698293908, 2.96088...</td>
      <td>[0.00013780619334124896, 0.0001439873831056905...</td>
      <td>[[0.0, -3.6761399999999953, 0.8334300000000014...</td>
    </tr>
  </tbody>
</table>
<p>10 rows × 29 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stimulus_names</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">intervals</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stimulus_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;drifting_gratings_presentations&#39;, &#39;flashes_presentations&#39;, &#39;gabors_presentations&#39;, &#39;invalid_times&#39;, &#39;natural_movie_one_presentations&#39;, &#39;natural_movie_three_presentations&#39;, &#39;natural_scenes_presentations&#39;, &#39;spontaneous_presentations&#39;, &#39;static_gratings_presentations&#39;])
</pre></div>
</div>
</div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stim_table</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">intervals</span><span class="p">[</span><span class="s2">&quot;flashes_presentations&quot;</span><span class="p">]</span>
<span class="n">stim_table</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>start_time</th>
      <th>stop_time</th>
      <th>stimulus_name</th>
      <th>stimulus_block</th>
      <th>color</th>
      <th>mask</th>
      <th>opacity</th>
      <th>phase</th>
      <th>size</th>
      <th>units</th>
      <th>stimulus_index</th>
      <th>orientation</th>
      <th>spatial_frequency</th>
      <th>contrast</th>
      <th>tags</th>
      <th>timeseries</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1290.883097</td>
      <td>1291.133309</td>
      <td>flashes</td>
      <td>1.0</td>
      <td>-1.0</td>
      <td>None</td>
      <td>1.0</td>
      <td>[0.0, 0.0]</td>
      <td>[300.0, 300.0]</td>
      <td>deg</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>[0.0, 0.0]</td>
      <td>0.8</td>
      <td>[stimulus_time_interval]</td>
      <td>[(3647, 1, timestamps pynwb.base.TimeSeries at...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1292.884817</td>
      <td>1293.135016</td>
      <td>flashes</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>None</td>
      <td>1.0</td>
      <td>[0.0, 0.0]</td>
      <td>[300.0, 300.0]</td>
      <td>deg</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>[0.0, 0.0]</td>
      <td>0.8</td>
      <td>[stimulus_time_interval]</td>
      <td>[(3648, 1, timestamps pynwb.base.TimeSeries at...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1294.886487</td>
      <td>1295.136691</td>
      <td>flashes</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>None</td>
      <td>1.0</td>
      <td>[0.0, 0.0]</td>
      <td>[300.0, 300.0]</td>
      <td>deg</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>[0.0, 0.0]</td>
      <td>0.8</td>
      <td>[stimulus_time_interval]</td>
      <td>[(3649, 1, timestamps pynwb.base.TimeSeries at...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1296.888137</td>
      <td>1297.138344</td>
      <td>flashes</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>None</td>
      <td>1.0</td>
      <td>[0.0, 0.0]</td>
      <td>[300.0, 300.0]</td>
      <td>deg</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>[0.0, 0.0]</td>
      <td>0.8</td>
      <td>[stimulus_time_interval]</td>
      <td>[(3650, 1, timestamps pynwb.base.TimeSeries at...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1298.889787</td>
      <td>1299.140004</td>
      <td>flashes</td>
      <td>1.0</td>
      <td>-1.0</td>
      <td>None</td>
      <td>1.0</td>
      <td>[0.0, 0.0]</td>
      <td>[300.0, 300.0]</td>
      <td>deg</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>[0.0, 0.0]</td>
      <td>0.8</td>
      <td>[stimulus_time_interval]</td>
      <td>[(3651, 1, timestamps pynwb.base.TimeSeries at...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>145</th>
      <td>1581.125517</td>
      <td>1581.375726</td>
      <td>flashes</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>None</td>
      <td>1.0</td>
      <td>[0.0, 0.0]</td>
      <td>[300.0, 300.0]</td>
      <td>deg</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>[0.0, 0.0]</td>
      <td>0.8</td>
      <td>[stimulus_time_interval]</td>
      <td>[(3792, 1, timestamps pynwb.base.TimeSeries at...</td>
    </tr>
    <tr>
      <th>146</th>
      <td>1583.127217</td>
      <td>1583.377419</td>
      <td>flashes</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>None</td>
      <td>1.0</td>
      <td>[0.0, 0.0]</td>
      <td>[300.0, 300.0]</td>
      <td>deg</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>[0.0, 0.0]</td>
      <td>0.8</td>
      <td>[stimulus_time_interval]</td>
      <td>[(3793, 1, timestamps pynwb.base.TimeSeries at...</td>
    </tr>
    <tr>
      <th>147</th>
      <td>1585.128807</td>
      <td>1585.379029</td>
      <td>flashes</td>
      <td>1.0</td>
      <td>-1.0</td>
      <td>None</td>
      <td>1.0</td>
      <td>[0.0, 0.0]</td>
      <td>[300.0, 300.0]</td>
      <td>deg</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>[0.0, 0.0]</td>
      <td>0.8</td>
      <td>[stimulus_time_interval]</td>
      <td>[(3794, 1, timestamps pynwb.base.TimeSeries at...</td>
    </tr>
    <tr>
      <th>148</th>
      <td>1587.130507</td>
      <td>1587.380724</td>
      <td>flashes</td>
      <td>1.0</td>
      <td>-1.0</td>
      <td>None</td>
      <td>1.0</td>
      <td>[0.0, 0.0]</td>
      <td>[300.0, 300.0]</td>
      <td>deg</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>[0.0, 0.0]</td>
      <td>0.8</td>
      <td>[stimulus_time_interval]</td>
      <td>[(3795, 1, timestamps pynwb.base.TimeSeries at...</td>
    </tr>
    <tr>
      <th>149</th>
      <td>1589.132187</td>
      <td>1589.382401</td>
      <td>flashes</td>
      <td>1.0</td>
      <td>-1.0</td>
      <td>None</td>
      <td>1.0</td>
      <td>[0.0, 0.0]</td>
      <td>[300.0, 300.0]</td>
      <td>deg</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>[0.0, 0.0]</td>
      <td>0.8</td>
      <td>[stimulus_time_interval]</td>
      <td>[(3796, 1, timestamps pynwb.base.TimeSeries at...</td>
    </tr>
  </tbody>
</table>
<p>150 rows × 16 columns</p>
</div></div></div>
</div>
</section>
<section id="getting-stimulus-epochs">
<h2>Getting Stimulus Epochs<a class="headerlink" href="#getting-stimulus-epochs" title="Link to this heading">#</a></h2>
<p>Here, <em>epochs</em> are extracted from the stimulus tables. In this case, an epoch is a continuous period of time during a session where a particular type of stimulus is shown. The output here is a list of epochs, where an epoch is a tuple of four values; the stimulus name, the stimulus block, the starting time and the ending time. Since stimulus information can vary significantly between experiments and NWB files, you may need to tailor the code below to extract epochs for the file you’re interested in.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># extract epoch times from stim table where stimulus rows have a different &#39;block&#39; than following row</span>
<span class="c1"># returns list of epochs, where an epoch is of the form (stimulus name, stimulus block, start time, stop time)</span>
<span class="k">def</span> <span class="nf">extract_epochs</span><span class="p">(</span><span class="n">stim_name</span><span class="p">,</span> <span class="n">stim_table</span><span class="p">,</span> <span class="n">epochs</span><span class="p">):</span>
    
    <span class="c1"># specify a current epoch stop and start time</span>
    <span class="n">epoch_start</span> <span class="o">=</span> <span class="n">stim_table</span><span class="o">.</span><span class="n">start_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">epoch_stop</span> <span class="o">=</span> <span class="n">stim_table</span><span class="o">.</span><span class="n">stop_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># for each row, try to extend current epoch stop_time</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stim_table</span><span class="p">)):</span>
        <span class="n">this_block</span> <span class="o">=</span> <span class="n">stim_table</span><span class="o">.</span><span class="n">stimulus_block</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="c1"># if end of table, end the current epoch</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stim_table</span><span class="p">):</span>
            <span class="n">epochs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">stim_name</span><span class="p">,</span> <span class="n">this_block</span><span class="p">,</span> <span class="n">epoch_start</span><span class="p">,</span> <span class="n">epoch_stop</span><span class="p">))</span>
            <span class="k">break</span>
            
        <span class="n">next_block</span> <span class="o">=</span> <span class="n">stim_table</span><span class="o">.</span><span class="n">stimulus_block</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># if next row is the same stim block, push back epoch_stop time</span>
        <span class="k">if</span> <span class="n">next_block</span> <span class="o">==</span> <span class="n">this_block</span><span class="p">:</span>
            <span class="n">epoch_stop</span> <span class="o">=</span> <span class="n">stim_table</span><span class="o">.</span><span class="n">stop_time</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># otherwise, end the current epoch, start new epoch</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">epochs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">stim_name</span><span class="p">,</span> <span class="n">this_block</span><span class="p">,</span> <span class="n">epoch_start</span><span class="p">,</span> <span class="n">epoch_stop</span><span class="p">))</span>
            <span class="n">epoch_start</span> <span class="o">=</span> <span class="n">stim_table</span><span class="o">.</span><span class="n">start_time</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">epoch_stop</span> <span class="o">=</span> <span class="n">stim_table</span><span class="o">.</span><span class="n">stop_time</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">epochs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># extract epochs from all valid stimulus tables</span>
<span class="n">epochs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">stim_name</span> <span class="ow">in</span> <span class="n">stimulus_names</span><span class="p">:</span>
    <span class="n">stim_table</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">intervals</span><span class="p">[</span><span class="n">stim_name</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">epochs</span> <span class="o">=</span> <span class="n">extract_epochs</span><span class="p">(</span><span class="n">stim_name</span><span class="p">,</span> <span class="n">stim_table</span><span class="p">,</span> <span class="n">epochs</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">continue</span>

<span class="c1"># epochs take the form (stimulus name, stimulus block, start time, stop time)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">epochs</span><span class="p">))</span>
<span class="n">epochs</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="n">epochs</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>15
(&#39;gabors_presentations&#39;, 0.0, 89.8968273815905, 1001.8917716749913)
(&#39;flashes_presentations&#39;, 1.0, 1290.8830973815907, 1589.382401312724)
(&#39;drifting_gratings_presentations&#39;, 2.0, 1591.1338573815906, 2190.634543106125)
(&#39;natural_movie_three_presentations&#39;, 3.0, 2221.6604473815905, 2822.161967381591)
(&#39;natural_movie_one_presentations&#39;, 4.0, 2852.1870373815905, 3152.4377773815904)
(&#39;drifting_gratings_presentations&#39;, 5.0, 3182.4628573815908, 3781.963503106125)
(&#39;natural_movie_three_presentations&#39;, 6.0, 4083.215117381591, 4683.716567381592)
(&#39;drifting_gratings_presentations&#39;, 7.0, 4713.741627381592, 5397.312443106124)
(&#39;static_gratings_presentations&#39;, 8.0, 5398.31325738159, 5878.714467381591)
(&#39;natural_scenes_presentations&#39;, 9.0, 5908.739537381591, 6389.157337381589)
(&#39;natural_scenes_presentations&#39;, 10.0, 6689.408117381589, 7169.809297381591)
(&#39;static_gratings_presentations&#39;, 11.0, 7199.83431738159, 7680.268867381591)
(&#39;natural_movie_one_presentations&#39;, 12.0, 7710.293937381591, 8010.54467738159)
(&#39;natural_scenes_presentations&#39;, 13.0, 8040.56972738159, 8568.510620243858)
(&#39;static_gratings_presentations&#39;, 14.0, 8611.04613738159, 9151.49746738159)
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualizing-unit-activity-throughout-epochs">
<h2>Visualizing Unit Activity Throughout Epochs<a class="headerlink" href="#visualizing-unit-activity-throughout-epochs" title="Link to this heading">#</a></h2>
<p>Below is a view of the spiking activity of a unit throughout a session, where epochs are shown as colored sections. Set <code class="docutils literal notranslate"><span class="pre">unit_num</span></code> to be the id of the unit to view. Set <code class="docutils literal notranslate"><span class="pre">time_start</span></code> to the starting bound in seconds of the session, you’d like to see, and <code class="docutils literal notranslate"><span class="pre">time_end</span></code> to the ending bound. You may want to use the output above to inform your choice. As mentioned above, if your file’s stimulus information differs significantly, this code may need to be modified to appropriately display the epochs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unit_num</span> <span class="o">=</span> <span class="mi">950930672</span> <span class="c1"># chosen from units table</span>
<span class="n">time_start</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">time_end</span> <span class="o">=</span> <span class="mi">10000</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># translate unit id to row index</span>
<span class="n">unit_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">id</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">units</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">unit_num</span><span class="p">:</span>
        <span class="n">unit_idx</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">break</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unit index:&quot;</span><span class="p">,</span><span class="n">unit_idx</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unit index: 648
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make histogram of unit spikes per second over specified timeframe</span>
<span class="n">spikes</span> <span class="o">=</span> <span class="n">units</span><span class="p">[</span><span class="s2">&quot;spike_times&quot;</span><span class="p">][</span><span class="n">unit_idx</span><span class="p">]</span>
<span class="n">time_bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">,</span> <span class="p">(</span><span class="n">time_end</span><span class="o">-</span><span class="n">time_start</span><span class="p">))</span>
<span class="n">hist</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">spikes</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">time_bin_edges</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># generate plot of spike histogram with colored epoch intervals and legend</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="c1"># assign unique color to each stimulus name</span>
<span class="n">stim_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">({</span><span class="n">epoch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="n">epochs</span><span class="p">})</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">stim_names</span><span class="p">)))</span>
<span class="n">stim_color_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">stim_names</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stim_names</span><span class="p">))}</span>

<span class="n">epoch_key</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>
<span class="c1"># draw colored rectangles for each epoch</span>
<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="n">epochs</span><span class="p">:</span>
    <span class="n">stim_name</span><span class="p">,</span> <span class="n">stim_block</span><span class="p">,</span> <span class="n">epoch_start</span><span class="p">,</span> <span class="n">epoch_end</span> <span class="o">=</span> <span class="n">epoch</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">stim_color_map</span><span class="p">[</span><span class="n">stim_name</span><span class="p">]</span>
    <span class="n">rec</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">epoch_start</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">epoch_end</span><span class="o">-</span><span class="n">epoch_start</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">))</span>
    <span class="n">epoch_key</span><span class="p">[</span><span class="n">stim_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span>
    
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">height</span><span class="o">+</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time (s)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;# spikes&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Unit Spikes Per Second Throughout Epochs&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">epoch_key</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">epoch_key</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.12</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">hist</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x116a86b6280&gt;]
</pre></div>
</div>
<img alt="../_images/b76bbc71e03f16a9a6b8550d1422f6aec595cea5a90ccd679ca321ab372dad26.png" src="../_images/b76bbc71e03f16a9a6b8550d1422f6aec595cea5a90ccd679ca321ab372dad26.png" />
</div>
</div>
</section>
<section id="probewise-activity-throughout-epochs">
<h2>Probewise Activity Throughout Epochs<a class="headerlink" href="#probewise-activity-throughout-epochs" title="Link to this heading">#</a></h2>
<p>It can also be useful to view the activity of an entire probe throughout epochs. The code below allows users to select a probe and a histogram is produced for the total of all unit spiking counts over time for one probe. To do this, the file’s <code class="docutils literal notranslate"><span class="pre">Electrodes</span></code> table is used. To understand this, you need not know anything about the <code class="docutils literal notranslate"><span class="pre">Electrodes</span></code> table, except that it can be used to map channel IDs to probe IDs. Below is printed a list of the probe names to choose from. Set <code class="docutils literal notranslate"><span class="pre">probe_name</span></code> to one of these. Set <code class="docutils literal notranslate"><span class="pre">time_start</span></code> and <code class="docutils literal notranslate"><span class="pre">time_end</span></code> to the start and ending times, in seconds, to view in the session.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">nwb</span><span class="o">.</span><span class="n">devices</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;probeA&#39;, &#39;probeB&#39;, &#39;probeC&#39;, &#39;probeD&#39;, &#39;probeE&#39;, &#39;probeF&#39;])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">probe_name</span> <span class="o">=</span> <span class="s2">&quot;probeC&quot;</span>
<span class="n">time_start</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">time_end</span> <span class="o">=</span> <span class="mi">10000</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get list of channels on this probe</span>
<span class="n">electrodes</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">electrodes</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
<span class="n">channel_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">electrodes</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;group_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">probe_name</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

<span class="c1"># get all spike times from units whose peak channel belongs to the selected probe</span>
<span class="n">probe_spike_times</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">units</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">units</span><span class="p">[</span><span class="s2">&quot;peak_channel_id&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">channel_ids</span><span class="p">:</span>
        <span class="n">probe_spike_times</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">units</span><span class="p">[</span><span class="s2">&quot;spike_times&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
    
<span class="nb">len</span><span class="p">(</span><span class="n">probe_spike_times</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>27741944
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make histogram of unit spikes per second over specified timeframe</span>
<span class="n">time_bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">,</span> <span class="p">(</span><span class="n">time_end</span><span class="o">-</span><span class="n">time_start</span><span class="p">))</span>
<span class="n">hist</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">probe_spike_times</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">time_bin_edges</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># generate plot of spike histogram with colored epoch intervals and legend</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="c1"># assign unique color to each stimulus name</span>
<span class="n">stim_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">({</span><span class="n">epoch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="n">epochs</span><span class="p">})</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">stim_names</span><span class="p">)))</span>
<span class="n">stim_color_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">stim_names</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stim_names</span><span class="p">))}</span>

<span class="n">epoch_key</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>
<span class="c1"># draw colored rectangles for each epoch</span>
<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="n">epochs</span><span class="p">:</span>
    <span class="n">stim_name</span><span class="p">,</span> <span class="n">stim_block</span><span class="p">,</span> <span class="n">epoch_start</span><span class="p">,</span> <span class="n">epoch_end</span> <span class="o">=</span> <span class="n">epoch</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">stim_color_map</span><span class="p">[</span><span class="n">stim_name</span><span class="p">]</span>
    <span class="n">rec</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">epoch_start</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">epoch_end</span><span class="o">-</span><span class="n">epoch_start</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">))</span>
    <span class="n">epoch_key</span><span class="p">[</span><span class="n">stim_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span>
    
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">height</span><span class="o">+</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time (s)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;# spikes&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">probe_name</span><span class="si">}</span><span class="s2"> Spikes Per Second Throughout Epochs&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">epoch_key</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">epoch_key</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.12</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">hist</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x1171e7db820&gt;]
</pre></div>
</div>
<img alt="../_images/ae663fd8c1951924d806fbdd177d8f86e40d3b2a161184ede9d65d5784b0f9ca.png" src="../_images/ae663fd8c1951924d806fbdd177d8f86e40d3b2a161184ede9d65d5784b0f9ca.png" />
</div>
</div>
</section>
<section id="regionwise-activity-throughout-epochs">
<h2>Regionwise Activity Throughout Epochs<a class="headerlink" href="#regionwise-activity-throughout-epochs" title="Link to this heading">#</a></h2>
<p>We can also break down our activity based on brain regions (with a bit of work). To do this, we must first be able to retrieve the brain region of each unit. The trick to do this lay in the <code class="docutils literal notranslate"><span class="pre">Electrodes</span></code> table, shown below. The <code class="docutils literal notranslate"><span class="pre">Electrodes</span></code> table contains the brain region for each electrode id, while the <code class="docutils literal notranslate"><span class="pre">Units</span></code> table (shown above) contains the <code class="docutils literal notranslate"><span class="pre">Peak</span> <span class="pre">Channel</span> <span class="pre">ID</span></code> for each Unit. These can be used together to get the brain region of each unit’s peak channel. Once this is done, this information can be used just like the Probe selection above to get to get spike counts over time of each Unit in a selected region. Below, set <code class="docutils literal notranslate"><span class="pre">brain_region</span></code>, <code class="docutils literal notranslate"><span class="pre">start_time</span></code>, and <code class="docutils literal notranslate"><span class="pre">end_time</span></code> to view such a plot.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nwb</span><span class="o">.</span><span class="n">electrodes</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
      <th>imp</th>
      <th>location</th>
      <th>filtering</th>
      <th>group</th>
      <th>group_name</th>
      <th>probe_vertical_position</th>
      <th>probe_horizontal_position</th>
      <th>probe_id</th>
      <th>local_index</th>
      <th>valid_data</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>850249265</th>
      <td>7955.0</td>
      <td>3766.0</td>
      <td>3766.0</td>
      <td>NaN</td>
      <td>Eth</td>
      <td>AP band: 500 Hz high-pass; LFP band: 1000 Hz l...</td>
      <td>probeB abc.EcephysElectrodeGroup at 0x11968190...</td>
      <td>probeB</td>
      <td>20</td>
      <td>43</td>
      <td>729445650</td>
      <td>0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>850249267</th>
      <td>7955.0</td>
      <td>3756.0</td>
      <td>3756.0</td>
      <td>NaN</td>
      <td>TH</td>
      <td>AP band: 500 Hz high-pass; LFP band: 1000 Hz l...</td>
      <td>probeB abc.EcephysElectrodeGroup at 0x11968190...</td>
      <td>probeB</td>
      <td>20</td>
      <td>11</td>
      <td>729445650</td>
      <td>1</td>
      <td>True</td>
    </tr>
    <tr>
      <th>850249273</th>
      <td>7955.0</td>
      <td>3727.0</td>
      <td>3727.0</td>
      <td>NaN</td>
      <td>TH</td>
      <td>AP band: 500 Hz high-pass; LFP band: 1000 Hz l...</td>
      <td>probeB abc.EcephysElectrodeGroup at 0x11968190...</td>
      <td>probeB</td>
      <td>60</td>
      <td>43</td>
      <td>729445650</td>
      <td>4</td>
      <td>True</td>
    </tr>
    <tr>
      <th>850249277</th>
      <td>7954.0</td>
      <td>3708.0</td>
      <td>3708.0</td>
      <td>NaN</td>
      <td>APN</td>
      <td>AP band: 500 Hz high-pass; LFP band: 1000 Hz l...</td>
      <td>probeB abc.EcephysElectrodeGroup at 0x11968190...</td>
      <td>probeB</td>
      <td>80</td>
      <td>59</td>
      <td>729445650</td>
      <td>6</td>
      <td>True</td>
    </tr>
    <tr>
      <th>850249283</th>
      <td>7954.0</td>
      <td>3679.0</td>
      <td>3679.0</td>
      <td>NaN</td>
      <td>APN</td>
      <td>AP band: 500 Hz high-pass; LFP band: 1000 Hz l...</td>
      <td>probeB abc.EcephysElectrodeGroup at 0x11968190...</td>
      <td>probeB</td>
      <td>100</td>
      <td>11</td>
      <td>729445650</td>
      <td>9</td>
      <td>True</td>
    </tr>
    <tr>
      <th>850249289</th>
      <td>7953.0</td>
      <td>3640.0</td>
      <td>3640.0</td>
      <td>NaN</td>
      <td>APN</td>
      <td>AP band: 500 Hz high-pass; LFP band: 1000 Hz l...</td>
      <td>probeB abc.EcephysElectrodeGroup at 0x11968190...</td>
      <td>probeB</td>
      <td>140</td>
      <td>43</td>
      <td>729445650</td>
      <td>12</td>
      <td>True</td>
    </tr>
    <tr>
      <th>850249295</th>
      <td>7952.0</td>
      <td>3612.0</td>
      <td>3612.0</td>
      <td>NaN</td>
      <td>APN</td>
      <td>AP band: 500 Hz high-pass; LFP band: 1000 Hz l...</td>
      <td>probeB abc.EcephysElectrodeGroup at 0x11968190...</td>
      <td>probeB</td>
      <td>160</td>
      <td>27</td>
      <td>729445650</td>
      <td>15</td>
      <td>True</td>
    </tr>
    <tr>
      <th>850249299</th>
      <td>7952.0</td>
      <td>3593.0</td>
      <td>3593.0</td>
      <td>NaN</td>
      <td>APN</td>
      <td>AP band: 500 Hz high-pass; LFP band: 1000 Hz l...</td>
      <td>probeB abc.EcephysElectrodeGroup at 0x11968190...</td>
      <td>probeB</td>
      <td>180</td>
      <td>11</td>
      <td>729445650</td>
      <td>17</td>
      <td>True</td>
    </tr>
    <tr>
      <th>850249305</th>
      <td>7951.0</td>
      <td>3565.0</td>
      <td>3565.0</td>
      <td>NaN</td>
      <td>APN</td>
      <td>AP band: 500 Hz high-pass; LFP band: 1000 Hz l...</td>
      <td>probeB abc.EcephysElectrodeGroup at 0x11968190...</td>
      <td>probeB</td>
      <td>220</td>
      <td>43</td>
      <td>729445650</td>
      <td>20</td>
      <td>True</td>
    </tr>
    <tr>
      <th>850249311</th>
      <td>7950.0</td>
      <td>3537.0</td>
      <td>3537.0</td>
      <td>NaN</td>
      <td>APN</td>
      <td>AP band: 500 Hz high-pass; LFP band: 1000 Hz l...</td>
      <td>probeB abc.EcephysElectrodeGroup at 0x11968190...</td>
      <td>probeB</td>
      <td>240</td>
      <td>27</td>
      <td>729445650</td>
      <td>23</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># map electrode ids to brain region acronyms</span>
<span class="n">electrode_locations</span> <span class="o">=</span> <span class="p">{</span><span class="n">nwb</span><span class="o">.</span><span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span> <span class="n">nwb</span><span class="o">.</span><span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nwb</span><span class="o">.</span><span class="n">electrodes</span><span class="p">))}</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">electrode_locations</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;&#39;, &#39;Eth&#39;, &#39;VISl&#39;, &#39;VPM&#39;, &#39;POL&#39;, &#39;CA1&#39;, &#39;NOT&#39;, &#39;VISam&#39;, &#39;LGd&#39;, &#39;DG&#39;, &#39;VISal&#39;, &#39;APN&#39;, &#39;VISrl&#39;, &#39;SUB&#39;, &#39;VISpm&#39;, &#39;grey&#39;, &#39;PO&#39;, &#39;CA3&#39;, &#39;VISp&#39;, &#39;LP&#39;, &#39;CA2&#39;, &#39;MB&#39;, &#39;TH&#39;, &#39;VL&#39;}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">brain_region</span> <span class="o">=</span> <span class="s2">&quot;VISpm&quot;</span>
<span class="n">time_start</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">time_end</span> <span class="o">=</span> <span class="mi">10000</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get all spike times from units whose peak channel belongs to the selected brain region</span>
<span class="n">region_spike_times</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">units</span><span class="p">)):</span>
    <span class="n">unit_channel</span> <span class="o">=</span> <span class="n">units</span><span class="p">[</span><span class="s2">&quot;peak_channel_id&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="n">unit_location</span> <span class="o">=</span> <span class="n">electrode_locations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">unit_channel</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">unit_location</span> <span class="o">==</span> <span class="n">brain_region</span><span class="p">:</span>
        <span class="n">region_spike_times</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">units</span><span class="p">[</span><span class="s2">&quot;spike_times&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
    
<span class="nb">len</span><span class="p">(</span><span class="n">region_spike_times</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4178172
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make histogram of unit spikes per second over specified timeframe</span>
<span class="n">time_bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">,</span> <span class="p">(</span><span class="n">time_end</span><span class="o">-</span><span class="n">time_start</span><span class="p">))</span>
<span class="n">hist</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">region_spike_times</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">time_bin_edges</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># generate plot of spike histogram with colored epoch intervals and legend</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="c1"># assign unique color to each stimulus name</span>
<span class="n">stim_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">({</span><span class="n">epoch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="n">epochs</span><span class="p">})</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">stim_names</span><span class="p">)))</span>
<span class="n">stim_color_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">stim_names</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stim_names</span><span class="p">))}</span>

<span class="n">epoch_key</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>
<span class="c1"># draw colored rectangles for each epoch</span>
<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="n">epochs</span><span class="p">:</span>
    <span class="n">stim_name</span><span class="p">,</span> <span class="n">stim_block</span><span class="p">,</span> <span class="n">epoch_start</span><span class="p">,</span> <span class="n">epoch_end</span> <span class="o">=</span> <span class="n">epoch</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">stim_color_map</span><span class="p">[</span><span class="n">stim_name</span><span class="p">]</span>
    <span class="n">rec</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">epoch_start</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">epoch_end</span><span class="o">-</span><span class="n">epoch_start</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">))</span>
    <span class="n">epoch_key</span><span class="p">[</span><span class="n">stim_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span>
    
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">time_start</span><span class="p">,</span> <span class="n">time_end</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">height</span><span class="o">+</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time (s)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;# spikes&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">brain_region</span><span class="si">}</span><span class="s2"> Spikes Per Second Throughout Epochs&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">epoch_key</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">epoch_key</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.12</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">hist</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x1173a0d3910&gt;]
</pre></div>
</div>
<img alt="../_images/f93f9a38b9248796960b96b1d9fba5839019261700a264bfee123a76f08404cd.png" src="../_images/f93f9a38b9248796960b96b1d9fba5839019261700a264bfee123a76f08404cd.png" />
</div>
</div>
</section>
<section id="showing-spike-times">
<h2>Showing Spike Times<a class="headerlink" href="#showing-spike-times" title="Link to this heading">#</a></h2>
<p>Here, a histogram plot of unit spikes over time is created. In the second cell below, set <code class="docutils literal notranslate"><span class="pre">stim_time</span></code> to be the time of the stimulus you’re interested in viewing. To get an idea of the stimulus times you might be interested in, access one of the tables in the <code class="docutils literal notranslate"><span class="pre">Intervals</span></code> section, discussed above in <strong>Extracting Unit Data and Stimulus Data</strong>.  The first cell below shows how to access these. Set <code class="docutils literal notranslate"><span class="pre">interval_start</span></code> and <code class="docutils literal notranslate"><span class="pre">interval_end</span></code> to the relative time bounds, in seconds, of the histogram around <code class="docutils literal notranslate"><span class="pre">stim_time</span></code>. Finally, <code class="docutils literal notranslate"><span class="pre">start_unit</span></code> and <code class="docutils literal notranslate"><span class="pre">end_unit</span></code> can be used to choose the slice indices of <code class="docutils literal notranslate"><span class="pre">selected_units</span></code> to display.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stim_time</span> <span class="o">=</span> <span class="mi">1007</span> <span class="c1"># arbitrarily chosen here</span>
<span class="n">interval_start</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>
<span class="n">interval_end</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">start_unit</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">end_unit</span> <span class="o">=</span> <span class="mi">500</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spike_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">units</span><span class="p">[</span><span class="s2">&quot;spike_times&quot;</span><span class="p">][</span><span class="n">start_unit</span><span class="p">:</span><span class="n">end_unit</span><span class="p">]]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spike_times</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;There are no spiking units in this selection&quot;</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">spike_times</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>400
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for each unit, generate a histogram with 275 bins, where bins represent the number spikes per second</span>
<span class="n">time_bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">interval_start</span><span class="p">,</span> <span class="n">interval_end</span><span class="p">,</span> <span class="mi">276</span><span class="p">)</span>
<span class="n">hists</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">unit_spike_times</span> <span class="ow">in</span> <span class="n">spike_times</span><span class="p">:</span>
    <span class="n">hist</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">unit_spike_times</span><span class="o">-</span><span class="n">stim_time</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">time_bin_edges</span><span class="p">)</span>
    <span class="n">hists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>
<span class="n">hists</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hists</span><span class="p">)</span>

<span class="n">hists</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(400, 275)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display array of histograms as 2D image with color</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">hists</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;# spikes&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">NullLocator</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">xtick_step</span><span class="o">=</span><span class="mi">25</span>
<span class="n">reltime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">time_bin_edges</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">reltime</span><span class="p">),</span> <span class="n">xtick_step</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mp</span><span class="si">:</span><span class="s1">1.1f</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">mp</span> <span class="ow">in</span> <span class="n">reltime</span><span class="p">[::</span><span class="n">xtick_step</span><span class="p">]],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time since event (s)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Units Spikes Over Time&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Units Spikes Over Time&#39;)
</pre></div>
</div>
<img alt="../_images/d6b038f1cb1135cdd82ce6c218af8f50512ae3f9e102cc35ba85a963d7e27a55.png" src="../_images/d6b038f1cb1135cdd82ce6c218af8f50512ae3f9e102cc35ba85a963d7e27a55.png" />
</div>
</div>
</section>
<section id="visualizing-waveforms">
<h2>Visualizing Waveforms<a class="headerlink" href="#visualizing-waveforms" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">Units</span></code> table can also be used to view the waveforms of a units with the <code class="docutils literal notranslate"><span class="pre">waveform_mean</span></code> property, which consists of the mean waveform of that unit as measured by each channel along the probe. One channel will contain the peak waveform. With a bit of legwork, the <code class="docutils literal notranslate"><span class="pre">peak_channel_id</span></code> of the unit and the <code class="docutils literal notranslate"><span class="pre">Electrodes</span></code> table can be used to get the single peak waveform as shown below. Just as in the sections above, you don’t need to fully understand the <code class="docutils literal notranslate"><span class="pre">Electrodes</span></code> table except that it can be used to map channel IDs to probe IDs. There is also a timewise and channelwise view of all the mean waveforms and an average of the waveforms across all channels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unit_num</span> <span class="o">=</span> <span class="mi">950952910</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># translate unit id to row index</span>
<span class="n">unit_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">id</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">units</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">unit_num</span><span class="p">:</span>
        <span class="n">unit_idx</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">break</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unit index:&quot;</span><span class="p">,</span><span class="n">unit_idx</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unit index: 2513
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get sampling Hz for this unit&#39;s waveform</span>
<span class="n">peak_channel_id</span> <span class="o">=</span> <span class="n">units</span><span class="p">[</span><span class="s2">&quot;peak_channel_id&quot;</span><span class="p">][</span><span class="n">unit_idx</span><span class="p">]</span>
<span class="n">electrodes</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">electrodes</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
<span class="n">probe_name</span> <span class="o">=</span> <span class="n">electrodes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">peak_channel_id</span><span class="p">]</span><span class="o">.</span><span class="n">group_name</span>

<span class="n">Hz</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="n">probe_name</span><span class="p">]</span><span class="o">.</span><span class="n">sampling_rate</span>
<span class="n">Hz</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>29999.9995000281
</pre></div>
</div>
</div>
</div>
<section id="peak-waveform">
<h3>Peak waveform<a class="headerlink" href="#peak-waveform" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># use peak_channel_id of unit to fetch the peak waveform index from electrodes table</span>
<span class="n">peak_channel_id</span> <span class="o">=</span> <span class="n">units</span><span class="p">[</span><span class="s2">&quot;peak_channel_id&quot;</span><span class="p">][</span><span class="n">unit_idx</span><span class="p">]</span>
<span class="n">electrodes</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">electrodes</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
<span class="n">local_index</span> <span class="o">=</span> <span class="n">electrodes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">peak_channel_id</span><span class="p">]</span><span class="o">.</span><span class="n">local_index</span>

<span class="n">unit_waveform</span> <span class="o">=</span> <span class="n">units</span><span class="p">[</span><span class="s2">&quot;waveform_mean&quot;</span><span class="p">][</span><span class="n">unit_idx</span><span class="p">]</span>
<span class="n">peak_waveform</span> <span class="o">=</span> <span class="n">unit_waveform</span><span class="p">[</span><span class="n">local_index</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">n_secs</span> <span class="o">=</span> <span class="n">peak_waveform</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">Hz</span>
<span class="n">time_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_secs</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">peak_waveform</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_axis</span><span class="p">,</span> <span class="n">peak_waveform</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time (ms)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;membrane potential (uV)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Unit Peak Waveform&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/656731995c6ca9bd87a0a0a73ae822c08511f38294ad05210177ba6c15f87178.png" src="../_images/656731995c6ca9bd87a0a0a73ae822c08511f38294ad05210177ba6c15f87178.png" />
</div>
</div>
</section>
<section id="waveforms">
<h3>Waveforms<a class="headerlink" href="#waveforms" title="Link to this heading">#</a></h3>
<p>Given the way Kilosort attributes spikes to specific units, most electrodes along the probe will detect nothing for a given unit. As the electrodes get closer to the actual source of the spikes, the waveform amplitude should increase and take shape. To get a very clear representation of a unit’s activity through space, the waveforms for a unit from all probes can be plotted. It can be seen that as the electrode gets further from the peak waveform, the amplitude decreases until the unit is too far away to be detected.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unit_waveforms</span> <span class="o">=</span> <span class="n">units</span><span class="p">[</span><span class="s2">&quot;waveform_mean&quot;</span><span class="p">][</span><span class="n">unit_idx</span><span class="p">]</span>
<span class="n">unit_waveforms</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(384, 82)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">unit_waveforms</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_prop_cycle</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>

<span class="n">n_secs</span> <span class="o">=</span> <span class="n">unit_waveforms</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">Hz</span>
<span class="n">time_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_secs</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">unit_waveforms</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_axis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">unit_waveforms</span><span class="p">))</span>

<span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span>
<span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;channel #&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time (ms)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;membrane potential (uV)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Unit Waveforms&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/1c45be688bce5773364133d6dd2d1a246ce91001064b29f9ac449a0c39c9b24a.png" src="../_images/1c45be688bce5773364133d6dd2d1a246ce91001064b29f9ac449a0c39c9b24a.png" />
</div>
</div>
</section>
<section id="waveform-image">
<h3>Waveform Image<a class="headerlink" href="#waveform-image" title="Link to this heading">#</a></h3>
<p>Below is an image of the waveform means for each channel of a unit. The further in space from the real neuron, the weaker the measurement of the response waveform, so it is usually only useful to view a subsection of the channels at once. Set <code class="docutils literal notranslate"><span class="pre">start_channel</span></code> and <code class="docutils literal notranslate"><span class="pre">end_channel</span></code> to be the bounds of the channels you want displayed. Because on neuropixels probes the channels are arranged into two rows along the length of a probe, typically a unit is only strongly detected by every other channel. The data shown below displays every other channel to avoid the resultant striping effect. If the waveform looks too dim, try incrementing <code class="docutils literal notranslate"><span class="pre">start_channel</span></code> by 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start_channel</span> <span class="o">=</span> <span class="mi">230</span>
<span class="n">end_channel</span> <span class="o">=</span> <span class="mi">280</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">unit_waveforms</span><span class="p">[</span><span class="n">start_channel</span><span class="p">:</span><span class="n">end_channel</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># step by 2 to remove striping effect</span>
<span class="n">n_channels</span> <span class="o">=</span> <span class="n">end_channel</span> <span class="o">-</span> <span class="n">start_channel</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">n_channels</span> <span class="o">//</span> <span class="mi">15</span><span class="p">))</span>

<span class="n">n_secs</span> <span class="o">=</span> <span class="n">unit_waveforms</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">Hz</span>
<span class="n">time_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_secs</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">unit_waveforms</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;membrane potential (uV)&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time (ms)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;channel #&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Unit Waveforms Image&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_secs</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="n">end_channel</span><span class="p">,</span> <span class="n">start_channel</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x1a5326baf50&gt;
</pre></div>
</div>
<img alt="../_images/af55e8a5d5ba0e58b161cee4a06ba73ed599a7dc2ba294c96bb7620bfbe5f5b9.png" src="../_images/af55e8a5d5ba0e58b161cee4a06ba73ed599a7dc2ba294c96bb7620bfbe5f5b9.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "AllenInstitute/openscope_databook",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./visualization"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="visualize_lfp_responses.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Visualizing LFP Responses to Stimuli</p>
      </div>
    </a>
    <a class="right-next"
       href="visualize_2p_responses.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Visualizing 2P Responses to Stimulus</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#environment-setup">Environment Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-ecephys-file">Downloading Ecephys File</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-unit-data-and-stimulus-data">Extracting Unit Data and Stimulus Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-stimulus-epochs">Getting Stimulus Epochs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-unit-activity-throughout-epochs">Visualizing Unit Activity Throughout Epochs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#probewise-activity-throughout-epochs">Probewise Activity Throughout Epochs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regionwise-activity-throughout-epochs">Regionwise Activity Throughout Epochs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#showing-spike-times">Showing Spike Times</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-waveforms">Visualizing Waveforms</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#peak-waveform">Peak waveform</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#waveforms">Waveforms</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#waveform-image">Waveform Image</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Carter Peene
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>