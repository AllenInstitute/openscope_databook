

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Statistically Testing 2P Responses to Stimulus &#8212; OpenScope Databook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-TJPN1M4PDX"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-TJPN1M4PDX');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'first-order/test_2p_responses';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Statistically Testing Spike Responses to Stimulus" href="test_spike_responses.html" />
    <link rel="prev" title="Current Source Density Analysis" href="current_source_density.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="OpenScope Databook - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="OpenScope Databook - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    OpenScope Databook
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../basics/background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/download_nwb.html">Downloading an NWB File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/read_nwb.html">Reading an NWB File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/use_nwbwidgets.html">Exploring an NWB File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/stream_nwb.html">Streaming an NWB File with fsspec</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/get_dandiset_metadata.html">Getting Experimental Metadata from DANDI</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Visualizing NWB Files</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../visualization/visualize_2p_raw.html">Visualizing Raw 2-Photon Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/visualize_neuropixel_probes.html">Visualizing Neuropixel Probe Locations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/visualize_unit_metrics.html">Visualizing Unit Quality Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/visualize_lfp_responses.html">Visualizing LFP Responses to Stimulus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/visualize_unit_responses.html">Visualizing Neuronal Unit Responses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/visualize_2p_responses.html">Visualizing 2P Responses to Stimulus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/visualize_unit_spikes.html">Visualizing Unit Spikes</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">First-Order Analysis</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="receptive_fields.html">Showing Receptive Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="optotagging.html">Identifying Optotagged Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="current_source_density.html">Current Source Density Analysis</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Statistically Testing 2P Responses to Stimulus</a></li>
<li class="toctree-l1"><a class="reference internal" href="test_spike_responses.html">Statistically Testing Spike Responses to Stimulus</a></li>
<li class="toctree-l1"><a class="reference internal" href="suite2p.html">Identifying Regions of Interest with Segmentation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Higher-Order Analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../higher-order/cebra_time.html">Using CEBRA-Time to Identify Latent Embeddings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../higher-order/tca.html">Tensor Decomposition of Spiking Activity Through Trials</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Replicating Figures</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../replication/cred_assign_figures.html">Replicating OpenScope Credit Assignment project figures</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Embargoed Datasets</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../embargoed/modality_alignment.html">Aligning Data across Modalities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../embargoed/visualize_behavior.html">Visualizing Behavioral Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../embargoed/test_2p_responses_embargoed.html">Statistically Testing 2P Responses to Stimulus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../embargoed/cell_matching.html">Cell Matching Across Days</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Methods</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../methods/jupyter_book.html">Jupyter/Jupyter Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methods/github.html">Git/Github</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methods/environments.html">Managing Environments on Multiple Platforms</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Bibliography and FAQ</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html">FAQ</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/AllenInstitute/openscope_databook/main?urlpath=tree/docs/first-order/test_2p_responses.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://hub.dandiarchive.org/hub/user-redirect/git-pull?repo=https%3A//github.com/AllenInstitute/openscope_databook&urlpath=tree/openscope_databook/docs/first-order/test_2p_responses.ipynb&branch=main" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onJupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/AllenInstitute/openscope_databook/blob/main/docs/first-order/test_2p_responses.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/AllenInstitute/openscope_databook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/AllenInstitute/openscope_databook/issues/new?title=Issue%20on%20page%20%2Ffirst-order/test_2p_responses.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/first-order/test_2p_responses.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Statistically Testing 2P Responses to Stimulus</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#environment-setup">Environment Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-ophys-file">Downloading Ophys File</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-2p-data-and-stimulus-data">Getting 2P Data and Stimulus Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fluorescence-interpolation">Fluorescence Interpolation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#selecting-stimulus-times">Selecting Stimulus Times</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aligning-stimulus-response-time-windows">Aligning Stimulus Response Time Windows</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-plotting-methods">Defining Plotting Methods</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#viewing-stimulus-response-windows">Viewing Stimulus Response Windows</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#showing-response-windows">Showing Response Windows</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inclusion-criteria">Inclusion Criteria</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inclusion-criterion-1">Inclusion Criterion 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inclusion-criterion-2">Inclusion Criterion 2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inclusion-criterion-3">Inclusion Criterion 3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inclusion-criterion-4">Inclusion Criterion 4</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inclusion-criterion-5">Inclusion Criterion 5</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="statistically-testing-2p-responses-to-stimulus">
<h1>Statistically Testing 2P Responses to Stimulus<a class="headerlink" href="#statistically-testing-2p-responses-to-stimulus" title="Permalink to this heading">#</a></h1>
<p>In most analyses, some form of <em>inclusion criteria</em> is used to select neurons that are “responsive” to the stimulus conditions presented. There are no universally agreed upon inclusion criteria for this type of selection. In <span id="id1">[<a class="reference internal" href="../bibliography.html#id10" title="Natalia Mesa, Jack Waters, and Saskia E. J. de Vries. The effect of inclusion criteria on the functional properties reported in mouse visual cortex. eNeuro, 2021. URL: https://www.eneuro.org/content/eneuro/8/1/ENEURO.0188-20.2021.full.pdf.">Mesa <em>et al.</em>, 2021</a>]</span>, it is demonstrated that the choice of inclusion criteria can dramatically affect what neurons are selected as responsive. This notebook does a similar demonstration, using the same five inclusion criteria on Ophys dF/F recordings to select responsive neurons from one experimental session. It can be seen that very different selections are made depending on the criteria used. This also underscores how different critera might be more or less appropriate for the type of stimulus and the type of measurements being used for analysis. We are sharing these so that this comparison can be reproduced on data and so results can more effectively use this choice to make their results more robust. For more information about dF/F data, see <a class="reference internal" href="../visualization/visualize_2p_responses.html"><span class="doc std std-doc">Visualizing 2P Responses to Stimulus</span></a>.</p>
<section id="environment-setup">
<h2>Environment Setup<a class="headerlink" href="#environment-setup" title="Permalink to this heading">#</a></h2>
<p>⚠️<strong>Note: If running on a new environment, run this cell once and then restart the kernel</strong>⚠️</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">dandi_utils</span> <span class="kn">import</span> <span class="n">dandi_download_open</span>
<span class="k">except</span><span class="p">:</span>
    <span class="o">!</span>git clone https://github.com/AllenInstitute/openscope_databook.git
    <span class="o">%</span><span class="k">cd</span> openscope_databook
    <span class="o">%</span><span class="k">pip</span> install -e .
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">ttest_ind</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
</section>
<section id="downloading-ophys-file">
<h2>Downloading Ophys File<a class="headerlink" href="#downloading-ophys-file" title="Permalink to this heading">#</a></h2>
<p>Change the values below to download the file you’re interested in. In this example, we use the dF/F trace from an Ophys NWB File, so you’ll have to choose one with the same kind of data. Set <code class="docutils literal notranslate"><span class="pre">dandiset_id</span></code> and <code class="docutils literal notranslate"><span class="pre">dandi_filepath</span></code> to correspond to the dandiset id and filepath of the file you want. If you’re accessing an embargoed dataset, set <code class="docutils literal notranslate"><span class="pre">dandi_api_key</span></code> to your DANDI API key.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dandiset_id</span> <span class="o">=</span> <span class="s2">&quot;000036&quot;</span>
<span class="n">dandi_filepath</span> <span class="o">=</span> <span class="s2">&quot;sub-389014/sub-389014_ses-20180705T152908_behavior+image+ophys.nwb&quot;</span>
<span class="n">download_loc</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
<span class="n">dandi_api_key</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">io</span> <span class="o">=</span> <span class="n">dandi_download_open</span><span class="p">(</span><span class="n">dandiset_id</span><span class="p">,</span> <span class="n">dandi_filepath</span><span class="p">,</span> <span class="n">download_loc</span><span class="p">,</span> <span class="n">dandi_api_key</span><span class="o">=</span><span class="n">dandi_api_key</span><span class="p">)</span>
<span class="n">nwb</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>File already exists
Opening file
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\carter.peene\AppData\Local\Programs\Python\Python39\lib\site-packages\hdmf\spec\namespace.py:531: UserWarning: Ignoring cached namespace &#39;hdmf-common&#39; version 1.1.3 because version 1.5.1 is already loaded.
  warn(&quot;Ignoring cached namespace &#39;%s&#39; version %s because version %s is already loaded.&quot;
c:\Users\carter.peene\AppData\Local\Programs\Python\Python39\lib\site-packages\hdmf\spec\namespace.py:531: UserWarning: Ignoring cached namespace &#39;core&#39; version 2.2.5 because version 2.5.0 is already loaded.
  warn(&quot;Ignoring cached namespace &#39;%s&#39; version %s because version %s is already loaded.&quot;
c:\Users\carter.peene\AppData\Local\Programs\Python\Python39\lib\site-packages\pynwb\base.py:193: UserWarning: TimeSeries &#39;running_velocity&#39;: Length of data does not match length of timestamps. Your data may be transposed. Time should be on the 0th dimension
  warn(&quot;%s &#39;%s&#39;: Length of data does not match length of timestamps. Your data may be transposed. &quot;
c:\Users\carter.peene\AppData\Local\Programs\Python\Python39\lib\site-packages\pynwb\ophys.py:360: UserWarning: RoiResponseSeries &#39;imaging_plane_1&#39;: The second dimension of data does not match the length of rois, but instead the first does. Data is oriented incorrectly and should be transposed.
  warnings.warn(&quot;%s &#39;%s&#39;: The second dimension of data does not match the length of rois, &quot;
c:\Users\carter.peene\AppData\Local\Programs\Python\Python39\lib\site-packages\pynwb\base.py:193: UserWarning: RoiResponseSeries &#39;imaging_plane_1&#39;: Length of data does not match length of timestamps. Your data may be transposed. Time should be on the 0th dimension
  warn(&quot;%s &#39;%s&#39;: Length of data does not match length of timestamps. Your data may be transposed. &quot;
c:\Users\carter.peene\AppData\Local\Programs\Python\Python39\lib\site-packages\pynwb\image.py:106: UserWarning: ImageSeries &#39;conspecifics&#39;: Length of data does not match length of timestamps. Your data may be transposed. Time should be on the 0th dimension
  warnings.warn(
c:\Users\carter.peene\AppData\Local\Programs\Python\Python39\lib\site-packages\pynwb\image.py:106: UserWarning: ImageSeries &#39;crickets&#39;: Length of data does not match length of timestamps. Your data may be transposed. Time should be on the 0th dimension
  warnings.warn(
c:\Users\carter.peene\AppData\Local\Programs\Python\Python39\lib\site-packages\pynwb\image.py:106: UserWarning: ImageSeries &#39;dots&#39;: Length of data does not match length of timestamps. Your data may be transposed. Time should be on the 0th dimension
  warnings.warn(
c:\Users\carter.peene\AppData\Local\Programs\Python\Python39\lib\site-packages\pynwb\image.py:106: UserWarning: ImageSeries &#39;human_montage&#39;: Length of data does not match length of timestamps. Your data may be transposed. Time should be on the 0th dimension
  warnings.warn(
c:\Users\carter.peene\AppData\Local\Programs\Python\Python39\lib\site-packages\pynwb\image.py:106: UserWarning: ImageSeries &#39;man_writing&#39;: Length of data does not match length of timestamps. Your data may be transposed. Time should be on the 0th dimension
  warnings.warn(
c:\Users\carter.peene\AppData\Local\Programs\Python\Python39\lib\site-packages\pynwb\image.py:106: UserWarning: ImageSeries &#39;mouse_montage_1&#39;: Length of data does not match length of timestamps. Your data may be transposed. Time should be on the 0th dimension
  warnings.warn(
c:\Users\carter.peene\AppData\Local\Programs\Python\Python39\lib\site-packages\pynwb\image.py:106: UserWarning: ImageSeries &#39;mouse_montage_1_spatial_phase_scramble&#39;: Length of data does not match length of timestamps. Your data may be transposed. Time should be on the 0th dimension
  warnings.warn(
c:\Users\carter.peene\AppData\Local\Programs\Python\Python39\lib\site-packages\pynwb\image.py:106: UserWarning: ImageSeries &#39;mouse_montage_1_temporal_phase_scramble&#39;: Length of data does not match length of timestamps. Your data may be transposed. Time should be on the 0th dimension
  warnings.warn(
c:\Users\carter.peene\AppData\Local\Programs\Python\Python39\lib\site-packages\pynwb\image.py:106: UserWarning: ImageSeries &#39;mouse_montage_2&#39;: Length of data does not match length of timestamps. Your data may be transposed. Time should be on the 0th dimension
  warnings.warn(
c:\Users\carter.peene\AppData\Local\Programs\Python\Python39\lib\site-packages\pynwb\image.py:106: UserWarning: ImageSeries &#39;mousecam&#39;: Length of data does not match length of timestamps. Your data may be transposed. Time should be on the 0th dimension
  warnings.warn(
c:\Users\carter.peene\AppData\Local\Programs\Python\Python39\lib\site-packages\pynwb\image.py:106: UserWarning: ImageSeries &#39;mousecam_spatial_phase_scramble&#39;: Length of data does not match length of timestamps. Your data may be transposed. Time should be on the 0th dimension
  warnings.warn(
c:\Users\carter.peene\AppData\Local\Programs\Python\Python39\lib\site-packages\pynwb\image.py:106: UserWarning: ImageSeries &#39;noise&#39;: Length of data does not match length of timestamps. Your data may be transposed. Time should be on the 0th dimension
  warnings.warn(
c:\Users\carter.peene\AppData\Local\Programs\Python\Python39\lib\site-packages\pynwb\image.py:106: UserWarning: ImageSeries &#39;snake&#39;: Length of data does not match length of timestamps. Your data may be transposed. Time should be on the 0th dimension
  warnings.warn(
c:\Users\carter.peene\AppData\Local\Programs\Python\Python39\lib\site-packages\pynwb\image.py:106: UserWarning: ImageSeries &#39;spontaneous&#39;: Length of data does not match length of timestamps. Your data may be transposed. Time should be on the 0th dimension
  warnings.warn(
</pre></div>
</div>
</div>
</div>
</section>
<section id="getting-2p-data-and-stimulus-data">
<h2>Getting 2P Data and Stimulus Data<a class="headerlink" href="#getting-2p-data-and-stimulus-data" title="Permalink to this heading">#</a></h2>
<p>Below, the fluorescence traces and timestamps are read from the file’s <code class="docutils literal notranslate"><span class="pre">Processing</span></code> section. In this notebook, we will be interested in the DFF trace specifically. Note that the exact format to access these traces can vary between newer and older NWB files, so some adjustments may be necessary. Additionally, the stimulus data is also read from the NWB file’s <code class="docutils literal notranslate"><span class="pre">Intervals</span></code> section. Stimulus information is stored as a series of tables depending on the type of stimulus shown in the session. One such table is displayed below, as well as the names of all the tables. For more information on the dF/F data, see <a class="reference internal" href="../visualization/visualize_2p_responses.html"><span class="doc std std-doc">Visualizing 2P Responses to Stimulus</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># dff = nwb.processing[&quot;ophys&quot;][&quot;dff&quot;]</span>
<span class="c1"># dff_trace = dff.roi_response_series[&quot;traces&quot;].data</span>
<span class="c1"># dff_timestamps = dff.roi_response_series[&quot;traces&quot;].timestamps</span>

<span class="c1"># you make have to change some of these keys</span>
<span class="n">dff</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">processing</span><span class="p">[</span><span class="s2">&quot;ophys&quot;</span><span class="p">][</span><span class="s2">&quot;DfOverF&quot;</span><span class="p">]</span>
<span class="c1"># transpose and cut out last element because this file is improperly formatted</span>
<span class="n">dff_trace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dff</span><span class="o">.</span><span class="n">roi_response_series</span><span class="p">[</span><span class="s2">&quot;imaging_plane_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<span class="n">dff_timestamps</span> <span class="o">=</span> <span class="n">dff</span><span class="o">.</span><span class="n">roi_response_series</span><span class="p">[</span><span class="s2">&quot;imaging_plane_1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">timestamps</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># accessing the above data may look different for older nwb files, like the following</span>
<span class="c1"># dff_trace = dff.roi_response_series[&quot;RoiResponseSeries&quot;].data</span>
<span class="c1"># dff_timestamps = dff.roi_response_series[&quot;RoiResponseSeries&quot;].timestamps</span>

<span class="nb">print</span><span class="p">(</span><span class="n">dff_trace</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dff_timestamps</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(127177, 41)
(127177,)
</pre></div>
</div>
</div>
</div>
</section>
<section id="fluorescence-interpolation">
<h2>Fluorescence Interpolation<a class="headerlink" href="#fluorescence-interpolation" title="Permalink to this heading">#</a></h2>
<p>Because we cannot be certain that the dF/F trace is at a perfectly regular Hz, we will interpolate it to be able to compare stimulus timestamps to their approximate dF/F times. After you have a valid list of timestamps, you can generate a linearly-spaced timestamp array called <code class="docutils literal notranslate"><span class="pre">time_axis</span></code>, and interpolate the dF/F data along it, making interpolated DFF data called <code class="docutils literal notranslate"><span class="pre">interp_dff</span></code>. This should be a 2D array with dimensions <code class="docutils literal notranslate"><span class="pre">roi</span></code> and <code class="docutils literal notranslate"><span class="pre">time</span></code>, where ROIs are the different cells whose fluorescence is measured. Here, the timestamps are interpolated to 10 Hertz, but you can change this by setting <code class="docutils literal notranslate"><span class="pre">interp_hz</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interp_hz</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">dff_trace</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dff_timestamps</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(127177, 41)
(127177,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># generate regularly-space x values and interpolate along it</span>
<span class="n">time_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dff_timestamps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dff_timestamps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">step</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">interp_hz</span><span class="p">))</span>
<span class="n">interp_dff</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># interpolate channel by channel to save RAM</span>
<span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dff_trace</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">dff_timestamps</span><span class="p">,</span> <span class="n">dff_trace</span><span class="p">[:,</span><span class="n">channel</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;extrapolate&quot;</span><span class="p">)</span>
    <span class="n">interp_dff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">time_axis</span><span class="p">))</span>

<span class="n">interp_dff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">interp_dff</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">interp_dff</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(41, 42181)
</pre></div>
</div>
</div>
</div>
</section>
<section id="selecting-stimulus-times">
<h2>Selecting Stimulus Times<a class="headerlink" href="#selecting-stimulus-times" title="Permalink to this heading">#</a></h2>
<p>Different types of stimulus require different kinds of inclusion criteria. Since the available stimulus tables vary significantly depending which NWB file and which experimental session you’re analyzing, you’ll have to adjust some values below. First, select which stimulus table you want by changing the key used below in <code class="docutils literal notranslate"><span class="pre">nwb.intervals</span></code>. The list of stimulus table names is printed below to inform this choice. Additionally, you’ll have to modify the function <code class="docutils literal notranslate"><span class="pre">stim_select</span></code> to select the stimulus times you want to use. In this example, a natural movie of worms is the selected stimulus because natural movies typically evoke strong responses. The repeated frame 40 is chosen here as our selected stimulus time, somewhat arbitrarily.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stimulus_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nwb</span><span class="o">.</span><span class="n">intervals</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stimulus_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># use this if nwb intervals section has no stim information</span>
<span class="k">def</span> <span class="nf">stim_obj_to_table</span><span class="p">(</span><span class="n">nwb</span><span class="p">):</span>
    <span class="n">all_labeled_stim_timestamps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">stim_type</span><span class="p">,</span> <span class="n">stim_obj</span> <span class="ow">in</span> <span class="n">nwb</span><span class="o">.</span><span class="n">stimulus</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">start_times</span> <span class="o">=</span> <span class="n">stim_obj</span><span class="o">.</span><span class="n">timestamps</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">stop_times</span> <span class="o">=</span> <span class="n">stim_obj</span><span class="o">.</span><span class="n">timestamps</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="n">stim_obj</span><span class="o">.</span><span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">start_times</span><span class="p">)</span>
        <span class="n">labeled_timestamps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">start_times</span><span class="p">,</span> <span class="n">stop_times</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span> <span class="p">[</span><span class="n">stim_type</span><span class="p">]</span><span class="o">*</span><span class="n">l</span><span class="p">))</span>
        <span class="n">all_labeled_stim_timestamps</span> <span class="o">+=</span> <span class="n">labeled_timestamps</span>
    
    <span class="n">all_labeled_stim_timestamps</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">stim_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">all_labeled_stim_timestamps</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;start time&quot;</span><span class="p">,</span> <span class="s2">&quot;stop time&quot;</span><span class="p">,</span> <span class="s2">&quot;frame&quot;</span><span class="p">,</span> <span class="s2">&quot;stimulus type&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">stim_table</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># if there&#39;s no stim table, generate one from the stimulus objects</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nwb</span><span class="o">.</span><span class="n">intervals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">stim_table</span> <span class="o">=</span> <span class="n">stim_obj_to_table</span><span class="p">(</span><span class="n">nwb</span><span class="p">)</span>

<span class="c1"># otherwise, select one from options printed above</span>
<span class="c1"># stim_table = nwb.intervals[&quot;movie_worms_fwd_presentations&quot;]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># print(stim_table.colnames)</span>
<span class="n">stim_table</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>start time</th>
      <th>stop time</th>
      <th>frame</th>
      <th>stimulus type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>27.475720</td>
      <td>27.492416</td>
      <td>0</td>
      <td>spontaneous</td>
    </tr>
    <tr>
      <th>1</th>
      <td>27.492416</td>
      <td>27.509112</td>
      <td>0</td>
      <td>spontaneous</td>
    </tr>
    <tr>
      <th>2</th>
      <td>27.509112</td>
      <td>27.525758</td>
      <td>0</td>
      <td>spontaneous</td>
    </tr>
    <tr>
      <th>3</th>
      <td>27.525758</td>
      <td>27.542211</td>
      <td>0</td>
      <td>spontaneous</td>
    </tr>
    <tr>
      <th>4</th>
      <td>27.542211</td>
      <td>27.559146</td>
      <td>0</td>
      <td>spontaneous</td>
    </tr>
    <tr>
      <th>5</th>
      <td>27.559146</td>
      <td>27.575829</td>
      <td>0</td>
      <td>spontaneous</td>
    </tr>
    <tr>
      <th>6</th>
      <td>27.575829</td>
      <td>27.592468</td>
      <td>0</td>
      <td>spontaneous</td>
    </tr>
    <tr>
      <th>7</th>
      <td>27.592468</td>
      <td>27.609146</td>
      <td>0</td>
      <td>spontaneous</td>
    </tr>
    <tr>
      <th>8</th>
      <td>27.609146</td>
      <td>27.625847</td>
      <td>0</td>
      <td>spontaneous</td>
    </tr>
    <tr>
      <th>9</th>
      <td>27.625847</td>
      <td>27.642543</td>
      <td>0</td>
      <td>spontaneous</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="n">stim_table</span><span class="p">[</span><span class="s2">&quot;stimulus type&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;conspecifics&#39;,
 &#39;crickets&#39;,
 &#39;dots&#39;,
 &#39;human_montage&#39;,
 &#39;man_writing&#39;,
 &#39;mouse_montage_1&#39;,
 &#39;mouse_montage_1_spatial_phase_scramble&#39;,
 &#39;mouse_montage_1_temporal_phase_scramble&#39;,
 &#39;mouse_montage_2&#39;,
 &#39;mousecam&#39;,
 &#39;mousecam_spatial_phase_scramble&#39;,
 &#39;noise&#39;,
 &#39;snake&#39;,
 &#39;spontaneous&#39;}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### select start times from table that fit certain critera here</span>

<span class="c1"># stim_select = lambda row: True</span>
<span class="c1"># stim_select = lambda row: float(row.frame) == 40</span>
<span class="c1"># all_stim_times = [float(stim_table[i].start_time) for i in range(len(stim_table)) if stim_select(stim_table[i])]</span>

<span class="n">all_stim_times</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stim_table</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="k">if</span> <span class="n">stim_table</span><span class="p">[</span><span class="s2">&quot;stimulus type&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;mousecam&quot;</span> <span class="ow">and</span> <span class="n">stim_table</span><span class="p">[</span><span class="s2">&quot;frame&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">stim_table</span><span class="p">[</span><span class="s2">&quot;frame&quot;</span><span class="p">][</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">all_stim_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stim_table</span><span class="p">[</span><span class="s2">&quot;start time&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>

<span class="nb">len</span><span class="p">(</span><span class="n">all_stim_times</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10
</pre></div>
</div>
</div>
</div>
</section>
<section id="aligning-stimulus-response-time-windows">
<h2>Aligning Stimulus Response Time Windows<a class="headerlink" href="#aligning-stimulus-response-time-windows" title="Permalink to this heading">#</a></h2>
<p>Now that you have your interpolated dF/F data and the selected stimulus timestamps, you identify the windows of time in the dF/F data that exist around each stimulus event. Since the dF/F data have been interpolated, we can easily translate timestamps to indices within the LFP trace array. Set <code class="docutils literal notranslate"><span class="pre">window_start_time</span></code> to be a negative number, representing the seconds before the stimulus event and <code class="docutils literal notranslate"><span class="pre">window_end_time</span></code> to be number of seconds afterward. Then the <code class="docutils literal notranslate"><span class="pre">windows</span></code> array will be generated as a set of slices of the <code class="docutils literal notranslate"><span class="pre">interp_dff</span></code> trace by using <code class="docutils literal notranslate"><span class="pre">interp_hz</span></code> to convert seconds to array indices. The output of this, the <code class="docutils literal notranslate"><span class="pre">windows</span></code> array, should be a 3D array shape <code class="docutils literal notranslate"><span class="pre">trials</span></code> by <code class="docutils literal notranslate"><span class="pre">rois</span></code> by <code class="docutils literal notranslate"><span class="pre">time</span></code>. These windows can be used for our analysis, and can be used to apply and display the affects of our various inclusion criteria.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">window_start_time</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
<span class="n">window_end_time</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># validate window bounds</span>
<span class="k">if</span> <span class="n">window_start_time</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;start time must be non-positive number&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">window_end_time</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;end time must be positive number&quot;</span><span class="p">)</span>
    
<span class="c1"># get event windows</span>
<span class="n">windows</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">window_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">window_end_time</span><span class="o">-</span><span class="n">window_start_time</span><span class="p">)</span> <span class="o">*</span> <span class="n">interp_hz</span><span class="p">)</span>

<span class="k">for</span> <span class="n">stim_ts</span> <span class="ow">in</span> <span class="n">all_stim_times</span><span class="p">:</span>
    <span class="c1"># convert time to index</span>
    <span class="n">start_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">stim_ts</span> <span class="o">+</span> <span class="n">window_start_time</span> <span class="o">-</span> <span class="n">dff_timestamps</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">interp_hz</span> <span class="p">)</span>
    <span class="n">end_idx</span> <span class="o">=</span> <span class="n">start_idx</span> <span class="o">+</span> <span class="n">window_length</span>
 
    <span class="c1"># bounds checking</span>
    <span class="k">if</span> <span class="n">start_idx</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">end_idx</span> <span class="o">&gt;</span> <span class="n">interp_dff</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">continue</span>
        
    <span class="n">windows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interp_dff</span><span class="p">[:,</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">])</span>
    
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">windows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;There are no windows for these timestamps&quot;</span><span class="p">)</span>

<span class="n">windows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">windows</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="c1"># x100 to convert values to dF/F percentage</span>
<span class="nb">print</span><span class="p">(</span><span class="n">windows</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(10, 41, 50)
</pre></div>
</div>
</div>
</div>
</section>
<section id="defining-plotting-methods">
<h2>Defining Plotting Methods<a class="headerlink" href="#defining-plotting-methods" title="Permalink to this heading">#</a></h2>
<p>Here are a few methods to display the stimulus response windows. These will be used to display the ROIs selected by each inclusion critera. <code class="docutils literal notranslate"><span class="pre">show_dff_response</span></code> can be used to show one stimulus response window (or an average window). <code class="docutils literal notranslate"><span class="pre">show_many_responses</span></code> will be used to show many windows alongside eachother. You can use the resulting plots to compare how different inclusion criteria can affect what rois are selected as <em>responsive</em> neurons.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">show_dff_response</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">dff</span><span class="p">,</span> <span class="n">window_start_time</span><span class="p">,</span> <span class="n">window_end_time</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="p">[],</span> <span class="n">skipticks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;ROI&quot;</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cbar_label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dff</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Input data has length 0; Nothing to display&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">img</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dff</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">window_start_time</span><span class="p">,</span> <span class="n">window_end_time</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dff</span><span class="p">)],</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cbar</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">cbar_label</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dff</span><span class="p">)],</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">yticklabels</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yticklabels</span><span class="p">)))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">yticklabels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

        <span class="n">n_ticks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">yticklabels</span><span class="p">[::</span><span class="n">skipticks</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">n_ticks</span><span class="p">))</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">show_many_responses</span><span class="p">(</span><span class="n">windows</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">window_idxs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subplot_title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cbar_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">window_idxs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">window_idxs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">windows</span><span class="p">))</span>
    <span class="n">windows</span> <span class="o">=</span> <span class="n">windows</span><span class="p">[</span><span class="n">window_idxs</span><span class="p">]</span>
    
    <span class="c1"># handle case with no input data</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">windows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Input data has length 0; Nothing to display&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="c1"># handle cases when there aren&#39;t enough windows for number of rows</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">windows</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">rows</span><span class="o">*</span><span class="n">cols</span><span class="p">:</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">windows</span><span class="p">)</span> <span class="o">//</span> <span class="n">cols</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">cols</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">rows</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;constrained&quot;</span><span class="p">)</span>
    <span class="c1"># handle case when there&#39;s only one row</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">axes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="o">*</span><span class="n">cols</span><span class="p">):</span>
        <span class="n">ax_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">//</span> <span class="n">cols</span><span class="p">)</span>
        <span class="n">ax_col</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="n">cols</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">ax_row</span><span class="p">][</span><span class="n">ax_col</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">windows</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">window</span> <span class="o">=</span> <span class="n">windows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">show_dff_response</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">window_start_time</span><span class="p">,</span> <span class="n">window_end_time</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">subplot_title</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">window_idxs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ax_row</span> <span class="o">!=</span> <span class="n">rows</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ax_col</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
    <span class="n">colorbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">1.5</span><span class="o">/</span><span class="n">rows</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">cbar_label</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="viewing-stimulus-response-windows">
<h2>Viewing Stimulus Response Windows<a class="headerlink" href="#viewing-stimulus-response-windows" title="Permalink to this heading">#</a></h2>
<p>At last we are ready to play with the data. For starters, the stimulus windows can averaged across all stimulus trials to get an average view of how the ROIs respond.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_window</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">windows</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mean_window</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">show_dff_response</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">mean_window</span><span class="p">,</span> <span class="n">window_start_time</span><span class="p">,</span> <span class="n">window_end_time</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">cbar_label</span><span class="o">=</span><span class="s2">&quot;$\Delta$F/F (%)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Mean Response Window&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time (s)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;ROI (neuron)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(41, 50)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;ROI (neuron)&#39;)
</pre></div>
</div>
<img alt="../_images/aa46d48acfde6b69cfbd42848054ef69bc1a3dc63a7c2a5c2c59a1dc6a8a4e46.png" src="../_images/aa46d48acfde6b69cfbd42848054ef69bc1a3dc63a7c2a5c2c59a1dc6a8a4e46.png" />
</div>
</div>
</section>
<section id="showing-response-windows">
<h2>Showing Response Windows<a class="headerlink" href="#showing-response-windows" title="Permalink to this heading">#</a></h2>
<p>This is a view of many of the raw data response windows. Here, we show just the first 24 response windows. It can be seen that some neurons definitely show activity over time. However, it can be difficult to identify any patterns between trials with this view. Below, we also generate a <em>neuronwise</em> view of the first 24 neuron’s response windows. That is, a view of how each neuron responses across all trials. From this, we can see more clearly how neurons behave. Immediately, you can tell that some neurons have an evoked response at the onset of the stimulus, while others appear to be inhibited by the stimulus, and yet others show no strong responses.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_many_responses</span><span class="p">(</span><span class="n">windows</span><span class="p">,</span>
                    <span class="mi">3</span><span class="p">,</span>
                    <span class="mi">8</span><span class="p">,</span>
                    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Responses to Some Trials&quot;</span><span class="p">,</span>
                    <span class="n">subplot_title</span><span class="o">=</span><span class="s2">&quot;Trial&quot;</span><span class="p">,</span>
                    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span>
                    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;ROI (neuron)&quot;</span><span class="p">,</span>
                    <span class="n">cbar_label</span><span class="o">=</span><span class="s2">&quot;$\Delta$F/F (%)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ab484b2b9f8f9e03a2e924046cd98bafcfebe4247376358c5dee47e80c69aa16.png" src="../_images/ab484b2b9f8f9e03a2e924046cd98bafcfebe4247376358c5dee47e80c69aa16.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">neuronwise_windows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">windows</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">show_many_responses</span><span class="p">(</span><span class="n">neuronwise_windows</span><span class="p">,</span>
                    <span class="mi">3</span><span class="p">,</span>
                    <span class="mi">8</span><span class="p">,</span>
                    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Response of Some ROIs across trials&quot;</span><span class="p">,</span>
                    <span class="n">subplot_title</span><span class="o">=</span><span class="s2">&quot;ROI&quot;</span><span class="p">,</span>
                    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span>
                    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;trial&quot;</span><span class="p">,</span>
                    <span class="n">cbar_label</span><span class="o">=</span><span class="s2">&quot;$\Delta$F/F (%)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ad16232ef2b331e8b45acd65d5b07af818efd6f13f5a4799d6f0e5e5fc884ee1.png" src="../_images/ad16232ef2b331e8b45acd65d5b07af818efd6f13f5a4799d6f0e5e5fc884ee1.png" />
</div>
</div>
</section>
<section id="inclusion-criteria">
<h2>Inclusion Criteria<a class="headerlink" href="#inclusion-criteria" title="Permalink to this heading">#</a></h2>
<p>Now we can apply various inclusion critera to see how they affect what neurons are selected. 5 inclusion criteria are demonstrated below, but it should be noted that there are many other ways to select neurons, or to adjust the ones shown here. Different inclusion criteria have different levels of permissiveness, and will result in different behaviors in the selected cells. To start, we split the windows, in time, at the onset of the stimulus to yield the <code class="docutils literal notranslate"><span class="pre">baseline</span></code> activity of each roi, and the <code class="docutils literal notranslate"><span class="pre">evoked_response</span></code> activity. These should have shape <code class="docutils literal notranslate"><span class="pre">trial</span></code> by <code class="docutils literal notranslate"><span class="pre">roi</span></code> by <code class="docutils literal notranslate"><span class="pre">time</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get the index within the window that stimulus occurs (time 0)</span>
<span class="n">stimulus_onset_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="o">-</span><span class="n">window_start_time</span> <span class="o">*</span> <span class="n">interp_hz</span><span class="p">)</span>
<span class="n">baseline</span> <span class="o">=</span> <span class="n">windows</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">:</span><span class="n">stimulus_onset_idx</span><span class="p">]</span>
<span class="n">evoked_responses</span> <span class="o">=</span> <span class="n">windows</span><span class="p">[:,:,</span><span class="n">stimulus_onset_idx</span><span class="p">:]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">stimulus_onset_idx</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">baseline</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">evoked_responses</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>20
(10, 41, 20)
(10, 41, 30)
</pre></div>
</div>
</div>
</div>
<section id="inclusion-criterion-1">
<h3>Inclusion Criterion 1<a class="headerlink" href="#inclusion-criterion-1" title="Permalink to this heading">#</a></h3>
<p>The first criterion is one of the simplest. This one is easy to alter and has a medium level of permissiveness. Below is shown a distribution of the ROI’s maximum mean evoked response. That is, the maximum dF/F value achieved during the evoked averaged response of an ROI to all stimulus trials. A line is drawn to show where the selection is made within the distribution. Also below are the neuronwise response windows of some of the selected neurons. It can be seen that these neurons appear more responsive than the (pseudo) random sample shown above.</p>
<p><em>The maximum value of the mean evoked response is &gt;10%</em> <span id="id2">[<a class="reference internal" href="../bibliography.html#id11" title="Wenzhi Sun, Zhongchao Tan, Brett D. Mensh, and Na Ji. Thalamus provides layer 4 of primary visual cortex with orientation- and direction-tuned inputs. Nature Neuroscience, 2016. URL: https://rdcu.be/dbFb9.">Sun <em>et al.</em>, 2016</a>]</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_evoked_responses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">evoked_responses</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">max_mean_evoked_responses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mean_evoked_responses</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">IC1_selected_rois</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">max_mean_evoked_responses</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selected ROIs </span><span class="si">{</span><span class="n">IC1_selected_rois</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Selected ROIs [ 2  3  4  5  7  8 14 17 19 20 21 22 23 24 25 27 28 30 31 33 34 40]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">max_mean_evoked_responses</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;# ROIs&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Maximum $\Delta$F/F (%)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Ampltitudes of Mean Evoked Responses&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/20de8d81d8906faf413f1a285f4adc0889979ccae290647d90eef3f6ff959a53.png" src="../_images/20de8d81d8906faf413f1a285f4adc0889979ccae290647d90eef3f6ff959a53.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">IC1_selected_rois</span><span class="p">)</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">neuronwise_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> ROIs selected&quot;</span><span class="p">)</span>
<span class="n">show_many_responses</span><span class="p">(</span><span class="n">neuronwise_windows</span><span class="p">,</span>
                    <span class="mi">3</span><span class="p">,</span>
                    <span class="mi">8</span><span class="p">,</span>
                    <span class="n">window_idxs</span> <span class="o">=</span> <span class="n">IC1_selected_rois</span><span class="p">,</span>
                    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Neuronwise Responses of Some Included ROIs (Criterion 1)&quot;</span><span class="p">,</span>
                    <span class="n">subplot_title</span><span class="o">=</span><span class="s2">&quot;ROI&quot;</span><span class="p">,</span>
                    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span>
                    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;trial&quot;</span><span class="p">,</span>
                    <span class="n">cbar_label</span><span class="o">=</span><span class="s2">&quot;$\Delta$F/F (%)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22 / 41 ROIs selected
</pre></div>
</div>
<img alt="../_images/19ff4d5d7357f9709832482d71ff981bbe49d40222b7b82d0c6fcf3bee657cff.png" src="../_images/19ff4d5d7357f9709832482d71ff981bbe49d40222b7b82d0c6fcf3bee657cff.png" />
</div>
</div>
</section>
<section id="inclusion-criterion-2">
<h3>Inclusion Criterion 2<a class="headerlink" href="#inclusion-criterion-2" title="Permalink to this heading">#</a></h3>
<p>This criterion is slightly more complicated, and accounts for the fact that neurons might behave inconsistently. It uses the maximum values of the evoked response, and compares it to an absolue value (5%) as well as a value relative to its own baseline activity (3x the standard deviation). It is difficult to show the exact metric being used as a distribution, but to assist in interpretation, a distribution is shown below of the the mean ratio between the maximum evoked value and the standard distribution of the baseline behavior. Note that, this is not the exact metric used to select rois; as this criterion selects rois that exhibit significant activity in 50% or more trials. For our dataset, this criterion is rather stringent, only including 4 rois in the final selection.</p>
<p><em>In 50% of trials, the evoked response is A) larger than 3x the SD of the baseline, and B) larger than 5% dF/F</em> <span id="id3">[<a class="reference internal" href="../bibliography.html#id12" title="Morgane M. Roth, Fritjof Helmchen, and Bjorn M. Kampa. Distinct functional properties of primary and posteromedial visual area of mouse neocortex. The Journal of Neuroscience, 2012. URL: https://www.jneurosci.org/content/jneuro/32/28/9716.full.pdf.">Roth <em>et al.</em>, 2012</a>]</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_baseline_sds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">max_responses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">evoked_responses</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># rois in each trial that respond more than 3x the SD of baseline</span>
<span class="n">deviant_responses</span> <span class="o">=</span> <span class="n">max_responses</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">*</span><span class="n">all_baseline_sds</span>
<span class="c1"># rois in each trial that response more than 5% dff</span>
<span class="n">large_responses</span> <span class="o">=</span> <span class="n">max_responses</span> <span class="o">&gt;</span> <span class="mi">5</span>
<span class="c1"># rois in each trial that do both of the above</span>
<span class="n">sig_responses</span> <span class="o">=</span> <span class="n">deviant_responses</span> <span class="o">&amp;</span> <span class="n">large_responses</span>

<span class="c1"># rois that have significant responses in 50% or more trials</span>
<span class="n">half_trials</span> <span class="o">=</span> <span class="n">sig_responses</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">IC2_selected_rois</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sig_responses</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">half_trials</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selected ROIs </span><span class="si">{</span><span class="n">IC2_selected_rois</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Selected ROIs [ 2  3  4  5 14 17 20 21 23 25 27 31 33 34 40]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">max_responses</span> <span class="o">/</span> <span class="n">all_baseline_sds</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">z_scores</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Z-score&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;# ROIs&quot;</span><span class="p">)</span>
<span class="c1"># plt.axvline(x=3, color=&quot;red&quot;, linestyle=&quot;:&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Mean Z-scores of Maximum Reponses&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7fcad2a7ee5b70e965577e70a950315595e787baaa3bfdecf5fd5d7a04f22f35.png" src="../_images/7fcad2a7ee5b70e965577e70a950315595e787baaa3bfdecf5fd5d7a04f22f35.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">IC2_selected_rois</span><span class="p">)</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">neuronwise_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> ROIs selected&quot;</span><span class="p">)</span>
<span class="n">show_many_responses</span><span class="p">(</span><span class="n">neuronwise_windows</span><span class="p">,</span>
                    <span class="mi">3</span><span class="p">,</span>
                    <span class="mi">8</span><span class="p">,</span>
                    <span class="n">window_idxs</span><span class="o">=</span><span class="n">IC2_selected_rois</span><span class="p">,</span>
                    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Neuronwise Responses of Some Included ROIs (Criterion 2)&quot;</span><span class="p">,</span>
                    <span class="n">subplot_title</span><span class="o">=</span><span class="s2">&quot;ROI&quot;</span><span class="p">,</span>
                    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span>
                    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;trial&quot;</span><span class="p">,</span>
                    <span class="n">cbar_label</span><span class="o">=</span><span class="s2">&quot;$\Delta$F/F (%)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>15 / 41 ROIs selected
</pre></div>
</div>
<img alt="../_images/d7715f45a3a8253bfbc976893af08d5524c4e6cb17bc27bde67db2af35228edf.png" src="../_images/d7715f45a3a8253bfbc976893af08d5524c4e6cb17bc27bde67db2af35228edf.png" />
</div>
</div>
</section>
<section id="inclusion-criterion-3">
<h3>Inclusion Criterion 3<a class="headerlink" href="#inclusion-criterion-3" title="Permalink to this heading">#</a></h3>
<p>This is perhaps the most sophisticated criterion in our list. For each ROI, It compares the distribution of responses between the baseline activity and the evoked activity to identify any statistically significant response. Below, an example is shown of these distributions for one ROI. Change <code class="docutils literal notranslate"><span class="pre">roi</span></code> below to view the comparison for other cells. Additionally, the distribution of p-values of all rois is shown.</p>
<p><em>Paired T-test (p &lt; 0.05) with Bonferroni correction, comparing the mean baseline to the mean evoked response</em> <span id="id4">[<a class="reference internal" href="../bibliography.html#id13" title="Mark L. Andermann, Aaron M. Kerlin, Demetris K. Roumis, Lindsey L. Glickfield, and R. clay Reid. Functional specialization of mouse higher visual cortical areas. Neuron, 2011. URL: https://www.sciencedirect.com/science/article/pii/S0896627311010129.">Andermann <em>et al.</em>, 2011</a>]</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_trial_responses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">evoked_responses</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">mean_trial_baselines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">mean_trial_responses</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">t</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span><span class="n">mean_trial_responses</span><span class="p">,</span> <span class="n">mean_trial_baselines</span><span class="p">)</span>
<span class="n">IC3_selected_rois</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="mf">0.05</span> <span class="o">/</span> <span class="n">n</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selected ROIs </span><span class="si">{</span><span class="n">IC3_selected_rois</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Selected ROIs [ 8 17 20 21 23 26]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">roi</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">baseline_dist</span> <span class="o">=</span> <span class="n">mean_trial_baselines</span><span class="p">[:,</span><span class="n">roi</span><span class="p">]</span>
<span class="n">response_dist</span> <span class="o">=</span> <span class="n">mean_trial_responses</span><span class="p">[:,</span><span class="n">roi</span><span class="p">]</span>
<span class="n">max_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">baseline_dist</span><span class="p">,</span> <span class="n">response_dist</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">min_val</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">baseline_dist</span><span class="p">,</span> <span class="n">response_dist</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">baseline_dist</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;baseline&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">response_dist</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;evoked&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Mean response $\Delta$F/F (%)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;# Trial responses&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Baseline and Evoked Responses for ROI </span><span class="si">{</span><span class="n">roi</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;function matplotlib.pyplot.show(close=None, block=None)&gt;
</pre></div>
</div>
<img alt="../_images/bb6e646ffd30431f67db78bd638b4cc2443515af907b95c9e378f1a1de4b5739.png" src="../_images/bb6e646ffd30431f67db78bd638b4cc2443515af907b95c9e378f1a1de4b5739.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hist</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;P-value&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;# ROIs&quot;</span><span class="p">)</span>
<span class="n">thresh</span> <span class="o">=</span> <span class="mf">0.05</span><span class="o">/</span><span class="n">n</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">thresh</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;P-values of ROI Activity&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b4a09fa0a444587b7a5283a6a74a1665eb6b970074de169d92febc42f60a466c.png" src="../_images/b4a09fa0a444587b7a5283a6a74a1665eb6b970074de169d92febc42f60a466c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">IC3_selected_rois</span><span class="p">)</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">neuronwise_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> ROIs selected&quot;</span><span class="p">)</span>
<span class="n">show_many_responses</span><span class="p">(</span><span class="n">neuronwise_windows</span><span class="p">,</span>
                    <span class="mi">3</span><span class="p">,</span>
                    <span class="mi">8</span><span class="p">,</span>
                    <span class="n">window_idxs</span><span class="o">=</span><span class="n">IC3_selected_rois</span><span class="p">,</span>
                    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Neuronwise Responses of Some Included ROIs (Criterion 3)&quot;</span><span class="p">,</span>
                    <span class="n">subplot_title</span><span class="o">=</span><span class="s2">&quot;ROI&quot;</span><span class="p">,</span>
                    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span>
                    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;trial&quot;</span><span class="p">,</span>
                    <span class="n">cbar_label</span><span class="o">=</span><span class="s2">&quot;$\Delta$F/F (%)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6 / 41 ROIs selected
</pre></div>
</div>
<img alt="../_images/57061fda9e831c476a633eef5882ed7da67e09a65237630b46e1dd5cd9d05ea3.png" src="../_images/57061fda9e831c476a633eef5882ed7da67e09a65237630b46e1dd5cd9d05ea3.png" />
</div>
</div>
</section>
<section id="inclusion-criterion-4">
<h3>Inclusion Criterion 4<a class="headerlink" href="#inclusion-criterion-4" title="Permalink to this heading">#</a></h3>
<p>This criterion is the most stringent for our dataset. It relies on calculating the measure of <code class="docutils literal notranslate"><span class="pre">reliability</span></code> of a cell’s activity. It can be seen that in this example, no ROIs are selected. This is probably due to no ROIs having reliable responses to the stimulus. Perhaps conducting more trials could improve the reliability.</p>
<p><em>A) The mean response to any stimulus condition is is &gt; 6% dF/F and B) reliability &gt; 1</em> <span id="id5">[<a class="reference internal" href="../bibliography.html#id14" title="James H. Marshel, Marina E. Garrett, Ian Nauhaus, and Edward M. Callaway. Functional specialization of seven mouse visual cortical areas. Neuron, 2012. URL: https://www.sciencedirect.com/science/article/pii/S0896627311010464.">Marshel <em>et al.</em>, 2012</a>]</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_trial_responses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">evoked_responses</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">response_means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mean_trial_responses</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">response_sds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">mean_trial_responses</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">mean_trial_baselines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">baseline_means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mean_trial_baselines</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">baseline_sds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">mean_trial_baselines</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">reliabilities</span> <span class="o">=</span> <span class="p">(</span><span class="n">response_means</span> <span class="o">-</span> <span class="n">baseline_means</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">response_sds</span> <span class="o">+</span> <span class="n">baseline_sds</span><span class="p">)</span>

<span class="n">sig_reliabilities</span> <span class="o">=</span> <span class="n">reliabilities</span> <span class="o">&gt;</span> <span class="mi">1</span>
<span class="n">large_responses</span> <span class="o">=</span> <span class="n">response_means</span> <span class="o">&gt;</span> <span class="mi">6</span>
<span class="n">IC4_selected_rois</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sig_reliabilities</span> <span class="o">&amp;</span> <span class="n">large_responses</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selected ROIs </span><span class="si">{</span><span class="n">IC4_selected_rois</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Selected ROIs [17 21 23]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">reliabilities</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;# ROIs&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Reliability&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;ROI Reliabilities&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/5aec63d6941ec905ad10f4dfbf54638f6907713b4eb87370c5e22f99e93d1cdb.png" src="../_images/5aec63d6941ec905ad10f4dfbf54638f6907713b4eb87370c5e22f99e93d1cdb.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">IC4_selected_rois</span><span class="p">)</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">neuronwise_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> ROIs selected&quot;</span><span class="p">)</span>
<span class="n">show_many_responses</span><span class="p">(</span><span class="n">neuronwise_windows</span><span class="p">,</span>
                    <span class="mi">3</span><span class="p">,</span>
                    <span class="mi">8</span><span class="p">,</span>
                    <span class="n">window_idxs</span><span class="o">=</span><span class="n">IC4_selected_rois</span><span class="p">,</span>
                    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Neuronwise Responses of Some Included ROIs (Criterion 4)&quot;</span><span class="p">,</span>
                    <span class="n">subplot_title</span><span class="o">=</span><span class="s2">&quot;ROI&quot;</span><span class="p">,</span>
                    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span>
                    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;trial&quot;</span><span class="p">,</span>
                    <span class="n">cbar_label</span><span class="o">=</span><span class="s2">&quot;$\Delta$F/F (%)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3 / 41 ROIs selected
</pre></div>
</div>
<img alt="../_images/4bfd4a46b98b146bc9132770f67b651dd7e4b82f347c20de1ec2afd94f5637b3.png" src="../_images/4bfd4a46b98b146bc9132770f67b651dd7e4b82f347c20de1ec2afd94f5637b3.png" />
</div>
</div>
</section>
<section id="inclusion-criterion-5">
<h3>Inclusion Criterion 5<a class="headerlink" href="#inclusion-criterion-5" title="Permalink to this heading">#</a></h3>
<p>Finally, the simplest criterion. This criterion is clearly the most permissive, as it includes all ROIs for this dataset.</p>
<p><em>The maximum evoked response to any stimulus condition is &gt; 4% dF/F</em> <span id="id6">[<a class="reference internal" href="../bibliography.html#id15" title="Manavu Tohmi, Reiko Meguro, Hiroaki Tsukano, Ryuichi Hishida, and Katsuei Shibuki. The extrageniculate visual pathway generates distinct response properties in the higher visual areas of mice. Current Biology, 2014. URL: https://www.sciencedirect.com/science/article/pii/S0960982214001262.">Tohmi <em>et al.</em>, 2014</a>]</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">max_responses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">evoked_responses</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">IC5_selected_rois</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">max_responses</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selected ROIs </span><span class="si">{</span><span class="n">IC5_selected_rois</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Selected ROIs [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23
 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">max_responses</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;# ROIs&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$\Delta$F/F (%)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Maximum evoked response of ROIs&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9ee9ec9c534932ec1cf8444415cea2f9f7052d108dad6614aa308e3d2f5beee0.png" src="../_images/9ee9ec9c534932ec1cf8444415cea2f9f7052d108dad6614aa308e3d2f5beee0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">IC5_selected_rois</span><span class="p">)</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">neuronwise_windows</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> ROIs selected&quot;</span><span class="p">)</span>
<span class="n">show_many_responses</span><span class="p">(</span><span class="n">neuronwise_windows</span><span class="p">,</span>
                    <span class="mi">3</span><span class="p">,</span>
                    <span class="mi">8</span><span class="p">,</span>
                    <span class="n">window_idxs</span><span class="o">=</span><span class="n">IC5_selected_rois</span><span class="p">,</span>
                    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Neuronwise Responses of Some Included ROIs (Criterion 5)&quot;</span><span class="p">,</span>
                    <span class="n">subplot_title</span><span class="o">=</span><span class="s2">&quot;ROI&quot;</span><span class="p">,</span>
                    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span>
                    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;trial&quot;</span><span class="p">,</span>
                    <span class="n">cbar_label</span><span class="o">=</span><span class="s2">&quot;$\Delta$F/F (%)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>41 / 41 ROIs selected
</pre></div>
</div>
<img alt="../_images/56a854371123746785c09c7b7916b050ca918d9f15d4865f063692491c3886fb.png" src="../_images/56a854371123746785c09c7b7916b050ca918d9f15d4865f063692491c3886fb.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "AllenInstitute/openscope_databook",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./first-order"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="current_source_density.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Current Source Density Analysis</p>
      </div>
    </a>
    <a class="right-next"
       href="test_spike_responses.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Statistically Testing Spike Responses to Stimulus</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#environment-setup">Environment Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-ophys-file">Downloading Ophys File</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-2p-data-and-stimulus-data">Getting 2P Data and Stimulus Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fluorescence-interpolation">Fluorescence Interpolation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#selecting-stimulus-times">Selecting Stimulus Times</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aligning-stimulus-response-time-windows">Aligning Stimulus Response Time Windows</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-plotting-methods">Defining Plotting Methods</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#viewing-stimulus-response-windows">Viewing Stimulus Response Windows</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#showing-response-windows">Showing Response Windows</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inclusion-criteria">Inclusion Criteria</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inclusion-criterion-1">Inclusion Criterion 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inclusion-criterion-2">Inclusion Criterion 2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inclusion-criterion-3">Inclusion Criterion 3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inclusion-criterion-4">Inclusion Criterion 4</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inclusion-criterion-5">Inclusion Criterion 5</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Carter Peene
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>